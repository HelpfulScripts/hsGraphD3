this.hsGraphD3=(()=>{var __webpack_modules__={397:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{BandScale:()=>BandScale,Graph:()=>Graph,LinearScale:()=>LinearScale,LogScale:()=>LogScale,NoScale:()=>NoScale,Series:()=>Series,SeriesPlotPolar:()=>SeriesPlotPolar,TimeScale:()=>TimeScale,Voronoi:()=>Voronoi_Voronoi,defaultColors:()=>defaultColors,scaleDefault:()=>scaleDefault});const monthStr=[["Jan","January"],["Feb","February"],["Mar","March"],["Apr","April"],["May","May"],["Jun","June"],["Jul","July"],["Aug","August"],["Sep","September"],["Oct","October"],["Nov","November"],["Dec","December"]],dayStr=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]];function formatNumber(number,digits){let r=""+number;for(;r.length<digits;)r="0"+r;return r}const COLOR={clear:"color:#000; background-color:inherit; font-weight:normal;",bold:"font-weight:bold;",dim:"",underscore:"",blink:"",reverse:"",hidden:"",black:"color:#000;",red:"color:#f00;",green:"color:#0f0;",yellow:"color:#ff0;",blue:"color:#00f;",magenta:"color:#f0f;",cyan:"color:#0ff;",white:"color:#fff;",darkred:"color:#800;",darkgreen:"color:#080;",darkyellow:"color:#880;",darkblue:"color:#008;",darkmagenta:"color:#808;",darkcyan:"color:#088;",gray:"color:#888;",bgBlack:"background-color:#000;",bgRed:"background-color:#f00;",bgGreen:"background-color:#0f0;",bgYellow:"background-color:#ff0;",bgBlue:"background-color:#00f;",bgMagenta:"background-color:#f0f;",bgCyan:"background-color:#0ff;",bgWhite:"background-color:#fff;"};class Log{constructor(prefix){this.reportLevel=void 0,this.reportPrefix="",this.maxLength=-1,this.colors=!0,this.reportPrefix=prefix}set messageLength(max){this.maxLength=max}get messageLength(){return this.maxLength}level(newLevelSym,setGlobalLevel){let newLevel=Log.levels[newLevelSym]||Log.globalLevel,oldLevel=this.reportLevel||Log.globalLevel;if(void 0===newLevelSym)newLevel=oldLevel;else if(null===newLevelSym)this.reportLevel=void 0;else if(Log.levels[newLevelSym]){setGlobalLevel?Log.globalLevel=newLevel:this.reportLevel=newLevel;const msg=`new ${setGlobalLevel?"global":this.reportPrefix} log level ${newLevel.desc.toUpperCase()} (was ${oldLevel.desc.toUpperCase()})`;newLevel.sym===oldLevel.sym?this.debug(msg):this.info(msg)}else this.error(`unkown level ${newLevelSym}; log level remains ${oldLevel.sym}`);return newLevel.sym}debug(msg){return this.out(Log.DEBUG,msg,{color:["gray"]})}transient(msg){return this.out(Log.INFO,msg,{color:["darkgreen"],lf:"\r"})}progress(msg){return this.out(Log.INFO,msg,{color:["darkblue"]})}info(msg){return this.out(Log.INFO,msg,{color:["darkgreen"]})}warn(msg){return this.out(Log.WARN,msg,{color:["darkyellow","bold"]})}error(msg){const color=["darkred","bold"];return msg.message?(this.out(Log.ERROR,msg.message,{color}),this.out(Log.ERROR,msg.stack,{color}),msg.message):this.out(Log.ERROR,msg,{color})}out(lvl,msg,options){let desc=Log.levels[lvl];const filterLevel=this.reportLevel||Log.globalLevel;if(desc.importance>=filterLevel.importance){let line;switch(typeof msg){case"function":line=msg();break;case"string":line=msg;break;case"object":default:line=this.inspect(msg)}const dateStr=function(formatString,date=new Date){return"string"!=typeof formatString||isNaN(date.getTime())?"invalid":formatString.replace(/%YYYY/g,""+date.getFullYear()).replace(/%YY/g,""+date.getFullYear()%100).replace(/%MMMM/g,monthStr[date.getMonth()][1]).replace(/%MMM/g,monthStr[date.getMonth()][0]).replace(/%MM/g,formatNumber(date.getMonth()+1,2)).replace(/%M/g,""+(date.getMonth()+1)).replace(/%DDDD/g,dayStr[date.getDay()][1]).replace(/%DDD/g,dayStr[date.getDay()][0]).replace(/%DD/g,formatNumber(date.getDate(),2)).replace(/%D/g,""+date.getDate()).replace(/%hh/g,formatNumber(date.getHours(),2)).replace(/%h/g,""+date.getHours()).replace(/%mm/g,formatNumber(date.getMinutes(),2)).replace(/%m/g,""+date.getMinutes()).replace(/%ss/g,formatNumber(date.getSeconds(),2)).replace(/%jjj/g,formatNumber(date.getMilliseconds(),3)).replace(/%jj/g,formatNumber(date.getMilliseconds()/10,2)).replace(/%j/g,formatNumber(date.getMilliseconds()/100,1))}(Log.dateFormat);msg.stack&&(line=`${line}\n${msg.stack}`);const header=`${dateStr} ${this.reportPrefix} ${desc.desc}`;return this.output(options.color,header,line),line+(options.lf||"")}}output(color,header,line){const lines=line.split("\n");this.maxLength>0&&lines.forEach(((l,i)=>l.length<=this.maxLength?"":lines[i]=`${line.slice(0,this.maxLength/2-2)}...${line.slice(-this.maxLength/2+2)}`)),console.log(`%c${header}%c ${lines.join("\n")}`,color.map((c=>COLOR[c])).join(" "),COLOR.clear)}format(fmtStr){return null===fmtStr?Log.dateFormat=Log.defDateFormat:fmtStr&&(Log.dateFormat=fmtStr),Log.dateFormat}prefix(prf){return prf&&(this.reportPrefix=prf),this.reportPrefix}config(cfg){void 0!==cfg.format&&this.format(cfg.format),void 0!==cfg.level&&this.level(cfg.level),void 0!==cfg.colors&&(this.colors=cfg.colors)}inspect(msg,{depth=-1,indent="   ",colors=Log.INDENT_COLORS}={depth:0,indent:"   ",colors:Log.INDENT_COLORS}){const log=this;return function _inspect(msg,depth,level,currIndent){if(null===msg)return"null";if(void 0===msg)return"undefined";if("function"==typeof msg)return"function";if("string"==typeof msg)return`'${msg}'`;if("object"==typeof msg){if(depth<0)return void 0===msg.length?"{...}":"[...]";if(void 0!==msg.map)return`[${msg.map((e=>void 0===e?"":_inspect(e,depth-1,level+1,currIndent))).join(", ")}]`;const[prefix,postfix,lf,postIndent]=log.getPrePostfix(indent,level,currIndent,colors);return"{"+lf+Object.keys(msg).map((k=>`${prefix}${k}${postfix}: ${_inspect(msg[k],depth-1,level+1,currIndent+indent)}`)).join(","+lf)+`${lf}${postIndent}}`}return msg.toString()}(msg,null!=depth&&depth>=0?depth:999,0,"")}getPrePostfix(indent,level,currIndent,colors){let cstart="",cstop="",lf="\n";if(colors){indent=indent.replace(/ /g,"&nbsp;"),currIndent=currIndent.replace(/ /g,"&nbsp;");cstart=`<b><span style='${COLOR[colors[level%colors.length]]||colors[level%colors.length]}'>`,cstop="</span></b>",lf="<br>"}return[`${currIndent}${indent}${cstart}`,""+cstop,colors?"<br>":"\n",currIndent]}}Log.INDENT_COLORS=["darkblue","darkgreen","darkred","darkcyan","darkyellow","darkmagenta"],Log.defDateFormat="%YYYY%MM%DD %hh:%mm:%ss.%jjj",Log.dateFormat=Log.defDateFormat,Log.DEBUG="DEBUG",Log.INFO="INFO",Log.WARN="WARN",Log.ERROR="ERROR",Log.levels={[Log.DEBUG]:{importance:0,sym:Log.DEBUG,desc:"DEBUG"},[Log.INFO]:{importance:1,sym:Log.INFO,desc:"INFO"},[Log.WARN]:{importance:2,sym:Log.WARN,desc:"WARN"},[Log.ERROR]:{importance:3,sym:Log.ERROR,desc:"ERROR"}},Log.log=new Log(""),Log.globalLevel=Log.levels[Log.INFO];new Log("Pacing");class Pace{constructor({pace=100,maxConcurrent=-1,collectionPeriod=0}){this.maxConcurrent=-1,this.pace=0,this.waitUntil=0,this.waiting=0,this.started=0,this.queue={},this.collectionPeriod=0,this.pace=pace,this.maxConcurrent=maxConcurrent,this.collectionPeriod=collectionPeriod}isAllowed(){return this.maxConcurrent<0||this.started<this.maxConcurrent}setPace(ms){this.pace=ms}setMaxConcurrent(maxConcurrent){this.maxConcurrent=maxConcurrent}inQueue(){return this.waiting}inProgress(){return this.started}async add(fn,key){const now=(new Date).getTime(),callTime=now+Math.max(this.collectionPeriod,this.waitUntil);let item;return this.waitUntil+=this.pace,key&&this.queue[key]?(item=this.queue[key],clearTimeout(item.timer),item.fn=fn,item.added=now):(item={fn,added:now,pace:this,key:key=key||`${now}-${Math.floor(1e5*Math.random())}`},this.queue[key]=item,this.waiting++),this.resolveItem(item,callTime-now)}resolveItem(item,waitTime){return new Promise(((resolve,reject)=>{item.timer=setTimeout((async _item=>{try{const key=_item.key;delete _item.pace.queue[key],_item.pace.waiting--,await(pace=_item.pace,new Promise((release=>{const waitLoop=()=>pace.isAllowed()?release():setTimeout(waitLoop,10);waitLoop()}))),_item.pace.started++;const actualDelay=Date.now()-_item.added,ret=await _item.fn(actualDelay);_item.pace.started--,resolve(ret)}catch(e){_item.pace.started--,reject(e)}var pace}),waitTime,item)}))}}var external_crypto_=__webpack_require__(417);class Auth{constructor(username,password){this.username=username,this.password=password}}const AuthDigest_log=new Log("AuthDigest");class AuthDigest extends Auth{constructor(){super(...arguments),this.nc=0}updateNC(){let padding=new Array(8).join("0")+"";this.nc=this.nc>99999999?1:this.nc+1;let nc=this.nc+"";return padding.substr(0,8-nc.length)+nc}generateCNONCE(qop,cnonce){if(!qop||"auth"===qop){let cnonceHash=(0,external_crypto_.createHash)("md5");cnonceHash.update(Math.random().toString(36)),cnonce=cnonce??cnonceHash.digest("hex").substr(0,16)}return{cnonce,nc:this.updateNC()}}testAuth(options,response,CNonce){const challenge=function(digestHeader){digestHeader=digestHeader.split("Digest ")[1];const params={};return digestHeader.replace(/([^,]*)/g,((...rest)=>{const part=rest[1];if(part){const kv=part.split("=").map((v=>v.trim()));params[kv[0]]=kv[1].replace(/\"/g,"")}return""})),params}(response.headers["www-authenticate"]),ha1=(0,external_crypto_.createHash)("md5"),ha2=(0,external_crypto_.createHash)("md5"),hash=(0,external_crypto_.createHash)("md5");ha1.update(`${this.username}:${challenge.realm}:${this.password}`),ha2.update(`${options.method}:${options.path}`);const{nc,cnonce}=this.generateCNONCE(challenge.qop,CNonce);hash.update(`${ha1.digest("hex")}:${challenge.nonce}:${nc}:${cnonce}:${challenge.qop}:${ha2.digest("hex")}`);let authParams={realm:challenge.realm,username:this.username,uri:options.path,qop:challenge.qop,nonce:challenge.nonce,algorithm:"MD5",response:hash.digest("hex")};return authParams=function(data){let newObject={};return Object.keys(data).forEach((k=>data[k]?newObject[k]=data[k]:"")),newObject}(authParams),cnonce&&(authParams.nc=nc,authParams.cnonce=cnonce,AuthDigest_log.info("digest nc="+nc)),options.headers.Authorization=function(params){const putDoubleQuotes=entry=>["qop","nc"].indexOf(entry)<0;let parts=[];for(let i in params)if("function"!=typeof params[i]){let param=i+"="+(putDoubleQuotes(i)?`"${params[i]}"`:params[i]);parts.push(param)}return"Digest "+parts.join(",")}(authParams),options.headers.Accept="text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8",options.headers["Accept-Encoding"]="gzip, deflate",options}}new Log("RequestBasic");class AuthBasic extends Auth{testAuth(options){var str;return options.headers.Authorization="Basic "+((str=`${this.username}:${this.password}`)instanceof Buffer?str:Buffer.from(str.toString(),"binary")).toString("base64"),options}}const Request_log=new Log("Request");Request_log.messageLength=120;class Authenticators{static get(authRequest,credentials,url){if(!authRequest)return;if(!credentials)throw"authentication missing; call 'setCredentials' before calling 'get' for url "+url;let auth=Authenticators.auths[url];if(!auth)if(0===authRequest.indexOf("Digest"))auth=Authenticators.auths[url]=new AuthDigest(credentials.user,credentials.password);else{if(0!==authRequest.indexOf("Basic"))throw`unimplemented authentication request ${authRequest} for '${url}'`;auth=Authenticators.auths[url]=new AuthBasic(credentials.user,credentials.password)}return auth}}Authenticators.auths={};class Request{constructor(){this.log=Request_log,this.setCredentials=(user,password)=>{this.credentials=void 0===user?void 0:{user,password}},this.setAuthToken=token=>this.authToken=token,this.setPace=({pace=50,max=10,collectionPeriod=100}={pace:null})=>{this.pace=!pace||pace<0?void 0:new Pace({pace,maxConcurrent:max,collectionPeriod})},this.clearPace=()=>this.setPace(),this.decode=void 0}static addContentType(type,isText){const subTypes=type.split("/");Request.contentTypes.push({subTypes,isText})}async get(url,{useCached=!0,headers={}}={}){const options=this.getOptions(url,"GET");return this.decodedRequest(options,useCached,headers)}async put(url,postData,{headers={}}={}){const options=this.getOptions(url,"PUT");return this.decodedRequest(options,!1,headers,postData)}async post(url,postData,{headers={}}={}){const options=this.getOptions(url,"POST");return this.decodedRequest(options,!1,headers,postData)}getURL(url){return"string"==typeof url?new URL(url,document.URL):url}getOptions(url,method){const options={rejectUnauthorized:!1,method,protocol:(url=this.getURL(url)).protocol,host:url.host,hostname:url.hostname,port:url.port,pathname:""+url.pathname,path:""+url.pathname+(url.search||""),headers:{},url:`${url.protocol}//${url.host}${""+url.pathname+(url.search||"")}`};return this.authToken&&(options.headers.AuthToken=this.authToken),options}async decodedRequest(options,useCached,headers,postData){const result=await this.requestOptions(options,useCached,postData);return this.decode&&result.response.txt&&"GET"===options.method&&(result.data=this.decode(result.data,options)),result}async requestOptions(options,useCached,postData){let request;this.pace?(this.log.transient(`(${this.pace.inQueue()} | ${this.pace.inProgress()}) ${options.method}-ing ${options.url}`),request=this.pace.add((()=>this.request(options,postData)),`${options.method} ${options.url}`)):request=this.request(options,postData);const response=await request;return this.pace&&this.log.transient(`(${this.pace.inQueue()} | ${this.pace.inProgress()}) received ${options.method} ${options.url} `),response}async request(options,postData){try{const response=await this.issueRequest(options,postData),auth=Authenticators.get(response.response.headers["www-authenticate"],this.credentials,options.url);return auth?this.request(auth.testAuth(options,response.response)):response}catch(e){throw Request_log.error(`request: ${e}\n${Object.entries(options.headers).join("\n")}`),`error requesting ${options.url}: ${e}`}}async issueRequest(options,postData){return new Promise(((resolve,reject)=>{try{const xhr=new XMLHttpRequest,txt=Request.isTextualRequest(options.pathname);xhr.open(options.method,options.url,!0),Object.keys(options.headers).forEach((h=>xhr.setRequestHeader(h,options.headers[h]))),xhr.responseType=txt?"text":"arraybuffer",xhr.onload=function(e){const headersText=xhr.getAllResponseHeaders(),headers={"content-type":""};headersText.split("\r\n").map((h=>{const kv=h.split(":").map((p=>p.trim()));kv[0].length&&(headers[kv[0]]=kv[1])}));const contentType=this.responseType,txt=Request.isTextualContent(contentType),response={data:this.response,response:{txt,headers,method:options.method,status:this.status,statusCode:this.status,statusMessage:`${this.status} ${this.statusText}`,url:this.responseURL}};resolve(response)},xhr.send(postData?JSON.stringify(postData):void 0)}catch(e){reject(e)}}))}static isTextualContent(contentType){if(void 0===contentType)return Request_log.warn("undefined contentType; assuming binary"),!1;const subTypes=contentType.split("/"),match=Request.contentTypes.filter((entry=>entry.subTypes.every(((st,i)=>subTypes[i]===st))));return match.length>0?match[0].isText:(Request_log.warn(`no match found for '${contentType}'; caching as binary`),!1)}static isTextualRequest(pathName){return["json","txt","html"].some((ext=>pathName.indexOf(ext)>=0))}}Request.contentTypes=[],Request.decoders={str2json:data=>{try{return JSON.parse(data)}catch(e){return{}}},html2json:void 0},[["text",!0],["text/html",!0],["image",!1],["audio",!1],["font",!1],["application/json",!0],["application/pdf",!1],["application/vnd.openxmlformats-officedocument.presentationml.presentation",!1],["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",!1],["application/vnd.ms-powerpoint",!1],["application/vnd.ms-excel",!1],["application/vnd.ms-excel.sheet.macroenabled.12",!1],["application/octet-stream",!1]].forEach((e=>Request.addContentType(e[0],e[1])));var slice=Array.prototype.slice;function src_identity(x){return x}function translateX(x){return"translate("+(x+.5)+",0)"}function translateY(y){return"translate(0,"+(y+.5)+")"}function number(scale){return d=>+scale(d)}function center(scale){var offset=Math.max(0,scale.bandwidth()-1)/2;return scale.round()&&(offset=Math.round(offset)),function(d){return+scale(d)+offset}}function entering(){return!this.__axis}function axis(orient,scale){var tickArguments=[],tickValues=null,tickFormat=null,tickSizeInner=6,tickSizeOuter=6,tickPadding=3,k=1===orient||4===orient?-1:1,x=4===orient||2===orient?"x":"y",transform=1===orient||3===orient?translateX:translateY;function axis(context){var values=null==tickValues?scale.ticks?scale.ticks.apply(scale,tickArguments):scale.domain():tickValues,format=null==tickFormat?scale.tickFormat?scale.tickFormat.apply(scale,tickArguments):src_identity:tickFormat,spacing=Math.max(tickSizeInner,0)+tickPadding,range=scale.range(),range0=+range[0]+.5,range1=+range[range.length-1]+.5,position=(scale.bandwidth?center:number)(scale.copy()),selection=context.selection?context.selection():context,path=selection.selectAll(".domain").data([null]),tick=selection.selectAll(".tick").data(values,scale).order(),tickExit=tick.exit(),tickEnter=tick.enter().append("g").attr("class","tick"),line=tick.select("line"),text=tick.select("text");path=path.merge(path.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),tick=tick.merge(tickEnter),line=line.merge(tickEnter.append("line").attr("stroke","currentColor").attr(x+"2",k*tickSizeInner)),text=text.merge(tickEnter.append("text").attr("fill","currentColor").attr(x,k*spacing).attr("dy",1===orient?"0em":3===orient?"0.71em":"0.32em")),context!==selection&&(path=path.transition(context),tick=tick.transition(context),line=line.transition(context),text=text.transition(context),tickExit=tickExit.transition(context).attr("opacity",1e-6).attr("transform",(function(d){return isFinite(d=position(d))?transform(d):this.getAttribute("transform")})),tickEnter.attr("opacity",1e-6).attr("transform",(function(d){var p=this.parentNode.__axis;return transform(p&&isFinite(p=p(d))?p:position(d))}))),tickExit.remove(),path.attr("d",4===orient||2==orient?tickSizeOuter?"M"+k*tickSizeOuter+","+range0+"H0.5V"+range1+"H"+k*tickSizeOuter:"M0.5,"+range0+"V"+range1:tickSizeOuter?"M"+range0+","+k*tickSizeOuter+"V0.5H"+range1+"V"+k*tickSizeOuter:"M"+range0+",0.5H"+range1),tick.attr("opacity",1).attr("transform",(function(d){return transform(position(d))})),line.attr(x+"2",k*tickSizeInner),text.attr(x,k*spacing).text(format),selection.filter(entering).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",2===orient?"start":4===orient?"end":"middle"),selection.each((function(){this.__axis=position}))}return axis.scale=function(_){return arguments.length?(scale=_,axis):scale},axis.ticks=function(){return tickArguments=slice.call(arguments),axis},axis.tickArguments=function(_){return arguments.length?(tickArguments=null==_?[]:slice.call(_),axis):tickArguments.slice()},axis.tickValues=function(_){return arguments.length?(tickValues=null==_?null:slice.call(_),axis):tickValues&&tickValues.slice()},axis.tickFormat=function(_){return arguments.length?(tickFormat=_,axis):tickFormat},axis.tickSize=function(_){return arguments.length?(tickSizeInner=tickSizeOuter=+_,axis):tickSizeInner},axis.tickSizeInner=function(_){return arguments.length?(tickSizeInner=+_,axis):tickSizeInner},axis.tickSizeOuter=function(_){return arguments.length?(tickSizeOuter=+_,axis):tickSizeOuter},axis.tickPadding=function(_){return arguments.length?(tickPadding=+_,axis):tickPadding},axis}function none(){}function selector(selector){return null==selector?none:function(){return this.querySelector(selector)}}function array(x){return"object"==typeof x&&"length"in x?x:Array.from(x)}function empty(){return[]}function selectorAll(selector){return null==selector?empty:function(){return this.querySelectorAll(selector)}}function matcher(selector){return function(){return this.matches(selector)}}function childMatcher(selector){return function(node){return node.matches(selector)}}var find=Array.prototype.find;function childFirst(){return this.firstElementChild}var filter=Array.prototype.filter;function children(){return this.children}function sparse(update){return new Array(update.length)}function EnterNode(parent,datum){this.ownerDocument=parent.ownerDocument,this.namespaceURI=parent.namespaceURI,this._next=null,this._parent=parent,this.__data__=datum}function src_constant(x){return function(){return x}}function bindIndex(parent,group,enter,update,exit,data){for(var node,i=0,groupLength=group.length,dataLength=data.length;i<dataLength;++i)(node=group[i])?(node.__data__=data[i],update[i]=node):enter[i]=new EnterNode(parent,data[i]);for(;i<groupLength;++i)(node=group[i])&&(exit[i]=node)}function bindKey(parent,group,enter,update,exit,data,key){var i,node,keyValue,nodeByKeyValue=new Map,groupLength=group.length,dataLength=data.length,keyValues=new Array(groupLength);for(i=0;i<groupLength;++i)(node=group[i])&&(keyValues[i]=keyValue=key.call(node,node.__data__,i,group)+"",nodeByKeyValue.has(keyValue)?exit[i]=node:nodeByKeyValue.set(keyValue,node));for(i=0;i<dataLength;++i)keyValue=key.call(parent,data[i],i,data)+"",(node=nodeByKeyValue.get(keyValue))?(update[i]=node,node.__data__=data[i],nodeByKeyValue.delete(keyValue)):enter[i]=new EnterNode(parent,data[i]);for(i=0;i<groupLength;++i)(node=group[i])&&nodeByKeyValue.get(keyValues[i])===node&&(exit[i]=node)}function datum(node){return node.__data__}function ascending(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}EnterNode.prototype={constructor:EnterNode,appendChild:function(child){return this._parent.insertBefore(child,this._next)},insertBefore:function(child,next){return this._parent.insertBefore(child,next)},querySelector:function(selector){return this._parent.querySelector(selector)},querySelectorAll:function(selector){return this._parent.querySelectorAll(selector)}};var xhtml="http://www.w3.org/1999/xhtml";const namespaces={svg:"http://www.w3.org/2000/svg",xhtml,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function namespace(name){var prefix=name+="",i=prefix.indexOf(":");return i>=0&&"xmlns"!==(prefix=name.slice(0,i))&&(name=name.slice(i+1)),namespaces.hasOwnProperty(prefix)?{space:namespaces[prefix],local:name}:name}function attrRemove(name){return function(){this.removeAttribute(name)}}function attrRemoveNS(fullname){return function(){this.removeAttributeNS(fullname.space,fullname.local)}}function attrConstant(name,value){return function(){this.setAttribute(name,value)}}function attrConstantNS(fullname,value){return function(){this.setAttributeNS(fullname.space,fullname.local,value)}}function attrFunction(name,value){return function(){var v=value.apply(this,arguments);null==v?this.removeAttribute(name):this.setAttribute(name,v)}}function attrFunctionNS(fullname,value){return function(){var v=value.apply(this,arguments);null==v?this.removeAttributeNS(fullname.space,fullname.local):this.setAttributeNS(fullname.space,fullname.local,v)}}function src_window(node){return node.ownerDocument&&node.ownerDocument.defaultView||node.document&&node||node.defaultView}function styleRemove(name){return function(){this.style.removeProperty(name)}}function styleConstant(name,value,priority){return function(){this.style.setProperty(name,value,priority)}}function styleFunction(name,value,priority){return function(){var v=value.apply(this,arguments);null==v?this.style.removeProperty(name):this.style.setProperty(name,v,priority)}}function styleValue(node,name){return node.style.getPropertyValue(name)||src_window(node).getComputedStyle(node,null).getPropertyValue(name)}function propertyRemove(name){return function(){delete this[name]}}function propertyConstant(name,value){return function(){this[name]=value}}function propertyFunction(name,value){return function(){var v=value.apply(this,arguments);null==v?delete this[name]:this[name]=v}}function classArray(string){return string.trim().split(/^|\s+/)}function classList(node){return node.classList||new ClassList(node)}function ClassList(node){this._node=node,this._names=classArray(node.getAttribute("class")||"")}function classedAdd(node,names){for(var list=classList(node),i=-1,n=names.length;++i<n;)list.add(names[i])}function classedRemove(node,names){for(var list=classList(node),i=-1,n=names.length;++i<n;)list.remove(names[i])}function classedTrue(names){return function(){classedAdd(this,names)}}function classedFalse(names){return function(){classedRemove(this,names)}}function classedFunction(names,value){return function(){(value.apply(this,arguments)?classedAdd:classedRemove)(this,names)}}function textRemove(){this.textContent=""}function textConstant(value){return function(){this.textContent=value}}function textFunction(value){return function(){var v=value.apply(this,arguments);this.textContent=null==v?"":v}}function htmlRemove(){this.innerHTML=""}function htmlConstant(value){return function(){this.innerHTML=value}}function htmlFunction(value){return function(){var v=value.apply(this,arguments);this.innerHTML=null==v?"":v}}function raise(){this.nextSibling&&this.parentNode.appendChild(this)}function lower(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function creatorInherit(name){return function(){var document=this.ownerDocument,uri=this.namespaceURI;return uri===xhtml&&document.documentElement.namespaceURI===xhtml?document.createElement(name):document.createElementNS(uri,name)}}function creatorFixed(fullname){return function(){return this.ownerDocument.createElementNS(fullname.space,fullname.local)}}function creator(name){var fullname=namespace(name);return(fullname.local?creatorFixed:creatorInherit)(fullname)}function constantNull(){return null}function remove(){var parent=this.parentNode;parent&&parent.removeChild(this)}function selection_cloneShallow(){var clone=this.cloneNode(!1),parent=this.parentNode;return parent?parent.insertBefore(clone,this.nextSibling):clone}function selection_cloneDeep(){var clone=this.cloneNode(!0),parent=this.parentNode;return parent?parent.insertBefore(clone,this.nextSibling):clone}function parseTypenames(typenames){return typenames.trim().split(/^|\s+/).map((function(t){var name="",i=t.indexOf(".");return i>=0&&(name=t.slice(i+1),t=t.slice(0,i)),{type:t,name}}))}function onRemove(typename){return function(){var on=this.__on;if(on){for(var o,j=0,i=-1,m=on.length;j<m;++j)o=on[j],typename.type&&o.type!==typename.type||o.name!==typename.name?on[++i]=o:this.removeEventListener(o.type,o.listener,o.options);++i?on.length=i:delete this.__on}}}function onAdd(typename,value,options){return function(){var o,on=this.__on,listener=function(listener){return function(event){listener.call(this,event,this.__data__)}}(value);if(on)for(var j=0,m=on.length;j<m;++j)if((o=on[j]).type===typename.type&&o.name===typename.name)return this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=listener,o.options=options),void(o.value=value);this.addEventListener(typename.type,listener,options),o={type:typename.type,name:typename.name,value,listener,options},on?on.push(o):this.__on=[o]}}function dispatchEvent(node,type,params){var window=src_window(node),event=window.CustomEvent;"function"==typeof event?event=new event(type,params):(event=window.document.createEvent("Event"),params?(event.initEvent(type,params.bubbles,params.cancelable),event.detail=params.detail):event.initEvent(type,!1,!1)),node.dispatchEvent(event)}function dispatchConstant(type,params){return function(){return dispatchEvent(this,type,params)}}function dispatchFunction(type,params){return function(){return dispatchEvent(this,type,params.apply(this,arguments))}}ClassList.prototype={add:function(name){this._names.indexOf(name)<0&&(this._names.push(name),this._node.setAttribute("class",this._names.join(" ")))},remove:function(name){var i=this._names.indexOf(name);i>=0&&(this._names.splice(i,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(name){return this._names.indexOf(name)>=0}};var root=[null];function Selection(groups,parents){this._groups=groups,this._parents=parents}function selection(){return new Selection([[document.documentElement]],root)}Selection.prototype=selection.prototype={constructor:Selection,select:function(select){"function"!=typeof select&&(select=selector(select));for(var groups=this._groups,m=groups.length,subgroups=new Array(m),j=0;j<m;++j)for(var node,subnode,group=groups[j],n=group.length,subgroup=subgroups[j]=new Array(n),i=0;i<n;++i)(node=group[i])&&(subnode=select.call(node,node.__data__,i,group))&&("__data__"in node&&(subnode.__data__=node.__data__),subgroup[i]=subnode);return new Selection(subgroups,this._parents)},selectAll:function(select){select="function"==typeof select?function(select){return function(){var group=select.apply(this,arguments);return null==group?[]:array(group)}}(select):selectorAll(select);for(var groups=this._groups,m=groups.length,subgroups=[],parents=[],j=0;j<m;++j)for(var node,group=groups[j],n=group.length,i=0;i<n;++i)(node=group[i])&&(subgroups.push(select.call(node,node.__data__,i,group)),parents.push(node));return new Selection(subgroups,parents)},selectChild:function(match){return this.select(null==match?childFirst:function(match){return function(){return find.call(this.children,match)}}("function"==typeof match?match:childMatcher(match)))},selectChildren:function(match){return this.selectAll(null==match?children:function(match){return function(){return filter.call(this.children,match)}}("function"==typeof match?match:childMatcher(match)))},filter:function(match){"function"!=typeof match&&(match=matcher(match));for(var groups=this._groups,m=groups.length,subgroups=new Array(m),j=0;j<m;++j)for(var node,group=groups[j],n=group.length,subgroup=subgroups[j]=[],i=0;i<n;++i)(node=group[i])&&match.call(node,node.__data__,i,group)&&subgroup.push(node);return new Selection(subgroups,this._parents)},data:function(value,key){if(!arguments.length)return Array.from(this,datum);var bind=key?bindKey:bindIndex,parents=this._parents,groups=this._groups;"function"!=typeof value&&(value=src_constant(value));for(var m=groups.length,update=new Array(m),enter=new Array(m),exit=new Array(m),j=0;j<m;++j){var parent=parents[j],group=groups[j],groupLength=group.length,data=array(value.call(parent,parent&&parent.__data__,j,parents)),dataLength=data.length,enterGroup=enter[j]=new Array(dataLength),updateGroup=update[j]=new Array(dataLength),exitGroup=exit[j]=new Array(groupLength);bind(parent,group,enterGroup,updateGroup,exitGroup,data,key);for(var previous,next,i0=0,i1=0;i0<dataLength;++i0)if(previous=enterGroup[i0]){for(i0>=i1&&(i1=i0+1);!(next=updateGroup[i1])&&++i1<dataLength;);previous._next=next||null}}return(update=new Selection(update,parents))._enter=enter,update._exit=exit,update},enter:function(){return new Selection(this._enter||this._groups.map(sparse),this._parents)},exit:function(){return new Selection(this._exit||this._groups.map(sparse),this._parents)},join:function(onenter,onupdate,onexit){var enter=this.enter(),update=this,exit=this.exit();return enter="function"==typeof onenter?onenter(enter):enter.append(onenter+""),null!=onupdate&&(update=onupdate(update)),null==onexit?exit.remove():onexit(exit),enter&&update?enter.merge(update).order():update},merge:function(selection){if(!(selection instanceof Selection))throw new Error("invalid merge");for(var groups0=this._groups,groups1=selection._groups,m0=groups0.length,m1=groups1.length,m=Math.min(m0,m1),merges=new Array(m0),j=0;j<m;++j)for(var node,group0=groups0[j],group1=groups1[j],n=group0.length,merge=merges[j]=new Array(n),i=0;i<n;++i)(node=group0[i]||group1[i])&&(merge[i]=node);for(;j<m0;++j)merges[j]=groups0[j];return new Selection(merges,this._parents)},selection:function(){return this},order:function(){for(var groups=this._groups,j=-1,m=groups.length;++j<m;)for(var node,group=groups[j],i=group.length-1,next=group[i];--i>=0;)(node=group[i])&&(next&&4^node.compareDocumentPosition(next)&&next.parentNode.insertBefore(node,next),next=node);return this},sort:function(compare){function compareNode(a,b){return a&&b?compare(a.__data__,b.__data__):!a-!b}compare||(compare=ascending);for(var groups=this._groups,m=groups.length,sortgroups=new Array(m),j=0;j<m;++j){for(var node,group=groups[j],n=group.length,sortgroup=sortgroups[j]=new Array(n),i=0;i<n;++i)(node=group[i])&&(sortgroup[i]=node);sortgroup.sort(compareNode)}return new Selection(sortgroups,this._parents).order()},call:function(){var callback=arguments[0];return arguments[0]=this,callback.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var groups=this._groups,j=0,m=groups.length;j<m;++j)for(var group=groups[j],i=0,n=group.length;i<n;++i){var node=group[i];if(node)return node}return null},size:function(){let size=0;for(const node of this)++size;return size},empty:function(){return!this.node()},each:function(callback){for(var groups=this._groups,j=0,m=groups.length;j<m;++j)for(var node,group=groups[j],i=0,n=group.length;i<n;++i)(node=group[i])&&callback.call(node,node.__data__,i,group);return this},attr:function(name,value){var fullname=namespace(name);if(arguments.length<2){var node=this.node();return fullname.local?node.getAttributeNS(fullname.space,fullname.local):node.getAttribute(fullname)}return this.each((null==value?fullname.local?attrRemoveNS:attrRemove:"function"==typeof value?fullname.local?attrFunctionNS:attrFunction:fullname.local?attrConstantNS:attrConstant)(fullname,value))},style:function(name,value,priority){return arguments.length>1?this.each((null==value?styleRemove:"function"==typeof value?styleFunction:styleConstant)(name,value,null==priority?"":priority)):styleValue(this.node(),name)},property:function(name,value){return arguments.length>1?this.each((null==value?propertyRemove:"function"==typeof value?propertyFunction:propertyConstant)(name,value)):this.node()[name]},classed:function(name,value){var names=classArray(name+"");if(arguments.length<2){for(var list=classList(this.node()),i=-1,n=names.length;++i<n;)if(!list.contains(names[i]))return!1;return!0}return this.each(("function"==typeof value?classedFunction:value?classedTrue:classedFalse)(names,value))},text:function(value){return arguments.length?this.each(null==value?textRemove:("function"==typeof value?textFunction:textConstant)(value)):this.node().textContent},html:function(value){return arguments.length?this.each(null==value?htmlRemove:("function"==typeof value?htmlFunction:htmlConstant)(value)):this.node().innerHTML},raise:function(){return this.each(raise)},lower:function(){return this.each(lower)},append:function(name){var create="function"==typeof name?name:creator(name);return this.select((function(){return this.appendChild(create.apply(this,arguments))}))},insert:function(name,before){var create="function"==typeof name?name:creator(name),select=null==before?constantNull:"function"==typeof before?before:selector(before);return this.select((function(){return this.insertBefore(create.apply(this,arguments),select.apply(this,arguments)||null)}))},remove:function(){return this.each(remove)},clone:function(deep){return this.select(deep?selection_cloneDeep:selection_cloneShallow)},datum:function(value){return arguments.length?this.property("__data__",value):this.node().__data__},on:function(typename,value,options){var i,t,typenames=parseTypenames(typename+""),n=typenames.length;if(!(arguments.length<2)){for(on=value?onAdd:onRemove,i=0;i<n;++i)this.each(on(typenames[i],value,options));return this}var on=this.node().__on;if(on)for(var o,j=0,m=on.length;j<m;++j)for(i=0,o=on[j];i<n;++i)if((t=typenames[i]).type===o.type&&t.name===o.name)return o.value},dispatch:function(type,params){return this.each(("function"==typeof params?dispatchFunction:dispatchConstant)(type,params))},[Symbol.iterator]:function*(){for(var groups=this._groups,j=0,m=groups.length;j<m;++j)for(var node,group=groups[j],i=0,n=group.length;i<n;++i)(node=group[i])&&(yield node)}};const src_selection=selection;var noop={value:()=>{}};function dispatch_dispatch(){for(var t,i=0,n=arguments.length,_={};i<n;++i){if(!(t=arguments[i]+"")||t in _||/[\s.]/.test(t))throw new Error("illegal type: "+t);_[t]=[]}return new Dispatch(_)}function Dispatch(_){this._=_}function dispatch_parseTypenames(typenames,types){return typenames.trim().split(/^|\s+/).map((function(t){var name="",i=t.indexOf(".");if(i>=0&&(name=t.slice(i+1),t=t.slice(0,i)),t&&!types.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name}}))}function get(type,name){for(var c,i=0,n=type.length;i<n;++i)if((c=type[i]).name===name)return c.value}function set(type,name,callback){for(var i=0,n=type.length;i<n;++i)if(type[i].name===name){type[i]=noop,type=type.slice(0,i).concat(type.slice(i+1));break}return null!=callback&&type.push({name,value:callback}),type}Dispatch.prototype=dispatch_dispatch.prototype={constructor:Dispatch,on:function(typename,callback){var t,_=this._,T=dispatch_parseTypenames(typename+"",_),i=-1,n=T.length;if(!(arguments.length<2)){if(null!=callback&&"function"!=typeof callback)throw new Error("invalid callback: "+callback);for(;++i<n;)if(t=(typename=T[i]).type)_[t]=set(_[t],typename.name,callback);else if(null==callback)for(t in _)_[t]=set(_[t],typename.name,null);return this}for(;++i<n;)if((t=(typename=T[i]).type)&&(t=get(_[t],typename.name)))return t},copy:function(){var copy={},_=this._;for(var t in _)copy[t]=_[t].slice();return new Dispatch(copy)},call:function(type,that){if((n=arguments.length-2)>0)for(var n,t,args=new Array(n),i=0;i<n;++i)args[i]=arguments[i+2];if(!this._.hasOwnProperty(type))throw new Error("unknown type: "+type);for(i=0,n=(t=this._[type]).length;i<n;++i)t[i].value.apply(that,args)},apply:function(type,that,args){if(!this._.hasOwnProperty(type))throw new Error("unknown type: "+type);for(var t=this._[type],i=0,n=t.length;i<n;++i)t[i].value.apply(that,args)}};const src_dispatch=dispatch_dispatch;var taskHead,taskTail,timer_frame=0,timer_timeout=0,interval=0,clockLast=0,clockNow=0,clockSkew=0,clock="object"==typeof performance&&performance.now?performance:Date,setFrame="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(f){setTimeout(f,17)};function now(){return clockNow||(setFrame(clearNow),clockNow=clock.now()+clockSkew)}function clearNow(){clockNow=0}function Timer(){this._call=this._time=this._next=null}function timer(callback,delay,time){var t=new Timer;return t.restart(callback,delay,time),t}function wake(){clockNow=(clockLast=clock.now())+clockSkew,timer_frame=timer_timeout=0;try{!function(){now(),++timer_frame;for(var e,t=taskHead;t;)(e=clockNow-t._time)>=0&&t._call.call(null,e),t=t._next;--timer_frame}()}finally{timer_frame=0,function(){var t0,t2,t1=taskHead,time=1/0;for(;t1;)t1._call?(time>t1._time&&(time=t1._time),t0=t1,t1=t1._next):(t2=t1._next,t1._next=null,t1=t0?t0._next=t2:taskHead=t2);taskTail=t0,sleep(time)}(),clockNow=0}}function poke(){var now=clock.now(),delay=now-clockLast;delay>1e3&&(clockSkew-=delay,clockLast=now)}function sleep(time){timer_frame||(timer_timeout&&(timer_timeout=clearTimeout(timer_timeout)),time-clockNow>24?(time<1/0&&(timer_timeout=setTimeout(wake,time-clock.now()-clockSkew)),interval&&(interval=clearInterval(interval))):(interval||(clockLast=clock.now(),interval=setInterval(poke,1e3)),timer_frame=1,setFrame(wake)))}function src_timeout(callback,delay,time){var t=new Timer;return delay=null==delay?0:+delay,t.restart((elapsed=>{t.stop(),callback(elapsed+delay)}),delay,time),t}Timer.prototype=timer.prototype={constructor:Timer,restart:function(callback,delay,time){if("function"!=typeof callback)throw new TypeError("callback is not a function");time=(null==time?now():+time)+(null==delay?0:+delay),this._next||taskTail===this||(taskTail?taskTail._next=this:taskHead=this,taskTail=this),this._call=callback,this._time=time,sleep()},stop:function(){this._call&&(this._call=null,this._time=1/0,sleep())}};var emptyOn=src_dispatch("start","end","cancel","interrupt"),emptyTween=[];function schedule(node,name,id,index,group,timing){var schedules=node.__transition;if(schedules){if(id in schedules)return}else node.__transition={};!function(node,id,self){var tween,schedules=node.__transition;function schedule(elapsed){self.state=1,self.timer.restart(start,self.delay,self.time),self.delay<=elapsed&&start(elapsed-self.delay)}function start(elapsed){var i,j,n,o;if(1!==self.state)return stop();for(i in schedules)if((o=schedules[i]).name===self.name){if(3===o.state)return src_timeout(start);4===o.state?(o.state=6,o.timer.stop(),o.on.call("interrupt",node,node.__data__,o.index,o.group),delete schedules[i]):+i<id&&(o.state=6,o.timer.stop(),o.on.call("cancel",node,node.__data__,o.index,o.group),delete schedules[i])}if(src_timeout((function(){3===self.state&&(self.state=4,self.timer.restart(tick,self.delay,self.time),tick(elapsed))})),self.state=2,self.on.call("start",node,node.__data__,self.index,self.group),2===self.state){for(self.state=3,tween=new Array(n=self.tween.length),i=0,j=-1;i<n;++i)(o=self.tween[i].value.call(node,node.__data__,self.index,self.group))&&(tween[++j]=o);tween.length=j+1}}function tick(elapsed){for(var t=elapsed<self.duration?self.ease.call(null,elapsed/self.duration):(self.timer.restart(stop),self.state=5,1),i=-1,n=tween.length;++i<n;)tween[i].call(node,t);5===self.state&&(self.on.call("end",node,node.__data__,self.index,self.group),stop())}function stop(){for(var i in self.state=6,self.timer.stop(),delete schedules[id],schedules)return;delete node.__transition}schedules[id]=self,self.timer=timer(schedule,0,self.time)}(node,id,{name,index,group,on:emptyOn,tween:emptyTween,time:timing.time,delay:timing.delay,duration:timing.duration,ease:timing.ease,timer:null,state:0})}function init(node,id){var schedule=schedule_get(node,id);if(schedule.state>0)throw new Error("too late; already scheduled");return schedule}function schedule_set(node,id){var schedule=schedule_get(node,id);if(schedule.state>3)throw new Error("too late; already running");return schedule}function schedule_get(node,id){var schedule=node.__transition;if(!schedule||!(schedule=schedule[id]))throw new Error("transition not found");return schedule}function src_number(a,b){return a=+a,b=+b,function(t){return a*(1-t)+b*t}}var svgNode,degrees=180/Math.PI,decompose_identity={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function decompose(a,b,c,d,e,f){var scaleX,scaleY,skewX;return(scaleX=Math.sqrt(a*a+b*b))&&(a/=scaleX,b/=scaleX),(skewX=a*c+b*d)&&(c-=a*skewX,d-=b*skewX),(scaleY=Math.sqrt(c*c+d*d))&&(c/=scaleY,d/=scaleY,skewX/=scaleY),a*d<b*c&&(a=-a,b=-b,skewX=-skewX,scaleX=-scaleX),{translateX:e,translateY:f,rotate:Math.atan2(b,a)*degrees,skewX:Math.atan(skewX)*degrees,scaleX,scaleY}}function interpolateTransform(parse,pxComma,pxParen,degParen){function pop(s){return s.length?s.pop()+" ":""}return function(a,b){var s=[],q=[];return a=parse(a),b=parse(b),function(xa,ya,xb,yb,s,q){if(xa!==xb||ya!==yb){var i=s.push("translate(",null,pxComma,null,pxParen);q.push({i:i-4,x:src_number(xa,xb)},{i:i-2,x:src_number(ya,yb)})}else(xb||yb)&&s.push("translate("+xb+pxComma+yb+pxParen)}(a.translateX,a.translateY,b.translateX,b.translateY,s,q),function(a,b,s,q){a!==b?(a-b>180?b+=360:b-a>180&&(a+=360),q.push({i:s.push(pop(s)+"rotate(",null,degParen)-2,x:src_number(a,b)})):b&&s.push(pop(s)+"rotate("+b+degParen)}(a.rotate,b.rotate,s,q),function(a,b,s,q){a!==b?q.push({i:s.push(pop(s)+"skewX(",null,degParen)-2,x:src_number(a,b)}):b&&s.push(pop(s)+"skewX("+b+degParen)}(a.skewX,b.skewX,s,q),function(xa,ya,xb,yb,s,q){if(xa!==xb||ya!==yb){var i=s.push(pop(s)+"scale(",null,",",null,")");q.push({i:i-4,x:src_number(xa,xb)},{i:i-2,x:src_number(ya,yb)})}else 1===xb&&1===yb||s.push(pop(s)+"scale("+xb+","+yb+")")}(a.scaleX,a.scaleY,b.scaleX,b.scaleY,s,q),a=b=null,function(t){for(var o,i=-1,n=q.length;++i<n;)s[(o=q[i]).i]=o.x(t);return s.join("")}}}var interpolateTransformCss=interpolateTransform((function(value){const m=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(value+"");return m.isIdentity?decompose_identity:decompose(m.a,m.b,m.c,m.d,m.e,m.f)}),"px, ","px)","deg)"),interpolateTransformSvg=interpolateTransform((function(value){return null==value?decompose_identity:(svgNode||(svgNode=document.createElementNS("http://www.w3.org/2000/svg","g")),svgNode.setAttribute("transform",value),(value=svgNode.transform.baseVal.consolidate())?decompose((value=value.matrix).a,value.b,value.c,value.d,value.e,value.f):decompose_identity)}),", ",")",")");function tweenRemove(id,name){var tween0,tween1;return function(){var schedule=schedule_set(this,id),tween=schedule.tween;if(tween!==tween0)for(var i=0,n=(tween1=tween0=tween).length;i<n;++i)if(tween1[i].name===name){(tween1=tween1.slice()).splice(i,1);break}schedule.tween=tween1}}function tweenFunction(id,name,value){var tween0,tween1;if("function"!=typeof value)throw new Error;return function(){var schedule=schedule_set(this,id),tween=schedule.tween;if(tween!==tween0){tween1=(tween0=tween).slice();for(var t={name,value},i=0,n=tween1.length;i<n;++i)if(tween1[i].name===name){tween1[i]=t;break}i===n&&tween1.push(t)}schedule.tween=tween1}}function tweenValue(transition,name,value){var id=transition._id;return transition.each((function(){var schedule=schedule_set(this,id);(schedule.value||(schedule.value={}))[name]=value.apply(this,arguments)})),function(node){return schedule_get(node,id).value[name]}}function define(constructor,factory,prototype){constructor.prototype=factory.prototype=prototype,prototype.constructor=constructor}function extend(parent,definition){var prototype=Object.create(parent.prototype);for(var key in definition)prototype[key]=definition[key];return prototype}function Color(){}var brighter=1/.7,reI="\\s*([+-]?\\d+)\\s*",reN="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",reP="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",reHex=/^#([0-9a-f]{3,8})$/,reRgbInteger=new RegExp("^rgb\\("+[reI,reI,reI]+"\\)$"),reRgbPercent=new RegExp("^rgb\\("+[reP,reP,reP]+"\\)$"),reRgbaInteger=new RegExp("^rgba\\("+[reI,reI,reI,reN]+"\\)$"),reRgbaPercent=new RegExp("^rgba\\("+[reP,reP,reP,reN]+"\\)$"),reHslPercent=new RegExp("^hsl\\("+[reN,reP,reP]+"\\)$"),reHslaPercent=new RegExp("^hsla\\("+[reN,reP,reP,reN]+"\\)$"),named={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function color_formatHex(){return this.rgb().formatHex()}function color_formatRgb(){return this.rgb().formatRgb()}function color(format){var m,l;return format=(format+"").trim().toLowerCase(),(m=reHex.exec(format))?(l=m[1].length,m=parseInt(m[1],16),6===l?rgbn(m):3===l?new Rgb(m>>8&15|m>>4&240,m>>4&15|240&m,(15&m)<<4|15&m,1):8===l?rgba(m>>24&255,m>>16&255,m>>8&255,(255&m)/255):4===l?rgba(m>>12&15|m>>8&240,m>>8&15|m>>4&240,m>>4&15|240&m,((15&m)<<4|15&m)/255):null):(m=reRgbInteger.exec(format))?new Rgb(m[1],m[2],m[3],1):(m=reRgbPercent.exec(format))?new Rgb(255*m[1]/100,255*m[2]/100,255*m[3]/100,1):(m=reRgbaInteger.exec(format))?rgba(m[1],m[2],m[3],m[4]):(m=reRgbaPercent.exec(format))?rgba(255*m[1]/100,255*m[2]/100,255*m[3]/100,m[4]):(m=reHslPercent.exec(format))?hsla(m[1],m[2]/100,m[3]/100,1):(m=reHslaPercent.exec(format))?hsla(m[1],m[2]/100,m[3]/100,m[4]):named.hasOwnProperty(format)?rgbn(named[format]):"transparent"===format?new Rgb(NaN,NaN,NaN,0):null}function rgbn(n){return new Rgb(n>>16&255,n>>8&255,255&n,1)}function rgba(r,g,b,a){return a<=0&&(r=g=b=NaN),new Rgb(r,g,b,a)}function rgbConvert(o){return o instanceof Color||(o=color(o)),o?new Rgb((o=o.rgb()).r,o.g,o.b,o.opacity):new Rgb}function color_rgb(r,g,b,opacity){return 1===arguments.length?rgbConvert(r):new Rgb(r,g,b,null==opacity?1:opacity)}function Rgb(r,g,b,opacity){this.r=+r,this.g=+g,this.b=+b,this.opacity=+opacity}function rgb_formatHex(){return"#"+hex(this.r)+hex(this.g)+hex(this.b)}function rgb_formatRgb(){var a=this.opacity;return(1===(a=isNaN(a)?1:Math.max(0,Math.min(1,a)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===a?")":", "+a+")")}function hex(value){return((value=Math.max(0,Math.min(255,Math.round(value)||0)))<16?"0":"")+value.toString(16)}function hsla(h,s,l,a){return a<=0?h=s=l=NaN:l<=0||l>=1?h=s=NaN:s<=0&&(h=NaN),new Hsl(h,s,l,a)}function hslConvert(o){if(o instanceof Hsl)return new Hsl(o.h,o.s,o.l,o.opacity);if(o instanceof Color||(o=color(o)),!o)return new Hsl;if(o instanceof Hsl)return o;var r=(o=o.rgb()).r/255,g=o.g/255,b=o.b/255,min=Math.min(r,g,b),max=Math.max(r,g,b),h=NaN,s=max-min,l=(max+min)/2;return s?(h=r===max?(g-b)/s+6*(g<b):g===max?(b-r)/s+2:(r-g)/s+4,s/=l<.5?max+min:2-max-min,h*=60):s=l>0&&l<1?0:h,new Hsl(h,s,l,o.opacity)}function Hsl(h,s,l,opacity){this.h=+h,this.s=+s,this.l=+l,this.opacity=+opacity}function hsl2rgb(h,m1,m2){return 255*(h<60?m1+(m2-m1)*h/60:h<180?m2:h<240?m1+(m2-m1)*(240-h)/60:m1)}function basis(t1,v0,v1,v2,v3){var t2=t1*t1,t3=t2*t1;return((1-3*t1+3*t2-t3)*v0+(4-6*t2+3*t3)*v1+(1+3*t1+3*t2-3*t3)*v2+t3*v3)/6}define(Color,color,{copy:function(channels){return Object.assign(new this.constructor,this,channels)},displayable:function(){return this.rgb().displayable()},hex:color_formatHex,formatHex:color_formatHex,formatHsl:function(){return hslConvert(this).formatHsl()},formatRgb:color_formatRgb,toString:color_formatRgb}),define(Rgb,color_rgb,extend(Color,{brighter:function(k){return k=null==k?brighter:Math.pow(brighter,k),new Rgb(this.r*k,this.g*k,this.b*k,this.opacity)},darker:function(k){return k=null==k?.7:Math.pow(.7,k),new Rgb(this.r*k,this.g*k,this.b*k,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:rgb_formatHex,formatHex:rgb_formatHex,formatRgb:rgb_formatRgb,toString:rgb_formatRgb})),define(Hsl,(function(h,s,l,opacity){return 1===arguments.length?hslConvert(h):new Hsl(h,s,l,null==opacity?1:opacity)}),extend(Color,{brighter:function(k){return k=null==k?brighter:Math.pow(brighter,k),new Hsl(this.h,this.s,this.l*k,this.opacity)},darker:function(k){return k=null==k?.7:Math.pow(.7,k),new Hsl(this.h,this.s,this.l*k,this.opacity)},rgb:function(){var h=this.h%360+360*(this.h<0),s=isNaN(h)||isNaN(this.s)?0:this.s,l=this.l,m2=l+(l<.5?l:1-l)*s,m1=2*l-m2;return new Rgb(hsl2rgb(h>=240?h-240:h+120,m1,m2),hsl2rgb(h,m1,m2),hsl2rgb(h<120?h+240:h-120,m1,m2),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var a=this.opacity;return(1===(a=isNaN(a)?1:Math.max(0,Math.min(1,a)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===a?")":", "+a+")")}}));const d3_interpolate_src_constant=x=>()=>x;function linear(a,d){return function(t){return a+t*d}}function gamma(y){return 1==(y=+y)?nogamma:function(a,b){return b-a?function(a,b,y){return a=Math.pow(a,y),b=Math.pow(b,y)-a,y=1/y,function(t){return Math.pow(a+t*b,y)}}(a,b,y):d3_interpolate_src_constant(isNaN(a)?b:a)}}function nogamma(a,b){var d=b-a;return d?linear(a,d):d3_interpolate_src_constant(isNaN(a)?b:a)}const rgb=function rgbGamma(y){var color=gamma(y);function rgb(start,end){var r=color((start=color_rgb(start)).r,(end=color_rgb(end)).r),g=color(start.g,end.g),b=color(start.b,end.b),opacity=nogamma(start.opacity,end.opacity);return function(t){return start.r=r(t),start.g=g(t),start.b=b(t),start.opacity=opacity(t),start+""}}return rgb.gamma=rgbGamma,rgb}(1);function rgbSpline(spline){return function(colors){var i,color,n=colors.length,r=new Array(n),g=new Array(n),b=new Array(n);for(i=0;i<n;++i)color=color_rgb(colors[i]),r[i]=color.r||0,g[i]=color.g||0,b[i]=color.b||0;return r=spline(r),g=spline(g),b=spline(b),color.opacity=1,function(t){return color.r=r(t),color.g=g(t),color.b=b(t),color+""}}}var rgbBasis=rgbSpline((function(values){var n=values.length-1;return function(t){var i=t<=0?t=0:t>=1?(t=1,n-1):Math.floor(t*n),v1=values[i],v2=values[i+1],v0=i>0?values[i-1]:2*v1-v2,v3=i<n-1?values[i+2]:2*v2-v1;return basis((t-i/n)*n,v0,v1,v2,v3)}})),reA=(rgbSpline((function(values){var n=values.length;return function(t){var i=Math.floor(((t%=1)<0?++t:t)*n),v0=values[(i+n-1)%n],v1=values[i%n],v2=values[(i+1)%n],v3=values[(i+2)%n];return basis((t-i/n)*n,v0,v1,v2,v3)}})),/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g),reB=new RegExp(reA.source,"g");function string(a,b){var am,bm,bs,bi=reA.lastIndex=reB.lastIndex=0,i=-1,s=[],q=[];for(a+="",b+="";(am=reA.exec(a))&&(bm=reB.exec(b));)(bs=bm.index)>bi&&(bs=b.slice(bi,bs),s[i]?s[i]+=bs:s[++i]=bs),(am=am[0])===(bm=bm[0])?s[i]?s[i]+=bm:s[++i]=bm:(s[++i]=null,q.push({i,x:src_number(am,bm)})),bi=reB.lastIndex;return bi<b.length&&(bs=b.slice(bi),s[i]?s[i]+=bs:s[++i]=bs),s.length<2?q[0]?function(b){return function(t){return b(t)+""}}(q[0].x):function(b){return function(){return b}}(b):(b=q.length,function(t){for(var o,i=0;i<b;++i)s[(o=q[i]).i]=o.x(t);return s.join("")})}function transition_interpolate(a,b){var c;return("number"==typeof b?src_number:b instanceof color?rgb:(c=color(b))?(b=c,rgb):string)(a,b)}function attr_attrRemove(name){return function(){this.removeAttribute(name)}}function attr_attrRemoveNS(fullname){return function(){this.removeAttributeNS(fullname.space,fullname.local)}}function attr_attrConstant(name,interpolate,value1){var string00,interpolate0,string1=value1+"";return function(){var string0=this.getAttribute(name);return string0===string1?null:string0===string00?interpolate0:interpolate0=interpolate(string00=string0,value1)}}function attr_attrConstantNS(fullname,interpolate,value1){var string00,interpolate0,string1=value1+"";return function(){var string0=this.getAttributeNS(fullname.space,fullname.local);return string0===string1?null:string0===string00?interpolate0:interpolate0=interpolate(string00=string0,value1)}}function attr_attrFunction(name,interpolate,value){var string00,string10,interpolate0;return function(){var string0,string1,value1=value(this);if(null!=value1)return(string0=this.getAttribute(name))===(string1=value1+"")?null:string0===string00&&string1===string10?interpolate0:(string10=string1,interpolate0=interpolate(string00=string0,value1));this.removeAttribute(name)}}function attr_attrFunctionNS(fullname,interpolate,value){var string00,string10,interpolate0;return function(){var string0,string1,value1=value(this);if(null!=value1)return(string0=this.getAttributeNS(fullname.space,fullname.local))===(string1=value1+"")?null:string0===string00&&string1===string10?interpolate0:(string10=string1,interpolate0=interpolate(string00=string0,value1));this.removeAttributeNS(fullname.space,fullname.local)}}function attrInterpolate(name,i){return function(t){this.setAttribute(name,i.call(this,t))}}function attrInterpolateNS(fullname,i){return function(t){this.setAttributeNS(fullname.space,fullname.local,i.call(this,t))}}function attrTweenNS(fullname,value){var t0,i0;function tween(){var i=value.apply(this,arguments);return i!==i0&&(t0=(i0=i)&&attrInterpolateNS(fullname,i)),t0}return tween._value=value,tween}function attrTween(name,value){var t0,i0;function tween(){var i=value.apply(this,arguments);return i!==i0&&(t0=(i0=i)&&attrInterpolate(name,i)),t0}return tween._value=value,tween}function delayFunction(id,value){return function(){init(this,id).delay=+value.apply(this,arguments)}}function delayConstant(id,value){return value=+value,function(){init(this,id).delay=value}}function durationFunction(id,value){return function(){schedule_set(this,id).duration=+value.apply(this,arguments)}}function durationConstant(id,value){return value=+value,function(){schedule_set(this,id).duration=value}}function easeConstant(id,value){if("function"!=typeof value)throw new Error;return function(){schedule_set(this,id).ease=value}}function onFunction(id,name,listener){var on0,on1,sit=function(name){return(name+"").trim().split(/^|\s+/).every((function(t){var i=t.indexOf(".");return i>=0&&(t=t.slice(0,i)),!t||"start"===t}))}(name)?init:schedule_set;return function(){var schedule=sit(this,id),on=schedule.on;on!==on0&&(on1=(on0=on).copy()).on(name,listener),schedule.on=on1}}var selection_Selection=src_selection.prototype.constructor;function style_styleRemove(name){return function(){this.style.removeProperty(name)}}function styleInterpolate(name,i,priority){return function(t){this.style.setProperty(name,i.call(this,t),priority)}}function styleTween(name,value,priority){var t,i0;function tween(){var i=value.apply(this,arguments);return i!==i0&&(t=(i0=i)&&styleInterpolate(name,i,priority)),t}return tween._value=value,tween}function textInterpolate(i){return function(t){this.textContent=i.call(this,t)}}function textTween(value){var t0,i0;function tween(){var i=value.apply(this,arguments);return i!==i0&&(t0=(i0=i)&&textInterpolate(i)),t0}return tween._value=value,tween}var id=0;function transition_Transition(groups,parents,name,id){this._groups=groups,this._parents=parents,this._name=name,this._id=id}function newId(){return++id}var selection_prototype=src_selection.prototype;function cubicInOut(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}transition_Transition.prototype=function(name){return src_selection().transition(name)}.prototype={constructor:transition_Transition,select:function(select){var name=this._name,id=this._id;"function"!=typeof select&&(select=selector(select));for(var groups=this._groups,m=groups.length,subgroups=new Array(m),j=0;j<m;++j)for(var node,subnode,group=groups[j],n=group.length,subgroup=subgroups[j]=new Array(n),i=0;i<n;++i)(node=group[i])&&(subnode=select.call(node,node.__data__,i,group))&&("__data__"in node&&(subnode.__data__=node.__data__),subgroup[i]=subnode,schedule(subgroup[i],name,id,i,subgroup,schedule_get(node,id)));return new transition_Transition(subgroups,this._parents,name,id)},selectAll:function(select){var name=this._name,id=this._id;"function"!=typeof select&&(select=selectorAll(select));for(var groups=this._groups,m=groups.length,subgroups=[],parents=[],j=0;j<m;++j)for(var node,group=groups[j],n=group.length,i=0;i<n;++i)if(node=group[i]){for(var child,children=select.call(node,node.__data__,i,group),inherit=schedule_get(node,id),k=0,l=children.length;k<l;++k)(child=children[k])&&schedule(child,name,id,k,children,inherit);subgroups.push(children),parents.push(node)}return new transition_Transition(subgroups,parents,name,id)},filter:function(match){"function"!=typeof match&&(match=matcher(match));for(var groups=this._groups,m=groups.length,subgroups=new Array(m),j=0;j<m;++j)for(var node,group=groups[j],n=group.length,subgroup=subgroups[j]=[],i=0;i<n;++i)(node=group[i])&&match.call(node,node.__data__,i,group)&&subgroup.push(node);return new transition_Transition(subgroups,this._parents,this._name,this._id)},merge:function(transition){if(transition._id!==this._id)throw new Error;for(var groups0=this._groups,groups1=transition._groups,m0=groups0.length,m1=groups1.length,m=Math.min(m0,m1),merges=new Array(m0),j=0;j<m;++j)for(var node,group0=groups0[j],group1=groups1[j],n=group0.length,merge=merges[j]=new Array(n),i=0;i<n;++i)(node=group0[i]||group1[i])&&(merge[i]=node);for(;j<m0;++j)merges[j]=groups0[j];return new transition_Transition(merges,this._parents,this._name,this._id)},selection:function(){return new selection_Selection(this._groups,this._parents)},transition:function(){for(var name=this._name,id0=this._id,id1=newId(),groups=this._groups,m=groups.length,j=0;j<m;++j)for(var node,group=groups[j],n=group.length,i=0;i<n;++i)if(node=group[i]){var inherit=schedule_get(node,id0);schedule(node,name,id1,i,group,{time:inherit.time+inherit.delay+inherit.duration,delay:0,duration:inherit.duration,ease:inherit.ease})}return new transition_Transition(groups,this._parents,name,id1)},call:selection_prototype.call,nodes:selection_prototype.nodes,node:selection_prototype.node,size:selection_prototype.size,empty:selection_prototype.empty,each:selection_prototype.each,on:function(name,listener){var id=this._id;return arguments.length<2?schedule_get(this.node(),id).on.on(name):this.each(onFunction(id,name,listener))},attr:function(name,value){var fullname=namespace(name),i="transform"===fullname?interpolateTransformSvg:transition_interpolate;return this.attrTween(name,"function"==typeof value?(fullname.local?attr_attrFunctionNS:attr_attrFunction)(fullname,i,tweenValue(this,"attr."+name,value)):null==value?(fullname.local?attr_attrRemoveNS:attr_attrRemove)(fullname):(fullname.local?attr_attrConstantNS:attr_attrConstant)(fullname,i,value))},attrTween:function(name,value){var key="attr."+name;if(arguments.length<2)return(key=this.tween(key))&&key._value;if(null==value)return this.tween(key,null);if("function"!=typeof value)throw new Error;var fullname=namespace(name);return this.tween(key,(fullname.local?attrTweenNS:attrTween)(fullname,value))},style:function(name,value,priority){var i="transform"==(name+="")?interpolateTransformCss:transition_interpolate;return null==value?this.styleTween(name,function(name,interpolate){var string00,string10,interpolate0;return function(){var string0=styleValue(this,name),string1=(this.style.removeProperty(name),styleValue(this,name));return string0===string1?null:string0===string00&&string1===string10?interpolate0:interpolate0=interpolate(string00=string0,string10=string1)}}(name,i)).on("end.style."+name,style_styleRemove(name)):"function"==typeof value?this.styleTween(name,function(name,interpolate,value){var string00,string10,interpolate0;return function(){var string0=styleValue(this,name),value1=value(this),string1=value1+"";return null==value1&&(this.style.removeProperty(name),string1=value1=styleValue(this,name)),string0===string1?null:string0===string00&&string1===string10?interpolate0:(string10=string1,interpolate0=interpolate(string00=string0,value1))}}(name,i,tweenValue(this,"style."+name,value))).each(function(id,name){var on0,on1,listener0,remove,key="style."+name,event="end."+key;return function(){var schedule=schedule_set(this,id),on=schedule.on,listener=null==schedule.value[key]?remove||(remove=style_styleRemove(name)):void 0;on===on0&&listener0===listener||(on1=(on0=on).copy()).on(event,listener0=listener),schedule.on=on1}}(this._id,name)):this.styleTween(name,function(name,interpolate,value1){var string00,interpolate0,string1=value1+"";return function(){var string0=styleValue(this,name);return string0===string1?null:string0===string00?interpolate0:interpolate0=interpolate(string00=string0,value1)}}(name,i,value),priority).on("end.style."+name,null)},styleTween:function(name,value,priority){var key="style."+(name+="");if(arguments.length<2)return(key=this.tween(key))&&key._value;if(null==value)return this.tween(key,null);if("function"!=typeof value)throw new Error;return this.tween(key,styleTween(name,value,null==priority?"":priority))},text:function(value){return this.tween("text","function"==typeof value?function(value){return function(){var value1=value(this);this.textContent=null==value1?"":value1}}(tweenValue(this,"text",value)):function(value){return function(){this.textContent=value}}(null==value?"":value+""))},textTween:function(value){var key="text";if(arguments.length<1)return(key=this.tween(key))&&key._value;if(null==value)return this.tween(key,null);if("function"!=typeof value)throw new Error;return this.tween(key,textTween(value))},remove:function(){return this.on("end.remove",function(id){return function(){var parent=this.parentNode;for(var i in this.__transition)if(+i!==id)return;parent&&parent.removeChild(this)}}(this._id))},tween:function(name,value){var id=this._id;if(name+="",arguments.length<2){for(var t,tween=schedule_get(this.node(),id).tween,i=0,n=tween.length;i<n;++i)if((t=tween[i]).name===name)return t.value;return null}return this.each((null==value?tweenRemove:tweenFunction)(id,name,value))},delay:function(value){var id=this._id;return arguments.length?this.each(("function"==typeof value?delayFunction:delayConstant)(id,value)):schedule_get(this.node(),id).delay},duration:function(value){var id=this._id;return arguments.length?this.each(("function"==typeof value?durationFunction:durationConstant)(id,value)):schedule_get(this.node(),id).duration},ease:function(value){var id=this._id;return arguments.length?this.each(easeConstant(id,value)):schedule_get(this.node(),id).ease},easeVarying:function(value){if("function"!=typeof value)throw new Error;return this.each(function(id,value){return function(){var v=value.apply(this,arguments);if("function"!=typeof v)throw new Error;schedule_set(this,id).ease=v}}(this._id,value))},end:function(){var on0,on1,that=this,id=that._id,size=that.size();return new Promise((function(resolve,reject){var cancel={value:reject},end={value:function(){0==--size&&resolve()}};that.each((function(){var schedule=schedule_set(this,id),on=schedule.on;on!==on0&&((on1=(on0=on).copy())._.cancel.push(cancel),on1._.interrupt.push(cancel),on1._.end.push(end)),schedule.on=on1})),0===size&&resolve()}))},[Symbol.iterator]:selection_prototype[Symbol.iterator]};var defaultTiming={time:null,delay:0,duration:250,ease:cubicInOut};function inherit(node,id){for(var timing;!(timing=node.__transition)||!(timing=timing[id]);)if(!(node=node.parentNode))throw new Error(`transition ${id} not found`);return timing}src_selection.prototype.interrupt=function(name){return this.each((function(){!function(node,name){var schedule,active,i,schedules=node.__transition,empty=!0;if(schedules){for(i in name=null==name?null:name+"",schedules)(schedule=schedules[i]).name===name?(active=schedule.state>2&&schedule.state<5,schedule.state=6,schedule.timer.stop(),schedule.on.call(active?"interrupt":"cancel",node,node.__data__,schedule.index,schedule.group),delete schedules[i]):empty=!1;empty&&delete node.__transition}}(this,name)}))},src_selection.prototype.transition=function(name){var id,timing;name instanceof transition_Transition?(id=name._id,name=name._name):(id=newId(),(timing=defaultTiming).time=now(),name=null==name?null:name+"");for(var groups=this._groups,m=groups.length,j=0;j<m;++j)for(var node,group=groups[j],n=group.length,i=0;i<n;++i)(node=group[i])&&schedule(node,name,id,i,group,timing||inherit(node,id));return new transition_Transition(groups,this._parents,name,id)};const{abs,max,min}=Math;function number1(e){return[+e[0],+e[1]]}function number2(e){return[number1(e[0]),number1(e[1])]}["w","e"].map(type),["n","s"].map(type),["n","w","e","s","nw","ne","sw","se"].map(type);function type(t){return{type:t}}function formatDecimalParts(x,p){if((i=(x=p?x.toExponential(p-1):x.toExponential()).indexOf("e"))<0)return null;var i,coefficient=x.slice(0,i);return[coefficient.length>1?coefficient[0]+coefficient.slice(2):coefficient,+x.slice(i+1)]}function exponent(x){return(x=formatDecimalParts(Math.abs(x)))?x[1]:NaN}var prefixExponent,re=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function formatSpecifier(specifier){if(!(match=re.exec(specifier)))throw new Error("invalid format: "+specifier);var match;return new FormatSpecifier({fill:match[1],align:match[2],sign:match[3],symbol:match[4],zero:match[5],width:match[6],comma:match[7],precision:match[8]&&match[8].slice(1),trim:match[9],type:match[10]})}function FormatSpecifier(specifier){this.fill=void 0===specifier.fill?" ":specifier.fill+"",this.align=void 0===specifier.align?">":specifier.align+"",this.sign=void 0===specifier.sign?"-":specifier.sign+"",this.symbol=void 0===specifier.symbol?"":specifier.symbol+"",this.zero=!!specifier.zero,this.width=void 0===specifier.width?void 0:+specifier.width,this.comma=!!specifier.comma,this.precision=void 0===specifier.precision?void 0:+specifier.precision,this.trim=!!specifier.trim,this.type=void 0===specifier.type?"":specifier.type+""}function formatRounded(x,p){var d=formatDecimalParts(x,p);if(!d)return x+"";var coefficient=d[0],exponent=d[1];return exponent<0?"0."+new Array(-exponent).join("0")+coefficient:coefficient.length>exponent+1?coefficient.slice(0,exponent+1)+"."+coefficient.slice(exponent+1):coefficient+new Array(exponent-coefficient.length+2).join("0")}formatSpecifier.prototype=FormatSpecifier.prototype,FormatSpecifier.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const formatTypes={"%":(x,p)=>(100*x).toFixed(p),b:x=>Math.round(x).toString(2),c:x=>x+"",d:function(x){return Math.abs(x=Math.round(x))>=1e21?x.toLocaleString("en").replace(/,/g,""):x.toString(10)},e:(x,p)=>x.toExponential(p),f:(x,p)=>x.toFixed(p),g:(x,p)=>x.toPrecision(p),o:x=>Math.round(x).toString(8),p:(x,p)=>formatRounded(100*x,p),r:formatRounded,s:function(x,p){var d=formatDecimalParts(x,p);if(!d)return x+"";var coefficient=d[0],exponent=d[1],i=exponent-(prefixExponent=3*Math.max(-8,Math.min(8,Math.floor(exponent/3))))+1,n=coefficient.length;return i===n?coefficient:i>n?coefficient+new Array(i-n+1).join("0"):i>0?coefficient.slice(0,i)+"."+coefficient.slice(i):"0."+new Array(1-i).join("0")+formatDecimalParts(x,Math.max(0,p+i-1))[0]},X:x=>Math.round(x).toString(16).toUpperCase(),x:x=>Math.round(x).toString(16)};function d3_format_src_identity(x){return x}var defaultLocale_locale,defaultLocale_format,formatPrefix,map=Array.prototype.map,prefixes=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function locale(locale){var grouping,thousands,group=void 0===locale.grouping||void 0===locale.thousands?d3_format_src_identity:(grouping=map.call(locale.grouping,Number),thousands=locale.thousands+"",function(value,width){for(var i=value.length,t=[],j=0,g=grouping[0],length=0;i>0&&g>0&&(length+g+1>width&&(g=Math.max(1,width-length)),t.push(value.substring(i-=g,i+g)),!((length+=g+1)>width));)g=grouping[j=(j+1)%grouping.length];return t.reverse().join(thousands)}),currencyPrefix=void 0===locale.currency?"":locale.currency[0]+"",currencySuffix=void 0===locale.currency?"":locale.currency[1]+"",decimal=void 0===locale.decimal?".":locale.decimal+"",numerals=void 0===locale.numerals?d3_format_src_identity:function(numerals){return function(value){return value.replace(/[0-9]/g,(function(i){return numerals[+i]}))}}(map.call(locale.numerals,String)),percent=void 0===locale.percent?"%":locale.percent+"",minus=void 0===locale.minus?"−":locale.minus+"",nan=void 0===locale.nan?"NaN":locale.nan+"";function newFormat(specifier){var fill=(specifier=formatSpecifier(specifier)).fill,align=specifier.align,sign=specifier.sign,symbol=specifier.symbol,zero=specifier.zero,width=specifier.width,comma=specifier.comma,precision=specifier.precision,trim=specifier.trim,type=specifier.type;"n"===type?(comma=!0,type="g"):formatTypes[type]||(void 0===precision&&(precision=12),trim=!0,type="g"),(zero||"0"===fill&&"="===align)&&(zero=!0,fill="0",align="=");var prefix="$"===symbol?currencyPrefix:"#"===symbol&&/[boxX]/.test(type)?"0"+type.toLowerCase():"",suffix="$"===symbol?currencySuffix:/[%p]/.test(type)?percent:"",formatType=formatTypes[type],maybeSuffix=/[defgprs%]/.test(type);function format(value){var i,n,c,valuePrefix=prefix,valueSuffix=suffix;if("c"===type)valueSuffix=formatType(value)+valueSuffix,value="";else{var valueNegative=(value=+value)<0||1/value<0;if(value=isNaN(value)?nan:formatType(Math.abs(value),precision),trim&&(value=function(s){out:for(var i1,n=s.length,i=1,i0=-1;i<n;++i)switch(s[i]){case".":i0=i1=i;break;case"0":0===i0&&(i0=i),i1=i;break;default:if(!+s[i])break out;i0>0&&(i0=0)}return i0>0?s.slice(0,i0)+s.slice(i1+1):s}(value)),valueNegative&&0==+value&&"+"!==sign&&(valueNegative=!1),valuePrefix=(valueNegative?"("===sign?sign:minus:"-"===sign||"("===sign?"":sign)+valuePrefix,valueSuffix=("s"===type?prefixes[8+prefixExponent/3]:"")+valueSuffix+(valueNegative&&"("===sign?")":""),maybeSuffix)for(i=-1,n=value.length;++i<n;)if(48>(c=value.charCodeAt(i))||c>57){valueSuffix=(46===c?decimal+value.slice(i+1):value.slice(i))+valueSuffix,value=value.slice(0,i);break}}comma&&!zero&&(value=group(value,1/0));var length=valuePrefix.length+value.length+valueSuffix.length,padding=length<width?new Array(width-length+1).join(fill):"";switch(comma&&zero&&(value=group(padding+value,padding.length?width-valueSuffix.length:1/0),padding=""),align){case"<":value=valuePrefix+value+valueSuffix+padding;break;case"=":value=valuePrefix+padding+value+valueSuffix;break;case"^":value=padding.slice(0,length=padding.length>>1)+valuePrefix+value+valueSuffix+padding.slice(length);break;default:value=padding+valuePrefix+value+valueSuffix}return numerals(value)}return precision=void 0===precision?6:/[gprs]/.test(type)?Math.max(1,Math.min(21,precision)):Math.max(0,Math.min(20,precision)),format.toString=function(){return specifier+""},format}return{format:newFormat,formatPrefix:function(specifier,value){var f=newFormat(((specifier=formatSpecifier(specifier)).type="f",specifier)),e=3*Math.max(-8,Math.min(8,Math.floor(exponent(value)/3))),k=Math.pow(10,-e),prefix=prefixes[8+e/3];return function(value){return f(k*value)+prefix}}}}function round(a,b){return a=+a,b=+b,function(t){return Math.round(a*(1-t)+b*t)}}function range(start,stop,step){start=+start,stop=+stop,step=(n=arguments.length)<2?(stop=start,start=0,1):n<3?1:+step;for(var i=-1,n=0|Math.max(0,Math.ceil((stop-start)/step)),range=new Array(n);++i<n;)range[i]=start+i*step;return range}function initRange(domain,range){switch(arguments.length){case 0:break;case 1:this.range(domain);break;default:this.range(range).domain(domain)}return this}defaultLocale_locale=locale({thousands:",",grouping:[3],currency:["$",""]}),defaultLocale_format=defaultLocale_locale.format,formatPrefix=defaultLocale_locale.formatPrefix;const implicit=Symbol("implicit");function ordinal(){var index=new Map,domain=[],range=[],unknown=implicit;function scale(d){var key=d+"",i=index.get(key);if(!i){if(unknown!==implicit)return unknown;index.set(key,i=domain.push(d))}return range[(i-1)%range.length]}return scale.domain=function(_){if(!arguments.length)return domain.slice();domain=[],index=new Map;for(const value of _){const key=value+"";index.has(key)||index.set(key,domain.push(value))}return scale},scale.range=function(_){return arguments.length?(range=Array.from(_),scale):range.slice()},scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown},scale.copy=function(){return ordinal(domain,range).unknown(unknown)},initRange.apply(scale,arguments),scale}function band(){var step,bandwidth,scale=ordinal().unknown(void 0),domain=scale.domain,ordinalRange=scale.range,r0=0,r1=1,round=!1,paddingInner=0,paddingOuter=0,align=.5;function rescale(){var n=domain().length,reverse=r1<r0,start=reverse?r1:r0,stop=reverse?r0:r1;step=(stop-start)/Math.max(1,n-paddingInner+2*paddingOuter),round&&(step=Math.floor(step)),start+=(stop-start-step*(n-paddingInner))*align,bandwidth=step*(1-paddingInner),round&&(start=Math.round(start),bandwidth=Math.round(bandwidth));var values=range(n).map((function(i){return start+step*i}));return ordinalRange(reverse?values.reverse():values)}return delete scale.unknown,scale.domain=function(_){return arguments.length?(domain(_),rescale()):domain()},scale.range=function(_){return arguments.length?([r0,r1]=_,r0=+r0,r1=+r1,rescale()):[r0,r1]},scale.rangeRound=function(_){return[r0,r1]=_,r0=+r0,r1=+r1,round=!0,rescale()},scale.bandwidth=function(){return bandwidth},scale.step=function(){return step},scale.round=function(_){return arguments.length?(round=!!_,rescale()):round},scale.padding=function(_){return arguments.length?(paddingInner=Math.min(1,paddingOuter=+_),rescale()):paddingInner},scale.paddingInner=function(_){return arguments.length?(paddingInner=Math.min(1,_),rescale()):paddingInner},scale.paddingOuter=function(_){return arguments.length?(paddingOuter=+_,rescale()):paddingOuter},scale.align=function(_){return arguments.length?(align=Math.max(0,Math.min(1,_)),rescale()):align},scale.copy=function(){return band(domain(),[r0,r1]).round(round).paddingInner(paddingInner).paddingOuter(paddingOuter).align(align)},initRange.apply(rescale(),arguments)}var e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2);function ticks(start,stop,count){var reverse,n,ticks,step,i=-1;if(count=+count,(start=+start)===(stop=+stop)&&count>0)return[start];if((reverse=stop<start)&&(n=start,start=stop,stop=n),0===(step=tickIncrement(start,stop,count))||!isFinite(step))return[];if(step>0)for(start=Math.ceil(start/step),stop=Math.floor(stop/step),ticks=new Array(n=Math.ceil(stop-start+1));++i<n;)ticks[i]=(start+i)*step;else for(step=-step,start=Math.ceil(start*step),stop=Math.floor(stop*step),ticks=new Array(n=Math.ceil(stop-start+1));++i<n;)ticks[i]=(start+i)/step;return reverse&&ticks.reverse(),ticks}function tickIncrement(start,stop,count){var step=(stop-start)/Math.max(0,count),power=Math.floor(Math.log(step)/Math.LN10),error=step/Math.pow(10,power);return power>=0?(error>=e10?10:error>=e5?5:error>=e2?2:1)*Math.pow(10,power):-Math.pow(10,-power)/(error>=e10?10:error>=e5?5:error>=e2?2:1)}function tickStep(start,stop,count){var step0=Math.abs(stop-start)/Math.max(0,count),step1=Math.pow(10,Math.floor(Math.log(step0)/Math.LN10)),error=step0/step1;return error>=e10?step1*=10:error>=e5?step1*=5:error>=e2&&(step1*=2),stop<start?-step1:step1}function src_ascending(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}function bisector(f){let delta=f,compare=f;function left(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){const mid=lo+hi>>>1;compare(a[mid],x)<0?lo=mid+1:hi=mid}return lo}return 1===f.length&&(delta=(d,x)=>f(d)-x,compare=function(f){return(d,x)=>src_ascending(f(d),x)}(f)),{left,center:function(a,x,lo,hi){null==lo&&(lo=0),null==hi&&(hi=a.length);const i=left(a,x,lo,hi-1);return i>lo&&delta(a[i-1],x)>-delta(a[i],x)?i-1:i},right:function(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){const mid=lo+hi>>>1;compare(a[mid],x)>0?hi=mid:lo=mid+1}return lo}}}const ascendingBisect=bisector(src_ascending),bisectRight=ascendingBisect.right,bisect=(ascendingBisect.left,bisector((function(x){return null===x?NaN:+x})).center,bisectRight);function genericArray(a,b){var i,nb=b?b.length:0,na=a?Math.min(nb,a.length):0,x=new Array(na),c=new Array(nb);for(i=0;i<na;++i)x[i]=value(a[i],b[i]);for(;i<nb;++i)c[i]=b[i];return function(t){for(i=0;i<na;++i)c[i]=x[i](t);return c}}function src_date(a,b){var d=new Date;return a=+a,b=+b,function(t){return d.setTime(a*(1-t)+b*t),d}}function object(a,b){var k,i={},c={};for(k in null!==a&&"object"==typeof a||(a={}),null!==b&&"object"==typeof b||(b={}),b)k in a?i[k]=value(a[k],b[k]):c[k]=b[k];return function(t){for(k in i)c[k]=i[k](t);return c}}function src_numberArray(a,b){b||(b=[]);var i,n=a?Math.min(b.length,a.length):0,c=b.slice();return function(t){for(i=0;i<n;++i)c[i]=a[i]*(1-t)+b[i]*t;return c}}function value(a,b){var c,x,t=typeof b;return null==b||"boolean"===t?d3_interpolate_src_constant(b):("number"===t?src_number:"string"===t?(c=color(b))?(b=c,rgb):string:b instanceof color?rgb:b instanceof Date?src_date:(x=b,!ArrayBuffer.isView(x)||x instanceof DataView?Array.isArray(b)?genericArray:"function"!=typeof b.valueOf&&"function"!=typeof b.toString||isNaN(b)?object:src_number:src_numberArray))(a,b)}function number_number(x){return+x}var unit=[0,1];function continuous_identity(x){return x}function normalize(a,b){return(b-=a=+a)?function(x){return(x-a)/b}:(x=isNaN(b)?NaN:.5,function(){return x});var x}function bimap(domain,range,interpolate){var d0=domain[0],d1=domain[1],r0=range[0],r1=range[1];return d1<d0?(d0=normalize(d1,d0),r0=interpolate(r1,r0)):(d0=normalize(d0,d1),r0=interpolate(r0,r1)),function(x){return r0(d0(x))}}function polymap(domain,range,interpolate){var j=Math.min(domain.length,range.length)-1,d=new Array(j),r=new Array(j),i=-1;for(domain[j]<domain[0]&&(domain=domain.slice().reverse(),range=range.slice().reverse());++i<j;)d[i]=normalize(domain[i],domain[i+1]),r[i]=interpolate(range[i],range[i+1]);return function(x){var i=bisect(domain,x,1,j)-1;return r[i](d[i](x))}}function copy(source,target){return target.domain(source.domain()).range(source.range()).interpolate(source.interpolate()).clamp(source.clamp()).unknown(source.unknown())}function transformer(){var transform,untransform,unknown,piecewise,output,input,domain=unit,range=unit,interpolate=value,clamp=continuous_identity;function rescale(){var a,b,t,n=Math.min(domain.length,range.length);return clamp!==continuous_identity&&(a=domain[0],b=domain[n-1],a>b&&(t=a,a=b,b=t),clamp=function(x){return Math.max(a,Math.min(b,x))}),piecewise=n>2?polymap:bimap,output=input=null,scale}function scale(x){return isNaN(x=+x)?unknown:(output||(output=piecewise(domain.map(transform),range,interpolate)))(transform(clamp(x)))}return scale.invert=function(y){return clamp(untransform((input||(input=piecewise(range,domain.map(transform),src_number)))(y)))},scale.domain=function(_){return arguments.length?(domain=Array.from(_,number_number),rescale()):domain.slice()},scale.range=function(_){return arguments.length?(range=Array.from(_),rescale()):range.slice()},scale.rangeRound=function(_){return range=Array.from(_),interpolate=round,rescale()},scale.clamp=function(_){return arguments.length?(clamp=!!_||continuous_identity,rescale()):clamp!==continuous_identity},scale.interpolate=function(_){return arguments.length?(interpolate=_,rescale()):interpolate},scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown},function(t,u){return transform=t,untransform=u,rescale()}}function continuous(){return transformer()(continuous_identity,continuous_identity)}function tickFormat(start,stop,count,specifier){var precision,step=tickStep(start,stop,count);switch((specifier=formatSpecifier(null==specifier?",f":specifier)).type){case"s":var value=Math.max(Math.abs(start),Math.abs(stop));return null!=specifier.precision||isNaN(precision=function(step,value){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(exponent(value)/3)))-exponent(Math.abs(step)))}(step,value))||(specifier.precision=precision),formatPrefix(specifier,value);case"":case"e":case"g":case"p":case"r":null!=specifier.precision||isNaN(precision=function(step,max){return step=Math.abs(step),max=Math.abs(max)-step,Math.max(0,exponent(max)-exponent(step))+1}(step,Math.max(Math.abs(start),Math.abs(stop))))||(specifier.precision=precision-("e"===specifier.type));break;case"f":case"%":null!=specifier.precision||isNaN(precision=function(step){return Math.max(0,-exponent(Math.abs(step)))}(step))||(specifier.precision=precision-2*("%"===specifier.type))}return defaultLocale_format(specifier)}function linearish(scale){var domain=scale.domain;return scale.ticks=function(count){var d=domain();return ticks(d[0],d[d.length-1],null==count?10:count)},scale.tickFormat=function(count,specifier){var d=domain();return tickFormat(d[0],d[d.length-1],null==count?10:count,specifier)},scale.nice=function(count){null==count&&(count=10);var prestep,step,d=domain(),i0=0,i1=d.length-1,start=d[i0],stop=d[i1],maxIter=10;for(stop<start&&(step=start,start=stop,stop=step,step=i0,i0=i1,i1=step);maxIter-- >0;){if((step=tickIncrement(start,stop,count))===prestep)return d[i0]=start,d[i1]=stop,domain(d);if(step>0)start=Math.floor(start/step)*step,stop=Math.ceil(stop/step)*step;else{if(!(step<0))break;start=Math.ceil(start*step)/step,stop=Math.floor(stop*step)/step}prestep=step}return scale},scale}function src_linear_linear(){var scale=continuous();return scale.copy=function(){return copy(scale,src_linear_linear())},initRange.apply(scale,arguments),linearish(scale)}function nice(domain,interval){var t,i0=0,i1=(domain=domain.slice()).length-1,x0=domain[i0],x1=domain[i1];return x1<x0&&(t=i0,i0=i1,i1=t,t=x0,x0=x1,x1=t),domain[i0]=interval.floor(x0),domain[i1]=interval.ceil(x1),domain}function transformLog(x){return Math.log(x)}function transformExp(x){return Math.exp(x)}function transformLogn(x){return-Math.log(-x)}function transformExpn(x){return-Math.exp(-x)}function pow10(x){return isFinite(x)?+("1e"+x):x<0?0:x}function reflect(f){return function(x){return-f(-x)}}function loggish(transform){var logs,pows,scale=transform(transformLog,transformExp),domain=scale.domain,base=10;function rescale(){return logs=function(base){return base===Math.E?Math.log:10===base&&Math.log10||2===base&&Math.log2||(base=Math.log(base),function(x){return Math.log(x)/base})}(base),pows=function(base){return 10===base?pow10:base===Math.E?Math.exp:function(x){return Math.pow(base,x)}}(base),domain()[0]<0?(logs=reflect(logs),pows=reflect(pows),transform(transformLogn,transformExpn)):transform(transformLog,transformExp),scale}return scale.base=function(_){return arguments.length?(base=+_,rescale()):base},scale.domain=function(_){return arguments.length?(domain(_),rescale()):domain()},scale.ticks=function(count){var r,d=domain(),u=d[0],v=d[d.length-1];(r=v<u)&&(i=u,u=v,v=i);var p,k,t,i=logs(u),j=logs(v),n=null==count?10:+count,z=[];if(!(base%1)&&j-i<n){if(i=Math.floor(i),j=Math.ceil(j),u>0){for(;i<=j;++i)for(k=1,p=pows(i);k<base;++k)if(!((t=p*k)<u)){if(t>v)break;z.push(t)}}else for(;i<=j;++i)for(k=base-1,p=pows(i);k>=1;--k)if(!((t=p*k)<u)){if(t>v)break;z.push(t)}2*z.length<n&&(z=ticks(u,v,n))}else z=ticks(i,j,Math.min(j-i,n)).map(pows);return r?z.reverse():z},scale.tickFormat=function(count,specifier){if(null==specifier&&(specifier=10===base?".0e":","),"function"!=typeof specifier&&(specifier=defaultLocale_format(specifier)),count===1/0)return specifier;null==count&&(count=10);var k=Math.max(1,base*count/scale.ticks().length);return function(d){var i=d/pows(Math.round(logs(d)));return i*base<base-.5&&(i*=base),i<=k?specifier(d):""}},scale.nice=function(){return domain(nice(domain(),{floor:function(x){return pows(Math.floor(logs(x)))},ceil:function(x){return pows(Math.ceil(logs(x)))}}))},scale}function log_log(){var scale=loggish(transformer()).domain([1,10]);return scale.copy=function(){return copy(scale,log_log()).base(scale.base())},initRange.apply(scale,arguments),scale}var t0=new Date,t1=new Date;function newInterval(floori,offseti,count,field){function interval(date){return floori(date=0===arguments.length?new Date:new Date(+date)),date}return interval.floor=function(date){return floori(date=new Date(+date)),date},interval.ceil=function(date){return floori(date=new Date(date-1)),offseti(date,1),floori(date),date},interval.round=function(date){var d0=interval(date),d1=interval.ceil(date);return date-d0<d1-date?d0:d1},interval.offset=function(date,step){return offseti(date=new Date(+date),null==step?1:Math.floor(step)),date},interval.range=function(start,stop,step){var previous,range=[];if(start=interval.ceil(start),step=null==step?1:Math.floor(step),!(start<stop&&step>0))return range;do{range.push(previous=new Date(+start)),offseti(start,step),floori(start)}while(previous<start&&start<stop);return range},interval.filter=function(test){return newInterval((function(date){if(date>=date)for(;floori(date),!test(date);)date.setTime(date-1)}),(function(date,step){if(date>=date)if(step<0)for(;++step<=0;)for(;offseti(date,-1),!test(date););else for(;--step>=0;)for(;offseti(date,1),!test(date););}))},count&&(interval.count=function(start,end){return t0.setTime(+start),t1.setTime(+end),floori(t0),floori(t1),Math.floor(count(t0,t1))},interval.every=function(step){return step=Math.floor(step),isFinite(step)&&step>0?step>1?interval.filter(field?function(d){return field(d)%step==0}:function(d){return interval.count(0,d)%step==0}):interval:null}),interval}var year=newInterval((function(date){date.setMonth(0,1),date.setHours(0,0,0,0)}),(function(date,step){date.setFullYear(date.getFullYear()+step)}),(function(start,end){return end.getFullYear()-start.getFullYear()}),(function(date){return date.getFullYear()}));year.every=function(k){return isFinite(k=Math.floor(k))&&k>0?newInterval((function(date){date.setFullYear(Math.floor(date.getFullYear()/k)*k),date.setMonth(0,1),date.setHours(0,0,0,0)}),(function(date,step){date.setFullYear(date.getFullYear()+step*k)})):null};const src_year=year;year.range;var month=newInterval((function(date){date.setDate(1),date.setHours(0,0,0,0)}),(function(date,step){date.setMonth(date.getMonth()+step)}),(function(start,end){return end.getMonth()-start.getMonth()+12*(end.getFullYear()-start.getFullYear())}),(function(date){return date.getMonth()}));const src_month=month;month.range;function weekday(i){return newInterval((function(date){date.setDate(date.getDate()-(date.getDay()+7-i)%7),date.setHours(0,0,0,0)}),(function(date,step){date.setDate(date.getDate()+7*step)}),(function(start,end){return(end-start-6e4*(end.getTimezoneOffset()-start.getTimezoneOffset()))/6048e5}))}var sunday=weekday(0),monday=weekday(1),tuesday=weekday(2),wednesday=weekday(3),thursday=weekday(4),friday=weekday(5),saturday=weekday(6),day=(sunday.range,monday.range,tuesday.range,wednesday.range,thursday.range,friday.range,saturday.range,newInterval((date=>date.setHours(0,0,0,0)),((date,step)=>date.setDate(date.getDate()+step)),((start,end)=>(end-start-6e4*(end.getTimezoneOffset()-start.getTimezoneOffset()))/864e5),(date=>date.getDate()-1)));const src_day=day;day.range;var hour=newInterval((function(date){date.setTime(date-date.getMilliseconds()-1e3*date.getSeconds()-6e4*date.getMinutes())}),(function(date,step){date.setTime(+date+36e5*step)}),(function(start,end){return(end-start)/36e5}),(function(date){return date.getHours()}));const src_hour=hour;hour.range;var minute=newInterval((function(date){date.setTime(date-date.getMilliseconds()-1e3*date.getSeconds())}),(function(date,step){date.setTime(+date+6e4*step)}),(function(start,end){return(end-start)/6e4}),(function(date){return date.getMinutes()}));const src_minute=minute;minute.range;var second=newInterval((function(date){date.setTime(date-date.getMilliseconds())}),(function(date,step){date.setTime(+date+1e3*step)}),(function(start,end){return(end-start)/1e3}),(function(date){return date.getUTCSeconds()}));const src_second=second;second.range;var millisecond=newInterval((function(){}),(function(date,step){date.setTime(+date+step)}),(function(start,end){return end-start}));millisecond.every=function(k){return k=Math.floor(k),isFinite(k)&&k>0?k>1?newInterval((function(date){date.setTime(Math.floor(date/k)*k)}),(function(date,step){date.setTime(+date+step*k)}),(function(start,end){return(end-start)/k})):millisecond:null};const src_millisecond=millisecond;millisecond.range;function utcWeekday(i){return newInterval((function(date){date.setUTCDate(date.getUTCDate()-(date.getUTCDay()+7-i)%7),date.setUTCHours(0,0,0,0)}),(function(date,step){date.setUTCDate(date.getUTCDate()+7*step)}),(function(start,end){return(end-start)/6048e5}))}var utcSunday=utcWeekday(0),utcMonday=utcWeekday(1),utcTuesday=utcWeekday(2),utcWednesday=utcWeekday(3),utcThursday=utcWeekday(4),utcFriday=utcWeekday(5),utcSaturday=utcWeekday(6),utcDay=(utcSunday.range,utcMonday.range,utcTuesday.range,utcWednesday.range,utcThursday.range,utcFriday.range,utcSaturday.range,newInterval((function(date){date.setUTCHours(0,0,0,0)}),(function(date,step){date.setUTCDate(date.getUTCDate()+step)}),(function(start,end){return(end-start)/864e5}),(function(date){return date.getUTCDate()-1})));const src_utcDay=utcDay;utcDay.range;var utcYear=newInterval((function(date){date.setUTCMonth(0,1),date.setUTCHours(0,0,0,0)}),(function(date,step){date.setUTCFullYear(date.getUTCFullYear()+step)}),(function(start,end){return end.getUTCFullYear()-start.getUTCFullYear()}),(function(date){return date.getUTCFullYear()}));utcYear.every=function(k){return isFinite(k=Math.floor(k))&&k>0?newInterval((function(date){date.setUTCFullYear(Math.floor(date.getUTCFullYear()/k)*k),date.setUTCMonth(0,1),date.setUTCHours(0,0,0,0)}),(function(date,step){date.setUTCFullYear(date.getUTCFullYear()+step*k)})):null};const src_utcYear=utcYear;utcYear.range;function localDate(d){if(0<=d.y&&d.y<100){var date=new Date(-1,d.m,d.d,d.H,d.M,d.S,d.L);return date.setFullYear(d.y),date}return new Date(d.y,d.m,d.d,d.H,d.M,d.S,d.L)}function utcDate(d){if(0<=d.y&&d.y<100){var date=new Date(Date.UTC(-1,d.m,d.d,d.H,d.M,d.S,d.L));return date.setUTCFullYear(d.y),date}return new Date(Date.UTC(d.y,d.m,d.d,d.H,d.M,d.S,d.L))}function newDate(y,m,d){return{y,m,d,H:0,M:0,S:0,L:0}}var src_defaultLocale_locale,timeFormat,pads={"-":"",_:" ",0:"0"},numberRe=/^\s*\d+/,percentRe=/^%/,requoteRe=/[\\^$*+?|[\]().{}]/g;function pad(value,fill,width){var sign=value<0?"-":"",string=(sign?-value:value)+"",length=string.length;return sign+(length<width?new Array(width-length+1).join(fill)+string:string)}function requote(s){return s.replace(requoteRe,"\\$&")}function formatRe(names){return new RegExp("^(?:"+names.map(requote).join("|")+")","i")}function formatLookup(names){return new Map(names.map(((name,i)=>[name.toLowerCase(),i])))}function parseWeekdayNumberSunday(d,string,i){var n=numberRe.exec(string.slice(i,i+1));return n?(d.w=+n[0],i+n[0].length):-1}function parseWeekdayNumberMonday(d,string,i){var n=numberRe.exec(string.slice(i,i+1));return n?(d.u=+n[0],i+n[0].length):-1}function parseWeekNumberSunday(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.U=+n[0],i+n[0].length):-1}function parseWeekNumberISO(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.V=+n[0],i+n[0].length):-1}function parseWeekNumberMonday(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.W=+n[0],i+n[0].length):-1}function parseFullYear(d,string,i){var n=numberRe.exec(string.slice(i,i+4));return n?(d.y=+n[0],i+n[0].length):-1}function parseYear(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.y=+n[0]+(+n[0]>68?1900:2e3),i+n[0].length):-1}function parseZone(d,string,i){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(string.slice(i,i+6));return n?(d.Z=n[1]?0:-(n[2]+(n[3]||"00")),i+n[0].length):-1}function parseQuarter(d,string,i){var n=numberRe.exec(string.slice(i,i+1));return n?(d.q=3*n[0]-3,i+n[0].length):-1}function parseMonthNumber(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.m=n[0]-1,i+n[0].length):-1}function parseDayOfMonth(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.d=+n[0],i+n[0].length):-1}function parseDayOfYear(d,string,i){var n=numberRe.exec(string.slice(i,i+3));return n?(d.m=0,d.d=+n[0],i+n[0].length):-1}function parseHour24(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.H=+n[0],i+n[0].length):-1}function parseMinutes(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.M=+n[0],i+n[0].length):-1}function parseSeconds(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.S=+n[0],i+n[0].length):-1}function parseMilliseconds(d,string,i){var n=numberRe.exec(string.slice(i,i+3));return n?(d.L=+n[0],i+n[0].length):-1}function parseMicroseconds(d,string,i){var n=numberRe.exec(string.slice(i,i+6));return n?(d.L=Math.floor(n[0]/1e3),i+n[0].length):-1}function parseLiteralPercent(d,string,i){var n=percentRe.exec(string.slice(i,i+1));return n?i+n[0].length:-1}function parseUnixTimestamp(d,string,i){var n=numberRe.exec(string.slice(i));return n?(d.Q=+n[0],i+n[0].length):-1}function parseUnixTimestampSeconds(d,string,i){var n=numberRe.exec(string.slice(i));return n?(d.s=+n[0],i+n[0].length):-1}function formatDayOfMonth(d,p){return pad(d.getDate(),p,2)}function formatHour24(d,p){return pad(d.getHours(),p,2)}function formatHour12(d,p){return pad(d.getHours()%12||12,p,2)}function formatDayOfYear(d,p){return pad(1+src_day.count(src_year(d),d),p,3)}function formatMilliseconds(d,p){return pad(d.getMilliseconds(),p,3)}function formatMicroseconds(d,p){return formatMilliseconds(d,p)+"000"}function formatMonthNumber(d,p){return pad(d.getMonth()+1,p,2)}function formatMinutes(d,p){return pad(d.getMinutes(),p,2)}function formatSeconds(d,p){return pad(d.getSeconds(),p,2)}function formatWeekdayNumberMonday(d){var day=d.getDay();return 0===day?7:day}function formatWeekNumberSunday(d,p){return pad(sunday.count(src_year(d)-1,d),p,2)}function dISO(d){var day=d.getDay();return day>=4||0===day?thursday(d):thursday.ceil(d)}function formatWeekNumberISO(d,p){return d=dISO(d),pad(thursday.count(src_year(d),d)+(4===src_year(d).getDay()),p,2)}function formatWeekdayNumberSunday(d){return d.getDay()}function formatWeekNumberMonday(d,p){return pad(monday.count(src_year(d)-1,d),p,2)}function formatYear(d,p){return pad(d.getFullYear()%100,p,2)}function formatYearISO(d,p){return pad((d=dISO(d)).getFullYear()%100,p,2)}function formatFullYear(d,p){return pad(d.getFullYear()%1e4,p,4)}function formatFullYearISO(d,p){var day=d.getDay();return pad((d=day>=4||0===day?thursday(d):thursday.ceil(d)).getFullYear()%1e4,p,4)}function formatZone(d){var z=d.getTimezoneOffset();return(z>0?"-":(z*=-1,"+"))+pad(z/60|0,"0",2)+pad(z%60,"0",2)}function formatUTCDayOfMonth(d,p){return pad(d.getUTCDate(),p,2)}function formatUTCHour24(d,p){return pad(d.getUTCHours(),p,2)}function formatUTCHour12(d,p){return pad(d.getUTCHours()%12||12,p,2)}function formatUTCDayOfYear(d,p){return pad(1+src_utcDay.count(src_utcYear(d),d),p,3)}function formatUTCMilliseconds(d,p){return pad(d.getUTCMilliseconds(),p,3)}function formatUTCMicroseconds(d,p){return formatUTCMilliseconds(d,p)+"000"}function formatUTCMonthNumber(d,p){return pad(d.getUTCMonth()+1,p,2)}function formatUTCMinutes(d,p){return pad(d.getUTCMinutes(),p,2)}function formatUTCSeconds(d,p){return pad(d.getUTCSeconds(),p,2)}function formatUTCWeekdayNumberMonday(d){var dow=d.getUTCDay();return 0===dow?7:dow}function formatUTCWeekNumberSunday(d,p){return pad(utcSunday.count(src_utcYear(d)-1,d),p,2)}function UTCdISO(d){var day=d.getUTCDay();return day>=4||0===day?utcThursday(d):utcThursday.ceil(d)}function formatUTCWeekNumberISO(d,p){return d=UTCdISO(d),pad(utcThursday.count(src_utcYear(d),d)+(4===src_utcYear(d).getUTCDay()),p,2)}function formatUTCWeekdayNumberSunday(d){return d.getUTCDay()}function formatUTCWeekNumberMonday(d,p){return pad(utcMonday.count(src_utcYear(d)-1,d),p,2)}function formatUTCYear(d,p){return pad(d.getUTCFullYear()%100,p,2)}function formatUTCYearISO(d,p){return pad((d=UTCdISO(d)).getUTCFullYear()%100,p,2)}function formatUTCFullYear(d,p){return pad(d.getUTCFullYear()%1e4,p,4)}function formatUTCFullYearISO(d,p){var day=d.getUTCDay();return pad((d=day>=4||0===day?utcThursday(d):utcThursday.ceil(d)).getUTCFullYear()%1e4,p,4)}function formatUTCZone(){return"+0000"}function formatLiteralPercent(){return"%"}function formatUnixTimestamp(d){return+d}function formatUnixTimestampSeconds(d){return Math.floor(+d/1e3)}!function(definition){src_defaultLocale_locale=function(locale){var locale_dateTime=locale.dateTime,locale_date=locale.date,locale_time=locale.time,locale_periods=locale.periods,locale_weekdays=locale.days,locale_shortWeekdays=locale.shortDays,locale_months=locale.months,locale_shortMonths=locale.shortMonths,periodRe=formatRe(locale_periods),periodLookup=formatLookup(locale_periods),weekdayRe=formatRe(locale_weekdays),weekdayLookup=formatLookup(locale_weekdays),shortWeekdayRe=formatRe(locale_shortWeekdays),shortWeekdayLookup=formatLookup(locale_shortWeekdays),monthRe=formatRe(locale_months),monthLookup=formatLookup(locale_months),shortMonthRe=formatRe(locale_shortMonths),shortMonthLookup=formatLookup(locale_shortMonths),formats={a:function(d){return locale_shortWeekdays[d.getDay()]},A:function(d){return locale_weekdays[d.getDay()]},b:function(d){return locale_shortMonths[d.getMonth()]},B:function(d){return locale_months[d.getMonth()]},c:null,d:formatDayOfMonth,e:formatDayOfMonth,f:formatMicroseconds,g:formatYearISO,G:formatFullYearISO,H:formatHour24,I:formatHour12,j:formatDayOfYear,L:formatMilliseconds,m:formatMonthNumber,M:formatMinutes,p:function(d){return locale_periods[+(d.getHours()>=12)]},q:function(d){return 1+~~(d.getMonth()/3)},Q:formatUnixTimestamp,s:formatUnixTimestampSeconds,S:formatSeconds,u:formatWeekdayNumberMonday,U:formatWeekNumberSunday,V:formatWeekNumberISO,w:formatWeekdayNumberSunday,W:formatWeekNumberMonday,x:null,X:null,y:formatYear,Y:formatFullYear,Z:formatZone,"%":formatLiteralPercent},utcFormats={a:function(d){return locale_shortWeekdays[d.getUTCDay()]},A:function(d){return locale_weekdays[d.getUTCDay()]},b:function(d){return locale_shortMonths[d.getUTCMonth()]},B:function(d){return locale_months[d.getUTCMonth()]},c:null,d:formatUTCDayOfMonth,e:formatUTCDayOfMonth,f:formatUTCMicroseconds,g:formatUTCYearISO,G:formatUTCFullYearISO,H:formatUTCHour24,I:formatUTCHour12,j:formatUTCDayOfYear,L:formatUTCMilliseconds,m:formatUTCMonthNumber,M:formatUTCMinutes,p:function(d){return locale_periods[+(d.getUTCHours()>=12)]},q:function(d){return 1+~~(d.getUTCMonth()/3)},Q:formatUnixTimestamp,s:formatUnixTimestampSeconds,S:formatUTCSeconds,u:formatUTCWeekdayNumberMonday,U:formatUTCWeekNumberSunday,V:formatUTCWeekNumberISO,w:formatUTCWeekdayNumberSunday,W:formatUTCWeekNumberMonday,x:null,X:null,y:formatUTCYear,Y:formatUTCFullYear,Z:formatUTCZone,"%":formatLiteralPercent},parses={a:function(d,string,i){var n=shortWeekdayRe.exec(string.slice(i));return n?(d.w=shortWeekdayLookup.get(n[0].toLowerCase()),i+n[0].length):-1},A:function(d,string,i){var n=weekdayRe.exec(string.slice(i));return n?(d.w=weekdayLookup.get(n[0].toLowerCase()),i+n[0].length):-1},b:function(d,string,i){var n=shortMonthRe.exec(string.slice(i));return n?(d.m=shortMonthLookup.get(n[0].toLowerCase()),i+n[0].length):-1},B:function(d,string,i){var n=monthRe.exec(string.slice(i));return n?(d.m=monthLookup.get(n[0].toLowerCase()),i+n[0].length):-1},c:function(d,string,i){return parseSpecifier(d,locale_dateTime,string,i)},d:parseDayOfMonth,e:parseDayOfMonth,f:parseMicroseconds,g:parseYear,G:parseFullYear,H:parseHour24,I:parseHour24,j:parseDayOfYear,L:parseMilliseconds,m:parseMonthNumber,M:parseMinutes,p:function(d,string,i){var n=periodRe.exec(string.slice(i));return n?(d.p=periodLookup.get(n[0].toLowerCase()),i+n[0].length):-1},q:parseQuarter,Q:parseUnixTimestamp,s:parseUnixTimestampSeconds,S:parseSeconds,u:parseWeekdayNumberMonday,U:parseWeekNumberSunday,V:parseWeekNumberISO,w:parseWeekdayNumberSunday,W:parseWeekNumberMonday,x:function(d,string,i){return parseSpecifier(d,locale_date,string,i)},X:function(d,string,i){return parseSpecifier(d,locale_time,string,i)},y:parseYear,Y:parseFullYear,Z:parseZone,"%":parseLiteralPercent};function newFormat(specifier,formats){return function(date){var c,pad,format,string=[],i=-1,j=0,n=specifier.length;for(date instanceof Date||(date=new Date(+date));++i<n;)37===specifier.charCodeAt(i)&&(string.push(specifier.slice(j,i)),null!=(pad=pads[c=specifier.charAt(++i)])?c=specifier.charAt(++i):pad="e"===c?" ":"0",(format=formats[c])&&(c=format(date,pad)),string.push(c),j=i+1);return string.push(specifier.slice(j,i)),string.join("")}}function newParse(specifier,Z){return function(string){var week,day,d=newDate(1900,void 0,1);if(parseSpecifier(d,specifier,string+="",0)!=string.length)return null;if("Q"in d)return new Date(d.Q);if("s"in d)return new Date(1e3*d.s+("L"in d?d.L:0));if(Z&&!("Z"in d)&&(d.Z=0),"p"in d&&(d.H=d.H%12+12*d.p),void 0===d.m&&(d.m="q"in d?d.q:0),"V"in d){if(d.V<1||d.V>53)return null;"w"in d||(d.w=1),"Z"in d?(day=(week=utcDate(newDate(d.y,0,1))).getUTCDay(),week=day>4||0===day?utcMonday.ceil(week):utcMonday(week),week=src_utcDay.offset(week,7*(d.V-1)),d.y=week.getUTCFullYear(),d.m=week.getUTCMonth(),d.d=week.getUTCDate()+(d.w+6)%7):(day=(week=localDate(newDate(d.y,0,1))).getDay(),week=day>4||0===day?monday.ceil(week):monday(week),week=src_day.offset(week,7*(d.V-1)),d.y=week.getFullYear(),d.m=week.getMonth(),d.d=week.getDate()+(d.w+6)%7)}else("W"in d||"U"in d)&&("w"in d||(d.w="u"in d?d.u%7:"W"in d?1:0),day="Z"in d?utcDate(newDate(d.y,0,1)).getUTCDay():localDate(newDate(d.y,0,1)).getDay(),d.m=0,d.d="W"in d?(d.w+6)%7+7*d.W-(day+5)%7:d.w+7*d.U-(day+6)%7);return"Z"in d?(d.H+=d.Z/100|0,d.M+=d.Z%100,utcDate(d)):localDate(d)}}function parseSpecifier(d,specifier,string,j){for(var c,parse,i=0,n=specifier.length,m=string.length;i<n;){if(j>=m)return-1;if(37===(c=specifier.charCodeAt(i++))){if(c=specifier.charAt(i++),!(parse=parses[c in pads?specifier.charAt(i++):c])||(j=parse(d,string,j))<0)return-1}else if(c!=string.charCodeAt(j++))return-1}return j}return formats.x=newFormat(locale_date,formats),formats.X=newFormat(locale_time,formats),formats.c=newFormat(locale_dateTime,formats),utcFormats.x=newFormat(locale_date,utcFormats),utcFormats.X=newFormat(locale_time,utcFormats),utcFormats.c=newFormat(locale_dateTime,utcFormats),{format:function(specifier){var f=newFormat(specifier+="",formats);return f.toString=function(){return specifier},f},parse:function(specifier){var p=newParse(specifier+="",!1);return p.toString=function(){return specifier},p},utcFormat:function(specifier){var f=newFormat(specifier+="",utcFormats);return f.toString=function(){return specifier},f},utcParse:function(specifier){var p=newParse(specifier+="",!0);return p.toString=function(){return specifier},p}}}(definition),timeFormat=src_defaultLocale_locale.format,src_defaultLocale_locale.parse,src_defaultLocale_locale.utcFormat,src_defaultLocale_locale.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function time_date(t){return new Date(t)}function time_number(t){return t instanceof Date?+t:+new Date(+t)}function calendar(year,month,week,day,hour,minute,second,millisecond,format){var scale=continuous(),invert=scale.invert,domain=scale.domain,formatMillisecond=format(".%L"),formatSecond=format(":%S"),formatMinute=format("%I:%M"),formatHour=format("%I %p"),formatDay=format("%a %d"),formatWeek=format("%b %d"),formatMonth=format("%B"),formatYear=format("%Y"),tickIntervals=[[second,1,1e3],[second,5,5e3],[second,15,15e3],[second,30,3e4],[minute,1,6e4],[minute,5,3e5],[minute,15,9e5],[minute,30,18e5],[hour,1,36e5],[hour,3,108e5],[hour,6,216e5],[hour,12,432e5],[day,1,864e5],[day,2,1728e5],[week,1,6048e5],[month,1,2592e6],[month,3,7776e6],[year,1,31536e6]];function tickFormat(date){return(second(date)<date?formatMillisecond:minute(date)<date?formatSecond:hour(date)<date?formatMinute:day(date)<date?formatHour:month(date)<date?week(date)<date?formatDay:formatWeek:year(date)<date?formatMonth:formatYear)(date)}function tickInterval(interval,start,stop){if(null==interval&&(interval=10),"number"==typeof interval){var step,target=Math.abs(stop-start)/interval,i=bisector((function(i){return i[2]})).right(tickIntervals,target);return i===tickIntervals.length?(step=tickStep(start/31536e6,stop/31536e6,interval),interval=year):i?(step=(i=tickIntervals[target/tickIntervals[i-1][2]<tickIntervals[i][2]/target?i-1:i])[1],interval=i[0]):(step=Math.max(tickStep(start,stop,interval),1),interval=millisecond),interval.every(step)}return interval}return scale.invert=function(y){return new Date(invert(y))},scale.domain=function(_){return arguments.length?domain(Array.from(_,time_number)):domain().map(time_date)},scale.ticks=function(interval){var t,d=domain(),t0=d[0],t1=d[d.length-1],r=t1<t0;return r&&(t=t0,t0=t1,t1=t),t=(t=tickInterval(interval,t0,t1))?t.range(t0,t1+1):[],r?t.reverse():t},scale.tickFormat=function(count,specifier){return null==specifier?tickFormat:format(specifier)},scale.nice=function(interval){var d=domain();return(interval=tickInterval(interval,d[0],d[d.length-1]))?domain(nice(d,interval)):scale},scale.copy=function(){return copy(scale,calendar(year,month,week,day,hour,minute,second,millisecond,format))},scale}function colors(specifier){for(var n=specifier.length/6|0,colors=new Array(n),i=0;i<n;)colors[i]="#"+specifier.slice(6*i,6*++i);return colors}const category10=colors("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),Dark2=colors("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666"),ramp=scheme=>rgbBasis(scheme[scheme.length-1]);const Blues=ramp(new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(colors));const Greens=ramp(new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(colors));const Greys=ramp(new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(colors));const Purples=ramp(new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(colors));const Reds=ramp(new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(colors));const Oranges=ramp(new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(colors));function src_select(selector){return"string"==typeof selector?new Selection([[document.querySelector(selector)]],[document.documentElement]):new Selection([[selector]],root)}const pi=Math.PI,tau=2*pi,tauEpsilon=tau-1e-6;function Path(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function path(){return new Path}Path.prototype=path.prototype={constructor:Path,moveTo:function(x,y){this._+="M"+(this._x0=this._x1=+x)+","+(this._y0=this._y1=+y)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(x,y){this._+="L"+(this._x1=+x)+","+(this._y1=+y)},quadraticCurveTo:function(x1,y1,x,y){this._+="Q"+ +x1+","+ +y1+","+(this._x1=+x)+","+(this._y1=+y)},bezierCurveTo:function(x1,y1,x2,y2,x,y){this._+="C"+ +x1+","+ +y1+","+ +x2+","+ +y2+","+(this._x1=+x)+","+(this._y1=+y)},arcTo:function(x1,y1,x2,y2,r){x1=+x1,y1=+y1,x2=+x2,y2=+y2,r=+r;var x0=this._x1,y0=this._y1,x21=x2-x1,y21=y2-y1,x01=x0-x1,y01=y0-y1,l01_2=x01*x01+y01*y01;if(r<0)throw new Error("negative radius: "+r);if(null===this._x1)this._+="M"+(this._x1=x1)+","+(this._y1=y1);else if(l01_2>1e-6)if(Math.abs(y01*x21-y21*x01)>1e-6&&r){var x20=x2-x0,y20=y2-y0,l21_2=x21*x21+y21*y21,l20_2=x20*x20+y20*y20,l21=Math.sqrt(l21_2),l01=Math.sqrt(l01_2),l=r*Math.tan((pi-Math.acos((l21_2+l01_2-l20_2)/(2*l21*l01)))/2),t01=l/l01,t21=l/l21;Math.abs(t01-1)>1e-6&&(this._+="L"+(x1+t01*x01)+","+(y1+t01*y01)),this._+="A"+r+","+r+",0,0,"+ +(y01*x20>x01*y20)+","+(this._x1=x1+t21*x21)+","+(this._y1=y1+t21*y21)}else this._+="L"+(this._x1=x1)+","+(this._y1=y1);else;},arc:function(x,y,r,a0,a1,ccw){x=+x,y=+y,ccw=!!ccw;var dx=(r=+r)*Math.cos(a0),dy=r*Math.sin(a0),x0=x+dx,y0=y+dy,cw=1^ccw,da=ccw?a0-a1:a1-a0;if(r<0)throw new Error("negative radius: "+r);null===this._x1?this._+="M"+x0+","+y0:(Math.abs(this._x1-x0)>1e-6||Math.abs(this._y1-y0)>1e-6)&&(this._+="L"+x0+","+y0),r&&(da<0&&(da=da%tau+tau),da>tauEpsilon?this._+="A"+r+","+r+",0,1,"+cw+","+(x-dx)+","+(y-dy)+"A"+r+","+r+",0,1,"+cw+","+(this._x1=x0)+","+(this._y1=y0):da>1e-6&&(this._+="A"+r+","+r+",0,"+ +(da>=pi)+","+cw+","+(this._x1=x+r*Math.cos(a1))+","+(this._y1=y+r*Math.sin(a1))))},rect:function(x,y,w,h){this._+="M"+(this._x0=this._x1=+x)+","+(this._y0=this._y1=+y)+"h"+ +w+"v"+ +h+"h"+-w+"Z"},toString:function(){return this._}};const src_path=path;function d3_shape_src_constant(x){return function(){return x}}var math_abs=Math.abs,atan2=Math.atan2,cos=Math.cos,math_max=Math.max,math_min=Math.min,sin=Math.sin,sqrt=Math.sqrt,math_pi=Math.PI,halfPi=math_pi/2,math_tau=2*math_pi;function acos(x){return x>1?0:x<-1?math_pi:Math.acos(x)}function asin(x){return x>=1?halfPi:x<=-1?-halfPi:Math.asin(x)}function arcInnerRadius(d){return d.innerRadius}function arcOuterRadius(d){return d.outerRadius}function arcStartAngle(d){return d.startAngle}function arcEndAngle(d){return d.endAngle}function arcPadAngle(d){return d&&d.padAngle}function intersect(x0,y0,x1,y1,x2,y2,x3,y3){var x10=x1-x0,y10=y1-y0,x32=x3-x2,y32=y3-y2,t=y32*x10-x32*y10;if(!(t*t<1e-12))return[x0+(t=(x32*(y0-y2)-y32*(x0-x2))/t)*x10,y0+t*y10]}function cornerTangents(x0,y0,x1,y1,r1,rc,cw){var x01=x0-x1,y01=y0-y1,lo=(cw?rc:-rc)/sqrt(x01*x01+y01*y01),ox=lo*y01,oy=-lo*x01,x11=x0+ox,y11=y0+oy,x10=x1+ox,y10=y1+oy,x00=(x11+x10)/2,y00=(y11+y10)/2,dx=x10-x11,dy=y10-y11,d2=dx*dx+dy*dy,r=r1-rc,D=x11*y10-x10*y11,d=(dy<0?-1:1)*sqrt(math_max(0,r*r*d2-D*D)),cx0=(D*dy-dx*d)/d2,cy0=(-D*dx-dy*d)/d2,cx1=(D*dy+dx*d)/d2,cy1=(-D*dx+dy*d)/d2,dx0=cx0-x00,dy0=cy0-y00,dx1=cx1-x00,dy1=cy1-y00;return dx0*dx0+dy0*dy0>dx1*dx1+dy1*dy1&&(cx0=cx1,cy0=cy1),{cx:cx0,cy:cy0,x01:-ox,y01:-oy,x11:cx0*(r1/r-1),y11:cy0*(r1/r-1)}}Array.prototype.slice;function d3_shape_src_array(x){return"object"==typeof x&&"length"in x?x:Array.from(x)}function Linear(context){this._context=context}function curve_linear(context){return new Linear(context)}function point_x(p){return p[0]}function point_y(p){return p[1]}function descending(a,b){return b<a?-1:b>a?1:b>=a?0:NaN}function d3_shape_src_identity(d){return d}function src_pie(){var value=d3_shape_src_identity,sortValues=descending,sort=null,startAngle=d3_shape_src_constant(0),endAngle=d3_shape_src_constant(math_tau),padAngle=d3_shape_src_constant(0);function pie(data){var i,j,k,a1,v,n=(data=d3_shape_src_array(data)).length,sum=0,index=new Array(n),arcs=new Array(n),a0=+startAngle.apply(this,arguments),da=Math.min(math_tau,Math.max(-math_tau,endAngle.apply(this,arguments)-a0)),p=Math.min(Math.abs(da)/n,padAngle.apply(this,arguments)),pa=p*(da<0?-1:1);for(i=0;i<n;++i)(v=arcs[index[i]=i]=+value(data[i],i,data))>0&&(sum+=v);for(null!=sortValues?index.sort((function(i,j){return sortValues(arcs[i],arcs[j])})):null!=sort&&index.sort((function(i,j){return sort(data[i],data[j])})),i=0,k=sum?(da-n*pa)/sum:0;i<n;++i,a0=a1)j=index[i],a1=a0+((v=arcs[j])>0?v*k:0)+pa,arcs[j]={data:data[j],index:i,value:v,startAngle:a0,endAngle:a1,padAngle:p};return arcs}return pie.value=function(_){return arguments.length?(value="function"==typeof _?_:d3_shape_src_constant(+_),pie):value},pie.sortValues=function(_){return arguments.length?(sortValues=_,sort=null,pie):sortValues},pie.sort=function(_){return arguments.length?(sort=_,sortValues=null,pie):sort},pie.startAngle=function(_){return arguments.length?(startAngle="function"==typeof _?_:d3_shape_src_constant(+_),pie):startAngle},pie.endAngle=function(_){return arguments.length?(endAngle="function"==typeof _?_:d3_shape_src_constant(+_),pie):endAngle},pie.padAngle=function(_){return arguments.length?(padAngle="function"==typeof _?_:d3_shape_src_constant(+_),pie):padAngle},pie}function cardinal_point(that,x,y){that._context.bezierCurveTo(that._x1+that._k*(that._x2-that._x0),that._y1+that._k*(that._y2-that._y0),that._x2+that._k*(that._x1-x),that._y2+that._k*(that._y1-y),that._x2,that._y2)}function Cardinal(context,tension){this._context=context,this._k=(1-tension)/6}Linear.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(x,y){switch(x=+x,y=+y,this._point){case 0:this._point=1,this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;default:this._context.lineTo(x,y)}}},Cardinal.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:cardinal_point(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(x,y){switch(x=+x,y=+y,this._point){case 0:this._point=1,this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2,this._x1=x,this._y1=y;break;case 2:this._point=3;default:cardinal_point(this,x,y)}this._x0=this._x1,this._x1=this._x2,this._x2=x,this._y0=this._y1,this._y1=this._y2,this._y2=y}};(function custom(tension){function cardinal(context){return new Cardinal(context,tension)}return cardinal.tension=function(tension){return custom(+tension)},cardinal})(0);function CatmullRom(context,alpha){this._context=context,this._alpha=alpha}CatmullRom.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(x,y){if(x=+x,y=+y,this._point){var x23=this._x2-x,y23=this._y2-y;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(x23*x23+y23*y23,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;break;case 2:this._point=3;default:!function(that,x,y){var x1=that._x1,y1=that._y1,x2=that._x2,y2=that._y2;if(that._l01_a>1e-12){var a=2*that._l01_2a+3*that._l01_a*that._l12_a+that._l12_2a,n=3*that._l01_a*(that._l01_a+that._l12_a);x1=(x1*a-that._x0*that._l12_2a+that._x2*that._l01_2a)/n,y1=(y1*a-that._y0*that._l12_2a+that._y2*that._l01_2a)/n}if(that._l23_a>1e-12){var b=2*that._l23_2a+3*that._l23_a*that._l12_a+that._l12_2a,m=3*that._l23_a*(that._l23_a+that._l12_a);x2=(x2*b+that._x1*that._l23_2a-x*that._l12_2a)/m,y2=(y2*b+that._y1*that._l23_2a-y*that._l12_2a)/m}that._context.bezierCurveTo(x1,y1,x2,y2,that._x2,that._y2)}(this,x,y)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=x,this._y0=this._y1,this._y1=this._y2,this._y2=y}};const catmullRom=function custom(alpha){function catmullRom(context){return alpha?new CatmullRom(context,alpha):new Cardinal(context,0)}return catmullRom.alpha=function(alpha){return custom(+alpha)},catmullRom}(.5);function Step(context,t){this._context=context,this._t=t}function transform_Transform(k,x,y){this.k=k,this.x=x,this.y=y}Step.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(x,y){switch(x=+x,y=+y,this._point){case 0:this._point=1,this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,y),this._context.lineTo(x,y);else{var x1=this._x*(1-this._t)+x*this._t;this._context.lineTo(x1,this._y),this._context.lineTo(x1,y)}}this._x=x,this._y=y}},transform_Transform.prototype={constructor:transform_Transform,scale:function(k){return 1===k?this:new transform_Transform(this.k*k,this.x,this.y)},translate:function(x,y){return 0===x&0===y?this:new transform_Transform(this.k,this.x+this.k*x,this.y+this.k*y)},apply:function(point){return[point[0]*this.k+this.x,point[1]*this.k+this.y]},applyX:function(x){return x*this.k+this.x},applyY:function(y){return y*this.k+this.y},invert:function(location){return[(location[0]-this.x)/this.k,(location[1]-this.y)/this.k]},invertX:function(x){return(x-this.x)/this.k},invertY:function(y){return(y-this.y)/this.k},rescaleX:function(x){return x.copy().domain(x.range().map(this.invertX,this).map(x.invert,x))},rescaleY:function(y){return y.copy().domain(y.range().map(this.invertY,this).map(y.invert,y))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};new transform_Transform(1,0,0);transform_Transform.prototype;class GraphBase{constructor(cfg){this.cfg=cfg}}class GraphComponent extends GraphBase{constructor(cfg,compClass){super(cfg),compClass?this.svg=this.cfg.baseSVG.append("g").classed(compClass,!0):null!==compClass&&(console.log("no CompClass"),console.log((new Error).stack))}initialize(svg){}}new Log("Scale");const scaleDefault=(type,minRange,maxRange)=>{const def={type,aggregateOverTime:!0,domain:{min:"auto",max:"auto"},range:{min:minRange||"auto",max:maxRange||"auto"}};switch(type){case"linear":default:return def}},axes={top:function(scale){return axis(1,scale)},bottom:function(scale){return axis(3,scale)},left:function(scale){return axis(4,scale)},right:function(scale){return axis(2,scale)}};class NoScale{constructor(){}getScale(){}}class BaseScale{constructor(d3Scale,scaleDef,domain,range){this.d3Scale=d3Scale,this.scaleDef=scaleDef,this.domain=domain,this.range=range}scaleFn(x){return this.d3Scale(x)}getScale(){const hsScale=this;const d3Scale=this.d3Scale,scale=x=>this.scaleFn(x);return scale.invert=d3Scale.invert,scale.range=function(r){return r?(d3Scale.range(r),scale):d3Scale.range()},scale.domain=function(d){return void 0!==d?(d=hsScale.getDomain(d),d3Scale.domain(d),scale):d3Scale.domain()},scale.copy=()=>d3Scale.copy(),scale.axis=loc=>axes[loc](d3Scale),scale.ticks=this.getTicks(),scale.tickCountMajor=2,scale.tickCountMinor=10,scale.domain([]),scale.range(this.getRange()),scale.type=this.getType,scale}getTicks(){return count=>this.d3Scale.ticks(count)}getDomain(domain){return this.d3Scale.domain()}getRange(){const rangeDef=this.scaleDef.range;return[this.range&&"auto"===rangeDef.min?this.range[0]:rangeDef.min,this.range&&"auto"===rangeDef.max?this.range[1]:rangeDef.max]}}class BandScale extends BaseScale{constructor(scaleDef,domain,range){super(band(),scaleDef,domain,range),this.scaleDef=scaleDef,this.domain=domain,this.range=range}getType(){return"ordinal"}getScale(){const scale=super.getScale();return scale.bandwidth=this.d3Scale.bandwidth,scale.padding=this.d3Scale.padding,scale.paddingInner=this.d3Scale.paddingInner,scale.paddingOuter=this.d3Scale.paddingOuter,scale.step=this.d3Scale.step,scale}getDomain(domain){return domain||[]}}class TimeScale extends BaseScale{constructor(scaleDef,domain,range){super(function(){return initRange.apply(calendar(src_year,src_month,sunday,src_day,src_hour,src_minute,src_second,src_millisecond,timeFormat).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}().interpolate(round),scaleDef,domain,range),this.domain=domain}getType(){return"time"}getTicks(){return count=>this.d3Scale.ticks(count).map((d=>new Date(d)))}getDomain(domain){if(domain&&domain[0]){const domDef=this.scaleDef.domain;return domain&&domain[0].getTime&&(domain=[domain[0].getTime(),domain[1].getTime()]),[domain&&"auto"===domDef.min?domain[0]:domDef.min,domain&&"auto"===domDef.max?domain[1]:domDef.max]}return domain}}class NumberScale extends BaseScale{constructor(d3Scale,scaleDef,domain,range){super(d3Scale.interpolate(round),scaleDef,domain,range),this.d3Scale=d3Scale,this.scaleDef=scaleDef,this.domain=domain}getType(){return"number"}getDomain(domain){if(domain&&domain[0]){const domDef=this.scaleDef.domain;return[domain&&"auto"===domDef.min?domain[0]:domDef.min,domain&&"auto"===domDef.max?domain[1]:domDef.max]}return domain}}class LinearScale extends NumberScale{constructor(scaleDef,domain,range){super(src_linear_linear(),scaleDef,domain,range)}}class LogScale extends NumberScale{constructor(scaleDef,domain,range){super(log_log(),scaleDef,domain,range)}scaleFn(x){const scaled=this.d3Scale(x);return isNaN(scaled)?this.scaleDef.domain.min:scaled}}const Series_log=new Log("Series"),defaultColors=Dark2;class Series extends GraphComponent{constructor(cfg){super(cfg,Series.type),this.series=[]}static register(key,seriesCreator){this.seriesCreatorMap[key]?(this.seriesCreatorMap[key]=seriesCreator,Series_log.debug(`re-registered plot type '${key}'`)):(this.seriesCreatorMap[key]=seriesCreator,Series_log.debug(`registered plot type '${key}'`))}static get types(){return Object.keys(this.seriesCreatorMap)}get componentType(){return Series.type}get defaults(){return this.cfg.graph.defaults.series}initialize(svg){const seriesSVG=svg.selectAll("."+this.componentType);this.series.forEach(((s,i)=>s.initialize(seriesSVG,defaultColors[i%defaultColors.length])))}preRender(data){this.series.forEach(((s,i)=>s.preRender(data.colNames?data:data[i%this.series.length])))}renderComponent(data){this.series.forEach(((s,i)=>{try{s.renderComponent(data.colNames?data:data[i%this.series.length])}catch(e){Series_log.warn(`series ${s.key}: ${e}\n${e.stack}`)}}))}postRender(data){this.series.forEach(((s,i)=>s.postRender(data.colNames?data:data[i%this.series.length])))}createDefaults(){return{}}expandDomains(data,domains){return data.colNames?(this.series.forEach((s=>s.clearStack?s.clearStack(data):"")),this.series.forEach((s=>s.expandDomains?s.expandDomains(data,domains):""))):(this.series.forEach(((s,i)=>{const dataSet=data[i%data.length];s.clearStack&&s.clearStack(dataSet)})),this.series.forEach(((s,i)=>{const dataSet=data[i%data.length];s.expandDomains&&s.expandDomains(dataSet,domains)}))),domains}add(type,dims){const seriesCreator=Series.seriesCreatorMap[type];if(seriesCreator){const series=seriesCreator(this.cfg,`${Series.type}${this.series.length}`,dims);if(this.makeGraphType(series.graphType)){const index=this.series.length;return this.defaults[index]=this.defaults[series.key]=series.getDefaults(),Series_log.debug((()=>`added ${series.graphType} ${type} series ${index} on '${Object.keys(dims).map((d=>d+": "+dims[d])).join(", ")}'`)),this.series.push(series)-1}Series_log.warn(`adding ${type} series requires a graph type ${series.graphType} that is incompatible with the previously set type ${this.cfg.graph.defaults.scales.type}`)}else Series_log.error(`unknown plot type ${type}; available types are:\n   '${Object.keys(Series.seriesCreatorMap).join("'\n   '")}'`);return-1}remove(id){if(id>=0){const key=this.series[id].key;this.svg.selectAll(`.${this.componentType} .${key}`).remove(),this.series.splice(id,1)}else{this.series=[];this.svg.selectAll(`.${this.componentType} g`).remove()}}makeGraphType(graphType){const scalesDefaults=this.cfg.graph.defaults.scales;switch(graphType){case"polar":if(scalesDefaults.type){if("polar"!==scalesDefaults.type)return!1}else{Series_log.debug("creating polar graph type"),scalesDefaults.type="polar",scalesDefaults.dims.ang=scalesDefaults.dims.ang||scaleDefault("linear",0,2*Math.PI),scalesDefaults.dims.rad=scalesDefaults.dims.rad||scaleDefault("linear"),this.cfg.graph.defaults.axes.rendered=!1,this.cfg.graph.defaults.grids.rendered=!1;const hor=this.cfg.viewPort.width,ver=this.cfg.viewPort.height;this.cfg.viewPort.orgX=-hor/2,this.cfg.viewPort.orgY=-ver/2,this.cfg.baseSVG.attr("viewBox",`${-hor/2} ${-ver/2} ${hor} ${ver}`)}break;case"cartesian":if(scalesDefaults.type){if("cartesian"!==scalesDefaults.type)return!1}else Series_log.debug("creating cartesian graph type"),scalesDefaults.type="cartesian",scalesDefaults.dims.hor=scalesDefaults.dims.hor||scaleDefault("linear"),scalesDefaults.dims.ver=scalesDefaults.dims.ver||scaleDefault("linear"),scalesDefaults.dims.size=scalesDefaults.dims.size||scaleDefault("linear",5,20);break;case"none":if(scalesDefaults.type){if("none"!==scalesDefaults.type)return!1}else Series_log.debug("creating non-metric graph type"),scalesDefaults.type="none",this.cfg.graph.defaults.axes.rendered=!1,this.cfg.graph.defaults.grids.rendered=!1}return!0}}Series.type="series",Series.seriesCreatorMap={};const Scales_log=new Log("Scales");class Scales extends GraphComponent{constructor(cfg){super(cfg,null),this.scales={},this.cumulativeDomains={}}get componentType(){return Scales.type}get defaults(){return this.cfg.graph.defaults.scales}get scaleDims(){return this.scales}initialize(){const margins=this.defaults.margin,vp=this.cfg.viewPort;switch(this.defaults.type){case"polar":this.createScale("ang",this.cumulativeDomains.ang),this.createScale("rad",this.cumulativeDomains.rad,[0,Math.min(vp.height-margins.bottom-margins.top,vp.width-margins.left-margins.right)/2]);break;case"cartesian":this.createScale("hor",this.cumulativeDomains.hor,[margins.left,vp.width-margins.right]),this.createScale("ver",this.cumulativeDomains.ver,[vp.height-margins.bottom,margins.top]),this.createScale("size",this.cumulativeDomains.size)}}preRender(data){const dims=this.defaults.dims;this.cumulate(data),Object.keys(dims).forEach((dim=>this.setDomain(dim,this.cumulativeDomains[dim])))}renderComponent(){}postRender(){}createDefaults(){return{margin:{left:20,top:20,right:20,bottom:30},dims:{},type:void 0}}createScale(name,domain,range){const scaleDef=this.defaults.dims[name];if(!scaleDef)return void Scales_log.warn(`can't create scale ${name}; no default available`);let scales={none:NoScale,ordinal:BandScale,time:TimeScale,log:LogScale,linear:LinearScale};return this.scales[name]=new scales[scaleDef.type](scaleDef,domain,range).getScale(),this.setDomain(name,domain),this.scales[name]}setDomain(name,domain){domain&&2===domain.length&&(isNaN(domain[0])&&(domain[0]=0),isNaN(domain[1])&&(domain[1]=0),domain[0]>0&&domain[0]===domain[1]&&(domain[0]=0));this.defaults.dims[name];this.scales[name].domain(domain)}cumulate(data){const dims=this.defaults.dims,dom=this.cumulativeDomains;Object.keys(dims).forEach((dim=>dom[dim]=dom[dim]&&dims[dim].aggregateOverTime?dom[dim]:void 0)),this.cfg.components.series.expandDomains(data,this.cumulativeDomains)}}Scales.type="scales";const Settings_log=new Log("Defaults"),schemes={cat10:fraction=>category10[fraction>1?fraction%10:Math.round(10*fraction).toFixed(0)],blues:fraction=>Blues(fraction),greens:fraction=>Greens(fraction),greys:fraction=>Greys(fraction),oranges:fraction=>Oranges(fraction),purples:fraction=>Purples(fraction),reds:fraction=>Reds(fraction)};var TextHAlign,TextVAlign,HPos,VPos,MarkerShape;function pct2Share(v){if(!isNaN(v))return v;if(v.endsWith("%"))return parseInt(v)/100;switch(v){case TextHAlign.left:case TextVAlign.top:return 0;case TextHAlign.right:case TextVAlign.bottom:return 1;case TextHAlign.center:case TextVAlign.center:return.5;default:return Settings_log.warn(`value ${v} is neither numeric, an alignment, nor a percentage`),0}}function textPos(x,y,inside=!0){let xpos=pct2Share(x),ypos=pct2Share(y);return{x:{pos:xpos,shift:xpos<.33?inside?1:-1:xpos>.66?inside?-1:1:0,anchor:xpos<.33?inside?"start":"end":xpos>.66?inside?"end":"start":"middle"},y:{pos:ypos,shift:ypos<.33?inside?1:-1:ypos>.66?inside?-1:1:0,baseline:ypos<.33?inside?"hanging":"baseline":ypos>.66?inside?"baseline":"hanging":"middle"}}}!function(TextHAlign){TextHAlign.left="left",TextHAlign.center="center",TextHAlign.right="right"}(TextHAlign||(TextHAlign={})),function(TextVAlign){TextVAlign.top="top",TextVAlign.center="center",TextVAlign.bottom="bottom"}(TextVAlign||(TextVAlign={})),function(HPos){HPos.left="left",HPos.center="center",HPos.right="right"}(HPos||(HPos={})),function(VPos){VPos.top="top",VPos.center="center",VPos.bottom="bottom"}(VPos||(VPos={})),function(MarkerShape){MarkerShape[MarkerShape.square=0]="square",MarkerShape[MarkerShape.diamond=1]="diamond",MarkerShape[MarkerShape.tri_up=2]="tri_up",MarkerShape[MarkerShape.tri_down=3]="tri_down",MarkerShape[MarkerShape.circle=4]="circle"}(MarkerShape||(MarkerShape={}));const defaultStroke=(width,color="currentColor")=>({width,color,opacity:1,dashed:""}),defaultLine=(width,color="currentColor")=>{const def=defaultStroke(width,color);return def.smoothing="catmull05",def.rendered=!0,def},defaultArea=(areaFill="currentColor",opacity=.5)=>({rendered:!1,color:areaFill,opacity,border:defaultStroke(0,"#fff")}),defaultFont=(size=16)=>({family:"sans-serif",size,style:"normal",weight:"100"}),defaultLabel=(areaFill="currentColor",opacity=.5)=>({color:areaFill,font:defaultFont(),xpos:HPos.center,ypos:VPos.center,hOffset:0,vOffset:0,inside:!0,rendered:!1}),defaultText=(size=16)=>{const ts=defaultTextStyle(size);return ts.rendered=!0,ts},defaultTextStyle=(size=16)=>({color:"currentColor",font:defaultFont(size)}),defaultMarker=(color="currentColor",shape=MarkerShape.circle,size=10)=>{const def=defaultMarkerStyle(color,shape,size);return def.rendered=!0,def},defaultMarkerStyle=(color="currentColor",shape=MarkerShape.circle,size=10)=>({size,shape,fill:defaultArea(color,.75),stroke:defaultStroke(4),scheme:"cat10"});function setStroke(svg,settings){return settings&&settings.width?svg.attr("stroke",settings.color).attr("stroke-width",settings.width).attr("stroke-opacity",settings.opacity).attr("stroke-dasharray",settings.dashed||"none").attr("fill-opacity",0):svg}function setFill(svg,settings){return settings?svg.attr("fill",settings.color).attr("fill-opacity",settings.opacity):svg}function setText(svg,settings,transition){svg.transition(transition).attr("fill",settings.color).attr("font-family",settings.font.family).attr("font-size",settings.font.size+"px").attr("font-style",settings.font.style).attr("font-weight",settings.font.weight)}const Axis_log=new Log("Axis"),fmtNum=locale({decimal:".",thousands:" ",grouping:[3],currency:["","TEUR"]}).format(",.4~s");var Direction;!function(Direction){Direction.horizontal="hor",Direction.vertical="ver"}(Direction||(Direction={}));class Axes extends GraphComponent{constructor(cfg){super(cfg,Axes.type),this.axes=[],this.axes.push(new Axis(this,cfg,Direction.horizontal)),this.axes.push(new Axis(this,cfg,Direction.vertical))}get componentType(){return Axes.type}get defaults(){return this.cfg.graph.defaults.axes}createDefaults(){return{color:"#000",rendered:!0,hor:this.axes[0].createDefaults(),ver:this.axes[1].createDefaults()}}initialize(svg){}preRender(){this.defaults.rendered&&this.axes.forEach((axis=>axis.defaults.rendered?axis.preRender():""))}renderComponent(){this.defaults.rendered&&this.axes.forEach((axis=>axis.defaults.rendered?axis.renderComponent():""))}postRender(){}}Axes.type="axes";class Axis{constructor(axes,cfg,dir){this.axes=axes,this.cfg=cfg,this.dir=dir,this.svg=cfg.baseSVG.select(".axes").append("g"),this.svg.classed(dir+"Axis",!0)}createDefaults(){return{color:"currentColor",rendered:!0,line:defaultLine(1),tickWidth:5,tickMarks:defaultLine(2),tickLabel:defaultText(),crossing:"auto",numTicksMajor:"auto",numTicksMinor:"auto"}}get defaults(){return this.axes.defaults[this.dir]}preRender(){const axisDef=this.defaults,scale=this.cfg.components.scales.scaleDims[this.dir],clientSize=this.dir===Direction.horizontal?this.cfg.client.width:this.cfg.client.height;scale.tickCountMajor="auto"===axisDef.numTicksMajor?parseInt(""+clientSize/200):axisDef.numTicksMajor,scale.tickCountMinor="auto"===axisDef.numTicksMinor?parseInt(""+clientSize/50):axisDef.numTicksMinor}renderComponent(){const trans=this.cfg.transition,axisDef=this.defaults;this.cfg.baseSVG.select(".axes").attr("color",this.defaults.color),setStroke(this.svg,axisDef.line);const scales=this.cfg.components.scales.scaleDims;this.setTransform(scales);const axis=this.getD3Axis(scales,axisDef);this.svg.transition(trans).call(axis),this.svg.attr("color",axisDef.color),axisDef.line.rendered||this.svg.selectAll("path").attr("style","visibility: hidden"),axisDef.tickLabel.rendered?setText(this.svg,axisDef.tickLabel,trans):this.svg.selectAll("text").attr("style","visibility: hidden"),axisDef.tickMarks.rendered?setStroke(this.svg.selectAll(".tick line"),axisDef.tickMarks):this.svg.selectAll(".tick line").attr("style","visibility: hidden")}setTransform(scales){const margins=this.cfg.components.scales.defaults.margin,trans=this.cfg.transition,orth=this.dir===Direction.horizontal?Direction.vertical:Direction.horizontal,scale=scales[this.dir],oscale=scales[orth],axisDef=this.cfg.components.axes.defaults[orth],dom=oscale.domain();let crossing=oscale("auto"===axisDef.crossing?dom[0]<0&&dom[1]>0?0:dom[0]:axisDef.crossing);const d="ordinal"===scale.type()?scale.paddingInner()*scale.step()/2:0;this.dir===Direction.horizontal?(this.pos="bottom",crossing<margins.top?crossing=margins.top:crossing>this.cfg.viewPort.height-margins.bottom&&(crossing=this.cfg.viewPort.height-margins.bottom,this.pos="top"),crossing+="ordinal"===oscale.type()?oscale.step():0,isNaN(d)||isNaN(crossing)?Axis_log.warn(`Axis.setTransform hor: d=${d}, cr=${crossing}`):this.svg.transition(trans).attr("transform",`translate(${d}, ${crossing})`)):(this.pos="left",crossing<margins.left?(crossing=margins.left,this.pos="right"):crossing>this.cfg.viewPort.width-margins.right&&(crossing=this.cfg.viewPort.width-margins.right),isNaN(d)||isNaN(crossing)?Axis_log.warn(`Axis.setTransform ver: d=${d}, cr=${crossing}`):this.svg.transition(trans).attr("transform",`translate(${crossing}, ${d})`))}getD3Axis(scales,axisDef){let axis,ticks;return this.dir===Direction.horizontal?(axis=scales.hor.axis(this.pos),ticks=scales.hor.tickCountMajor,"number"===scales.hor.type()?axis.tickFormat(fmtNum):"time"===scales.hor.type()&&axis.tickFormat(timeFormat("%b %d, %Y"))):(axis=scales.ver.axis(this.pos),ticks=scales.ver.tickCountMajor,"number"===scales.ver.type()?axis.tickFormat(fmtNum):"time"===scales.ver.type()&&axis.tickFormat(timeFormat("%b %d, %Y"))),axis.ticks(ticks),axis.tickSize(axisDef.tickWidth),axis}}const Grid_log=new Log("Grid");var MajorMinor;!function(MajorMinor){MajorMinor.major="major",MajorMinor.minor="minor"}(MajorMinor||(MajorMinor={}));class Grids extends GraphComponent{constructor(cfg){super(cfg,Grids.type),this.grids={hor:{major:void 0,minor:void 0},ver:{major:void 0,minor:void 0}},this.grids.hor.major=new Grid(cfg,Direction.horizontal,MajorMinor.major),this.grids.hor.minor=new Grid(cfg,Direction.horizontal,MajorMinor.minor),this.grids.ver.major=new Grid(cfg,Direction.vertical,MajorMinor.major),this.grids.ver.minor=new Grid(cfg,Direction.vertical,MajorMinor.minor)}get componentType(){return Grids.type}get defaults(){return this.cfg.graph.defaults.grids}createDefaults(){return{rendered:!0,hor:{major:defaultLine(1,"#444"),minor:defaultLine(1,"#eee")},ver:{major:defaultLine(1,"#444"),minor:defaultLine(1,"#eee")}}}initialize(svg){}preRender(){}renderComponent(){this.cfg.graph.defaults.grids.rendered&&(this.grids.hor.major.renderComponent(),this.grids.hor.minor.renderComponent(),this.grids.ver.major.renderComponent(),this.grids.ver.minor.renderComponent())}postRender(){}}Grids.type="grids";class Grid{constructor(cfg,dir,type=MajorMinor.major){this.cfg=cfg,this.dir=dir,this.type=type;const baseClass=`${dir}-${type}-Grid`;this.hor=this.dir===Direction.horizontal,this.svg=cfg.baseSVG.select(".grids").append("g"),this.svg.classed(baseClass,!0)}renderComponent(){const style=this.cfg.graph.defaults.grids[this.dir][this.type];if(style.rendered){const trans=this.cfg.transition,scaleX=this.cfg.components.scales.scaleDims.hor,scaleY=this.cfg.components.scales.scaleDims.ver;setStroke(this.svg,style);const c=this.hor?{range:scaleX.range(),scale:scaleY,dim:{fix:"x",var:"y"}}:{range:scaleY.range(),scale:scaleX,dim:{fix:"y",var:"x"}},count=this.type===MajorMinor.major?c.scale.tickCountMajor:c.scale.tickCountMinor;try{this.svg.selectAll("line").data(c.scale.ticks(count),(d=>d)).join((enter=>enter.append("line").attr(c.dim.fix+"1",c.range[0]).attr(c.dim.fix+"2",c.range[1])),(update=>update),(exit=>exit.remove())).transition(trans).attr(c.dim.var+"1",(d=>c.scale(d))).attr(c.dim.var+"2",(d=>c.scale(d)))}catch(e){Grid_log.warn(`${this.type} ${this.hor?"hor":"ver"} grid: ${e}`)}}}}class Canvas extends GraphComponent{constructor(cfg){super(cfg,Canvas.type)}get componentType(){return Canvas.type}get defaults(){return this.cfg.graph.defaults.canvas}createDefaults(){return((areaFill,borderWidth=0,borderColor="currentColor")=>({rx:0,ry:0,fill:defaultArea(areaFill,1),stroke:defaultStroke(borderWidth,borderColor)}))("#fff",1,"#00c")}initialize(svg){this.svg.append("rect").classed("graphArea",!0)}preRender(){}renderComponent(){const canvas=this.defaults,area=this.svg.select(".graphArea");var svg,settings;(svg=area,settings=canvas,svg.attr("rx",settings.rx).attr("ry",settings.ry),setStroke(svg,settings.stroke),setFill(svg,settings.fill),svg).attr("x",this.cfg.viewPort.orgX).attr("y",this.cfg.viewPort.orgY).attr("width",this.cfg.viewPort.width).attr("height",this.cfg.viewPort.height)}postRender(){}}Canvas.type="canvas";new Log("Popup");class Popup extends GraphComponent{constructor(cfg){super(cfg,Popup.type);this.cfg.baseSVG.append("style").text(".popup:hover { filter: brightness(0.8);}")}get componentType(){return Popup.type}get defaults(){return this.cfg.graph.defaults.popup}createDefaults(){const defs={rendered:!1,fill:defaultArea("#eee",.8),style:defaultTextStyle(10),offset:{xPx:-50,yPx:-50}};return defs.style.font.weight="bold",defs}addListener(items,popupAccess){items.classed("popup",!0).on("mouseenter",(e=>this.showPopup(popupAccess).bind(this)(e.currentTarget.__data__,void 0,e.layerX))).on("mousemove",(e=>this.movePopup(popupAccess,e).bind(this)(e.currentTarget.__data__,void 0,e.layerX))).on("mouseleave",this.hidePopup.bind(this))}showPopup(popupAccess){const p=this,scale=this.cfg.components.scales.scaleDims.hor;return(d,i,xpos)=>p.svg.html(popupAccess(d,i,scale?.invert?scale.invert(xpos):xpos)).transition().duration(100).style("opacity",this.defaults.fill.opacity)}movePopup(popupAccess,event){const o=this.defaults.offset;return this.svg.style("left",event.pageX+o.xPx+"px").style("top",event.pageY+o.yPx+"px"),this.showPopup(popupAccess)}hidePopup(){this.svg.transition().duration(500).style("opacity",0)}initialize(svg){const def=this.defaults,parentID=this.cfg.baseSVG._groups[0][0].parentElement.id;parentID?(src_select(`#${parentID} .tooltip`).remove(),this.svg=src_select("#"+parentID).append("div"),this.svg.attr("id","tooltip").attr("style",`\n                position: fixed;\n                padding: 5px;\n                background-color: ${def.fill.color};\n                border: ${def.fill.border.width}px solid ${def.fill.border.color};\n                border-radius: 5px;\n                color: ${def.style.color};\n                font-family: ${def.style.font.family};\n                font-size: ${def.style.font.size};\n                font-style: ${def.style.font.style};\n                font-weight: ${def.style.font.weight};\n                text-align: center;\n                line-height: 1.2em;\n            `).style("opacity",0)):this.svg=void 0}preRender(){}renderComponent(){}postRender(){}}Popup.type="popup";new Log("Title");class Title extends GraphComponent{constructor(cfg){super(cfg,Title.type),this.titleText=""}get componentType(){return Title.type}get defaults(){return this.cfg.graph.defaults.title}set text(title){this.titleText=title,this.defaults.rendered=!0}createDefaults(){const defs={rendered:!1,x:.05,y:"5%",style:defaultTextStyle(24)};return defs.style.font.weight="bold",defs}initialize(svg){this.svg.append("text")}preRender(){}renderComponent(){const titleDefs=this.defaults;if(titleDefs.rendered){const vp=this.cfg.viewPort,pos=textPos(titleDefs.x,titleDefs.y),svg=this.svg.select("text");setText(svg,titleDefs.style,this.cfg.transition),svg.attr("x",pos.x.pos*vp.width+vp.orgX).attr("text-anchor",pos.x.anchor).attr("y",pos.y.pos*vp.height+vp.orgY).attr("dominant-baseline",pos.y.baseline).text(this.titleText)}}postRender(){}}Title.type="title";const Graph_log=new Log("Graph"),easings={easeLinear:t=>+t,easeCubic:cubicInOut,easeNone:()=>1};class Graph extends GraphBase{constructor(root){if(super({baseSVG:void 0,graph:void 0,components:[],client:{x:0,y:0,width:0,height:0},viewPort:{orgX:0,orgY:0,width:1e3,height:700},transition:null,stack:{}}),this.initialized=!1,this.graphDefaults={},this.cfg.graph=this,root.attrs&&root.attrs.rootID){const rootID=root.attrs.rootID;(root=document.getElementById(rootID))||Graph_log.warn("did not find element with ID "+rootID)}root&&root.baseURI&&this.create(root)}static addGraph(id,fn){Graph_log.debug("addGraph "+id),Graph.graphs[id]=fn}static removeGraph(id){Graph_log.debug("removeGraph "+id),delete Graph.graphs[id]}static resizeGraphs(){Object.keys(Graph.graphs).forEach((g=>Graph.graphs[g]()))}create(root){this.root=root,this.root&&(this.cfg.baseSVG=this.createBaseSVG(this.cfg),this.updateBaseSVG(this.cfg),this.createComponents(this.cfg),this.makeDefaults(),this.resize(),window.onresize=Graph.resizeGraphs)}reinitialize(){Graph_log.info("*** reinitialized"),this.initialized=!1,Graph.resizeGraphs()}get componentType(){return Graph.type}get defaults(){try{return this.graphDefaults}catch(e){Graph_log.warn(`setting a default: ${e}\n${e.stack}`)}}get seriesTypes(){return Series.types}add(type,dims){return this.cfg.components.series.add(type,dims)}remove(id){this.cfg.components.series.remove(id),this.reinitialize()}transition(duration,done){}isRendered(){return!!src_select(this.root).select(".baseSVG").node().clientWidth}render(data){const transitionDef=this.defaults.graph.transition,graph=this,easing=easings[transitionDef.easing||"easeNone"];this.cfg.transition=this.cfg.baseSVG.transition().duration(transitionDef.duration).ease(easing),Graph.addGraph(graph.root.id,(()=>{setTimeout((()=>{graph.resize(),graph.renderLifecycle(data)}),0)}));try{graph.renderLifecycle(data)}catch(e){Graph_log.warn(`rendering lifecycle: ${e}\n${e.stack}`)}return{update:graph.updateFn(data)}}createDefaults(){return{transition:{duration:1e3,easing:"easeCubic"}}}get scales(){return this.cfg.components.scales}get canvas(){return this.cfg.components.canvas}get grids(){return this.cfg.components.grids}get axes(){return this.cfg.components.axes}get series(){return this.cfg.components.series}get title(){return this.cfg.components.title}get popup(){return this.cfg.components.popup}oninit(node){this.cfg.components.series&&node.attrs.define(this)}view(node){if(this.root){const chain=this.render(node.attrs.data);node.attrs.updatePeriod&&chain.update(node.attrs.updatePeriod,node.attrs.updateCallback)}}initialize(svg){this.cfg.components.forEach((comp=>comp?comp.initialize(svg):""))}preRender(data){this.cfg.components.forEach((comp=>comp?comp.preRender(data):""))}renderComponent(data){this.cfg.components.forEach((comp=>{try{comp?.renderComponent(data)}catch(e){Graph_log.warn("rendering Graph comp: "+e)}}))}postRender(data){this.cfg.components.forEach((comp=>comp?comp.postRender(data):""))}renderLifecycle(data){if(this.isRendered()){const fixedData="function"==typeof data?data():data;fixedData&&(this.initialized||(this.initialize(this.cfg.baseSVG),this.initialized=!0),this.scales.initialize(),this.preRender(fixedData),this.renderComponent(fixedData),this.postRender(fixedData))}else Graph.removeGraph(this.root.id)}get viewport(){return this.cfg.viewPort}updateFn(data){const graphDef=this.defaults.graph,graph=this;return(duration,callback)=>{graph.cfg.transition.on("end",(function listener(){try{graphDef.transition.duration=duration||graphDef.transition.duration,graph.cfg.transition=graph.cfg.transition.transition().duration(graphDef.transition.duration),!graph.isRendered()||callback&&!1===callback(data)||graph.cfg.transition.on("end",listener)}catch(e){Graph_log.warn("error in callback: "+e)}setTimeout((()=>{graph.renderLifecycle(data)}),0)}))}}makeDefaults(){this.graphDefaults={},this.graphDefaults[this.componentType]=this.createDefaults(),Object.keys(this.cfg.components).forEach((comp=>this.graphDefaults[comp]=this.cfg.components[comp]?this.cfg.components[comp].createDefaults():{}))}createComponents(cfg){const comps=this.cfg.components;comps.push(this.cfg.components.scales=new Scales(cfg)),comps.push(this.cfg.components.canvas=new Canvas(cfg)),comps.push(this.cfg.components.grids=new Grids(cfg)),comps.push(this.cfg.components.axes=new Axes(cfg)),comps.push(this.cfg.components.title=new Title(cfg)),comps.push(this.cfg.components.series=new Series(cfg)),comps.push(this.cfg.components.popup=new Popup(cfg))}resize(){const client=this.cfg.client,vp=this.cfg.viewPort;this.root&&(this.root.clientWidth===client.width&&this.root.clientHeight===client.height||(Graph_log.debug((()=>`resizing svg for ${this.root.id}: [${client.width} x ${client.height}] -> [${this.root.clientWidth} x ${this.root.clientHeight}]`)),client.width=this.root.clientWidth,client.height=this.root.clientHeight,vp.width=2*this.root.clientWidth,vp.height=vp.width*this.root.clientHeight/this.root.clientWidth,this.updateBaseSVG(this.cfg)))}createBaseSVG(cfg){return src_select(this.root).append("svg").classed("baseSVG",!0).attr("height","100%").attr("width","100%").attr("preserveAspectRatio","xMinYMin meet")}updateBaseSVG(cfg){cfg.baseSVG.attr("viewBox",`0 0 ${cfg.viewPort.width} ${cfg.viewPort.height}`)}}Graph.type="graph",Graph.graphs={};const EPSILON=Math.pow(2,-52),EDGE_STACK=new Uint32Array(512);class Delaunator{static from(points,getX=defaultGetX,getY=defaultGetY){const n=points.length,coords=new Float64Array(2*n);for(let i=0;i<n;i++){const p=points[i];coords[2*i]=getX(p),coords[2*i+1]=getY(p)}return new Delaunator(coords)}constructor(coords){const n=coords.length>>1;if(n>0&&"number"!=typeof coords[0])throw new Error("Expected coords to contain numbers.");this.coords=coords;const maxTriangles=Math.max(2*n-5,0);this._triangles=new Uint32Array(3*maxTriangles),this._halfedges=new Int32Array(3*maxTriangles),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}update(){const{coords,_hullPrev:hullPrev,_hullNext:hullNext,_hullTri:hullTri,_hullHash:hullHash}=this,n=coords.length>>1;let minX=1/0,minY=1/0,maxX=-1/0,maxY=-1/0;for(let i=0;i<n;i++){const x=coords[2*i],y=coords[2*i+1];x<minX&&(minX=x),y<minY&&(minY=y),x>maxX&&(maxX=x),y>maxY&&(maxY=y),this._ids[i]=i}const cx=(minX+maxX)/2,cy=(minY+maxY)/2;let i0,i1,i2,minDist=1/0;for(let i=0;i<n;i++){const d=dist(cx,cy,coords[2*i],coords[2*i+1]);d<minDist&&(i0=i,minDist=d)}const i0x=coords[2*i0],i0y=coords[2*i0+1];minDist=1/0;for(let i=0;i<n;i++){if(i===i0)continue;const d=dist(i0x,i0y,coords[2*i],coords[2*i+1]);d<minDist&&d>0&&(i1=i,minDist=d)}let i1x=coords[2*i1],i1y=coords[2*i1+1],minRadius=1/0;for(let i=0;i<n;i++){if(i===i0||i===i1)continue;const r=circumradius(i0x,i0y,i1x,i1y,coords[2*i],coords[2*i+1]);r<minRadius&&(i2=i,minRadius=r)}let i2x=coords[2*i2],i2y=coords[2*i2+1];if(minRadius===1/0){for(let i=0;i<n;i++)this._dists[i]=coords[2*i]-coords[0]||coords[2*i+1]-coords[1];quicksort(this._ids,this._dists,0,n-1);const hull=new Uint32Array(n);let j=0;for(let i=0,d0=-1/0;i<n;i++){const id=this._ids[i];this._dists[id]>d0&&(hull[j++]=id,d0=this._dists[id])}return this.hull=hull.subarray(0,j),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(orient(i0x,i0y,i1x,i1y,i2x,i2y)){const i=i1,x=i1x,y=i1y;i1=i2,i1x=i2x,i1y=i2y,i2=i,i2x=x,i2y=y}const center=function(ax,ay,bx,by,cx,cy){const dx=bx-ax,dy=by-ay,ex=cx-ax,ey=cy-ay,bl=dx*dx+dy*dy,cl=ex*ex+ey*ey,d=.5/(dx*ey-dy*ex);return{x:ax+(ey*bl-dy*cl)*d,y:ay+(dx*cl-ex*bl)*d}}(i0x,i0y,i1x,i1y,i2x,i2y);this._cx=center.x,this._cy=center.y;for(let i=0;i<n;i++)this._dists[i]=dist(coords[2*i],coords[2*i+1],center.x,center.y);quicksort(this._ids,this._dists,0,n-1),this._hullStart=i0;let hullSize=3;hullNext[i0]=hullPrev[i2]=i1,hullNext[i1]=hullPrev[i0]=i2,hullNext[i2]=hullPrev[i1]=i0,hullTri[i0]=0,hullTri[i1]=1,hullTri[i2]=2,hullHash.fill(-1),hullHash[this._hashKey(i0x,i0y)]=i0,hullHash[this._hashKey(i1x,i1y)]=i1,hullHash[this._hashKey(i2x,i2y)]=i2,this.trianglesLen=0,this._addTriangle(i0,i1,i2,-1,-1,-1);for(let xp,yp,k=0;k<this._ids.length;k++){const i=this._ids[k],x=coords[2*i],y=coords[2*i+1];if(k>0&&Math.abs(x-xp)<=EPSILON&&Math.abs(y-yp)<=EPSILON)continue;if(xp=x,yp=y,i===i0||i===i1||i===i2)continue;let start=0;for(let j=0,key=this._hashKey(x,y);j<this._hashSize&&(start=hullHash[(key+j)%this._hashSize],-1===start||start===hullNext[start]);j++);start=hullPrev[start];let q,e=start;for(;q=hullNext[e],!orient(x,y,coords[2*e],coords[2*e+1],coords[2*q],coords[2*q+1]);)if(e=q,e===start){e=-1;break}if(-1===e)continue;let t=this._addTriangle(e,i,hullNext[e],-1,-1,hullTri[e]);hullTri[i]=this._legalize(t+2),hullTri[e]=t,hullSize++;let n=hullNext[e];for(;q=hullNext[n],orient(x,y,coords[2*n],coords[2*n+1],coords[2*q],coords[2*q+1]);)t=this._addTriangle(n,i,q,hullTri[i],-1,hullTri[n]),hullTri[i]=this._legalize(t+2),hullNext[n]=n,hullSize--,n=q;if(e===start)for(;q=hullPrev[e],orient(x,y,coords[2*q],coords[2*q+1],coords[2*e],coords[2*e+1]);)t=this._addTriangle(q,i,e,-1,hullTri[e],hullTri[q]),this._legalize(t+2),hullTri[q]=t,hullNext[e]=e,hullSize--,e=q;this._hullStart=hullPrev[i]=e,hullNext[e]=hullPrev[n]=i,hullNext[i]=n,hullHash[this._hashKey(x,y)]=i,hullHash[this._hashKey(coords[2*e],coords[2*e+1])]=e}this.hull=new Uint32Array(hullSize);for(let i=0,e=this._hullStart;i<hullSize;i++)this.hull[i]=e,e=hullNext[e];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(x,y){return Math.floor(function(dx,dy){const p=dx/(Math.abs(dx)+Math.abs(dy));return(dy>0?3-p:1+p)/4}(x-this._cx,y-this._cy)*this._hashSize)%this._hashSize}_legalize(a){const{_triangles:triangles,_halfedges:halfedges,coords}=this;let i=0,ar=0;for(;;){const b=halfedges[a],a0=a-a%3;if(ar=a0+(a+2)%3,-1===b){if(0===i)break;a=EDGE_STACK[--i];continue}const b0=b-b%3,al=a0+(a+1)%3,bl=b0+(b+2)%3,p0=triangles[ar],pr=triangles[a],pl=triangles[al],p1=triangles[bl];if(inCircle(coords[2*p0],coords[2*p0+1],coords[2*pr],coords[2*pr+1],coords[2*pl],coords[2*pl+1],coords[2*p1],coords[2*p1+1])){triangles[a]=p1,triangles[b]=p0;const hbl=halfedges[bl];if(-1===hbl){let e=this._hullStart;do{if(this._hullTri[e]===bl){this._hullTri[e]=a;break}e=this._hullPrev[e]}while(e!==this._hullStart)}this._link(a,hbl),this._link(b,halfedges[ar]),this._link(ar,bl);const br=b0+(b+1)%3;i<EDGE_STACK.length&&(EDGE_STACK[i++]=br)}else{if(0===i)break;a=EDGE_STACK[--i]}}return ar}_link(a,b){this._halfedges[a]=b,-1!==b&&(this._halfedges[b]=a)}_addTriangle(i0,i1,i2,a,b,c){const t=this.trianglesLen;return this._triangles[t]=i0,this._triangles[t+1]=i1,this._triangles[t+2]=i2,this._link(t,a),this._link(t+1,b),this._link(t+2,c),this.trianglesLen+=3,t}}function dist(ax,ay,bx,by){const dx=ax-bx,dy=ay-by;return dx*dx+dy*dy}function orientIfSure(px,py,rx,ry,qx,qy){const l=(ry-py)*(qx-px),r=(rx-px)*(qy-py);return Math.abs(l-r)>=33306690738754716e-32*Math.abs(l+r)?l-r:0}function orient(rx,ry,qx,qy,px,py){return(orientIfSure(px,py,rx,ry,qx,qy)||orientIfSure(rx,ry,qx,qy,px,py)||orientIfSure(qx,qy,px,py,rx,ry))<0}function inCircle(ax,ay,bx,by,cx,cy,px,py){const dx=ax-px,dy=ay-py,ex=bx-px,ey=by-py,fx=cx-px,fy=cy-py,bp=ex*ex+ey*ey,cp=fx*fx+fy*fy;return dx*(ey*cp-bp*fy)-dy*(ex*cp-bp*fx)+(dx*dx+dy*dy)*(ex*fy-ey*fx)<0}function circumradius(ax,ay,bx,by,cx,cy){const dx=bx-ax,dy=by-ay,ex=cx-ax,ey=cy-ay,bl=dx*dx+dy*dy,cl=ex*ex+ey*ey,d=.5/(dx*ey-dy*ex),x=(ey*bl-dy*cl)*d,y=(dx*cl-ex*bl)*d;return x*x+y*y}function quicksort(ids,dists,left,right){if(right-left<=20)for(let i=left+1;i<=right;i++){const temp=ids[i],tempDist=dists[temp];let j=i-1;for(;j>=left&&dists[ids[j]]>tempDist;)ids[j+1]=ids[j--];ids[j+1]=temp}else{let i=left+1,j=right;swap(ids,left+right>>1,i),dists[ids[left]]>dists[ids[right]]&&swap(ids,left,right),dists[ids[i]]>dists[ids[right]]&&swap(ids,i,right),dists[ids[left]]>dists[ids[i]]&&swap(ids,left,i);const temp=ids[i],tempDist=dists[temp];for(;;){do{i++}while(dists[ids[i]]<tempDist);do{j--}while(dists[ids[j]]>tempDist);if(j<i)break;swap(ids,i,j)}ids[left+1]=ids[j],ids[j]=temp,right-i+1>=j-left?(quicksort(ids,dists,i,right),quicksort(ids,dists,left,j-1)):(quicksort(ids,dists,left,j-1),quicksort(ids,dists,i,right))}}function swap(arr,i,j){const tmp=arr[i];arr[i]=arr[j],arr[j]=tmp}function defaultGetX(p){return p[0]}function defaultGetY(p){return p[1]}class path_Path{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(x,y){this._+=`M${this._x0=this._x1=+x},${this._y0=this._y1=+y}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(x,y){this._+=`L${this._x1=+x},${this._y1=+y}`}arc(x,y,r){const x0=(x=+x)+(r=+r),y0=y=+y;if(r<0)throw new Error("negative radius");null===this._x1?this._+=`M${x0},${y0}`:(Math.abs(this._x1-x0)>1e-6||Math.abs(this._y1-y0)>1e-6)&&(this._+="L"+x0+","+y0),r&&(this._+=`A${r},${r},0,1,1,${x-r},${y}A${r},${r},0,1,1,${this._x1=x0},${this._y1=y0}`)}rect(x,y,w,h){this._+=`M${this._x0=this._x1=+x},${this._y0=this._y1=+y}h${+w}v${+h}h${-w}Z`}value(){return this._||null}}class Polygon{constructor(){this._=[]}moveTo(x,y){this._.push([x,y])}closePath(){this._.push(this._[0].slice())}lineTo(x,y){this._.push([x,y])}value(){return this._.length?this._:null}}class Voronoi{constructor(delaunay,[xmin,ymin,xmax,ymax]=[0,0,960,500]){if(!((xmax=+xmax)>=(xmin=+xmin)&&(ymax=+ymax)>=(ymin=+ymin)))throw new Error("invalid bounds");this.delaunay=delaunay,this._circumcenters=new Float64Array(2*delaunay.points.length),this.vectors=new Float64Array(2*delaunay.points.length),this.xmax=xmax,this.xmin=xmin,this.ymax=ymax,this.ymin=ymin,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points,hull,triangles},vectors}=this,circumcenters=this.circumcenters=this._circumcenters.subarray(0,triangles.length/3*2);for(let x,y,i=0,j=0,n=triangles.length;i<n;i+=3,j+=2){const t1=2*triangles[i],t2=2*triangles[i+1],t3=2*triangles[i+2],x1=points[t1],y1=points[t1+1],x2=points[t2],y2=points[t2+1],x3=points[t3],y3=points[t3+1],dx=x2-x1,dy=y2-y1,ex=x3-x1,ey=y3-y1,bl=dx*dx+dy*dy,cl=ex*ex+ey*ey,ab=2*(dx*ey-dy*ex);if(ab)if(Math.abs(ab)<1e-8)x=(x1+x3)/2,y=(y1+y3)/2;else{const d=1/ab;x=x1+(ey*bl-dy*cl)*d,y=y1+(dx*cl-ex*bl)*d}else x=(x1+x3)/2-1e8*ey,y=(y1+y3)/2+1e8*ex;circumcenters[j]=x,circumcenters[j+1]=y}let p0,x0,y0,h=hull[hull.length-1],p1=4*h,x1=points[2*h],y1=points[2*h+1];vectors.fill(0);for(let i=0;i<hull.length;++i)h=hull[i],p0=p1,x0=x1,y0=y1,p1=4*h,x1=points[2*h],y1=points[2*h+1],vectors[p0+2]=vectors[p1]=y0-y1,vectors[p0+3]=vectors[p1+1]=x1-x0}render(context){const buffer=null==context?context=new path_Path:void 0,{delaunay:{halfedges,inedges,hull},circumcenters,vectors}=this;if(hull.length<=1)return null;for(let i=0,n=halfedges.length;i<n;++i){const j=halfedges[i];if(j<i)continue;const ti=2*Math.floor(i/3),tj=2*Math.floor(j/3),xi=circumcenters[ti],yi=circumcenters[ti+1],xj=circumcenters[tj],yj=circumcenters[tj+1];this._renderSegment(xi,yi,xj,yj,context)}let h0,h1=hull[hull.length-1];for(let i=0;i<hull.length;++i){h0=h1,h1=hull[i];const t=2*Math.floor(inedges[h1]/3),x=circumcenters[t],y=circumcenters[t+1],v=4*h0,p=this._project(x,y,vectors[v+2],vectors[v+3]);p&&this._renderSegment(x,y,p[0],p[1],context)}return buffer&&buffer.value()}renderBounds(context){const buffer=null==context?context=new path_Path:void 0;return context.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),buffer&&buffer.value()}renderCell(i,context){const buffer=null==context?context=new path_Path:void 0,points=this._clip(i);if(null===points||!points.length)return;context.moveTo(points[0],points[1]);let n=points.length;for(;points[0]===points[n-2]&&points[1]===points[n-1]&&n>1;)n-=2;for(let i=2;i<n;i+=2)points[i]===points[i-2]&&points[i+1]===points[i-1]||context.lineTo(points[i],points[i+1]);return context.closePath(),buffer&&buffer.value()}*cellPolygons(){const{delaunay:{points}}=this;for(let i=0,n=points.length/2;i<n;++i){const cell=this.cellPolygon(i);cell&&(cell.index=i,yield cell)}}cellPolygon(i){const polygon=new Polygon;return this.renderCell(i,polygon),polygon.value()}_renderSegment(x0,y0,x1,y1,context){let S;const c0=this._regioncode(x0,y0),c1=this._regioncode(x1,y1);0===c0&&0===c1?(context.moveTo(x0,y0),context.lineTo(x1,y1)):(S=this._clipSegment(x0,y0,x1,y1,c0,c1))&&(context.moveTo(S[0],S[1]),context.lineTo(S[2],S[3]))}contains(i,x,y){return(x=+x)==x&&(y=+y)==y&&this.delaunay._step(i,x,y)===i}*neighbors(i){const ci=this._clip(i);if(ci)for(const j of this.delaunay.neighbors(i)){const cj=this._clip(j);if(cj)loop:for(let ai=0,li=ci.length;ai<li;ai+=2)for(let aj=0,lj=cj.length;aj<lj;aj+=2)if(ci[ai]==cj[aj]&&ci[ai+1]==cj[aj+1]&&ci[(ai+2)%li]==cj[(aj+lj-2)%lj]&&ci[(ai+3)%li]==cj[(aj+lj-1)%lj]){yield j;break loop}}}_cell(i){const{circumcenters,delaunay:{inedges,halfedges,triangles}}=this,e0=inedges[i];if(-1===e0)return null;const points=[];let e=e0;do{const t=Math.floor(e/3);if(points.push(circumcenters[2*t],circumcenters[2*t+1]),e=e%3==2?e-2:e+1,triangles[e]!==i)break;e=halfedges[e]}while(e!==e0&&-1!==e);return points}_clip(i){if(0===i&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const points=this._cell(i);if(null===points)return null;const{vectors:V}=this,v=4*i;return V[v]||V[v+1]?this._clipInfinite(i,points,V[v],V[v+1],V[v+2],V[v+3]):this._clipFinite(i,points)}_clipFinite(i,points){const n=points.length;let x0,y0,c0,e0,e1,P=null,x1=points[n-2],y1=points[n-1],c1=this._regioncode(x1,y1);for(let j=0;j<n;j+=2)if(x0=x1,y0=y1,x1=points[j],y1=points[j+1],c0=c1,c1=this._regioncode(x1,y1),0===c0&&0===c1)e0=e1,e1=0,P?P.push(x1,y1):P=[x1,y1];else{let S,sx0,sy0,sx1,sy1;if(0===c0){if(null===(S=this._clipSegment(x0,y0,x1,y1,c0,c1)))continue;[sx0,sy0,sx1,sy1]=S}else{if(null===(S=this._clipSegment(x1,y1,x0,y0,c1,c0)))continue;[sx1,sy1,sx0,sy0]=S,e0=e1,e1=this._edgecode(sx0,sy0),e0&&e1&&this._edge(i,e0,e1,P,P.length),P?P.push(sx0,sy0):P=[sx0,sy0]}e0=e1,e1=this._edgecode(sx1,sy1),e0&&e1&&this._edge(i,e0,e1,P,P.length),P?P.push(sx1,sy1):P=[sx1,sy1]}if(P)e0=e1,e1=this._edgecode(P[0],P[1]),e0&&e1&&this._edge(i,e0,e1,P,P.length);else if(this.contains(i,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return P}_clipSegment(x0,y0,x1,y1,c0,c1){for(;;){if(0===c0&&0===c1)return[x0,y0,x1,y1];if(c0&c1)return null;let x,y,c=c0||c1;8&c?(x=x0+(x1-x0)*(this.ymax-y0)/(y1-y0),y=this.ymax):4&c?(x=x0+(x1-x0)*(this.ymin-y0)/(y1-y0),y=this.ymin):2&c?(y=y0+(y1-y0)*(this.xmax-x0)/(x1-x0),x=this.xmax):(y=y0+(y1-y0)*(this.xmin-x0)/(x1-x0),x=this.xmin),c0?(x0=x,y0=y,c0=this._regioncode(x0,y0)):(x1=x,y1=y,c1=this._regioncode(x1,y1))}}_clipInfinite(i,points,vx0,vy0,vxn,vyn){let p,P=Array.from(points);if((p=this._project(P[0],P[1],vx0,vy0))&&P.unshift(p[0],p[1]),(p=this._project(P[P.length-2],P[P.length-1],vxn,vyn))&&P.push(p[0],p[1]),P=this._clipFinite(i,P))for(let c0,j=0,n=P.length,c1=this._edgecode(P[n-2],P[n-1]);j<n;j+=2)c0=c1,c1=this._edgecode(P[j],P[j+1]),c0&&c1&&(j=this._edge(i,c0,c1,P,j),n=P.length);else this.contains(i,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(P=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return P}_edge(i,e0,e1,P,j){for(;e0!==e1;){let x,y;switch(e0){case 5:e0=4;continue;case 4:e0=6,x=this.xmax,y=this.ymin;break;case 6:e0=2;continue;case 2:e0=10,x=this.xmax,y=this.ymax;break;case 10:e0=8;continue;case 8:e0=9,x=this.xmin,y=this.ymax;break;case 9:e0=1;continue;case 1:e0=5,x=this.xmin,y=this.ymin}P[j]===x&&P[j+1]===y||!this.contains(i,x,y)||(P.splice(j,0,x,y),j+=2)}if(P.length>4)for(let i=0;i<P.length;i+=2){const j=(i+2)%P.length,k=(i+4)%P.length;(P[i]===P[j]&&P[j]===P[k]||P[i+1]===P[j+1]&&P[j+1]===P[k+1])&&(P.splice(j,2),i-=2)}return j}_project(x0,y0,vx,vy){let c,x,y,t=1/0;if(vy<0){if(y0<=this.ymin)return null;(c=(this.ymin-y0)/vy)<t&&(y=this.ymin,x=x0+(t=c)*vx)}else if(vy>0){if(y0>=this.ymax)return null;(c=(this.ymax-y0)/vy)<t&&(y=this.ymax,x=x0+(t=c)*vx)}if(vx>0){if(x0>=this.xmax)return null;(c=(this.xmax-x0)/vx)<t&&(x=this.xmax,y=y0+(t=c)*vy)}else if(vx<0){if(x0<=this.xmin)return null;(c=(this.xmin-x0)/vx)<t&&(x=this.xmin,y=y0+(t=c)*vy)}return[x,y]}_edgecode(x,y){return(x===this.xmin?1:x===this.xmax?2:0)|(y===this.ymin?4:y===this.ymax?8:0)}_regioncode(x,y){return(x<this.xmin?1:x>this.xmax?2:0)|(y<this.ymin?4:y>this.ymax?8:0)}}const delaunay_tau=2*Math.PI,pow=Math.pow;function pointX(p){return p[0]}function pointY(p){return p[1]}function jitter(x,y,r){return[x+Math.sin(x+y)*r,y+Math.cos(x-y)*r]}class Delaunay{static from(points,fx=pointX,fy=pointY,that){return new Delaunay("length"in points?function(points,fx,fy,that){const n=points.length,array=new Float64Array(2*n);for(let i=0;i<n;++i){const p=points[i];array[2*i]=fx.call(that,p,i,points),array[2*i+1]=fy.call(that,p,i,points)}return array}(points,fx,fy,that):Float64Array.from(function*(points,fx,fy,that){let i=0;for(const p of points)yield fx.call(that,p,i,points),yield fy.call(that,p,i,points),++i}(points,fx,fy,that)))}constructor(points){this._delaunator=new Delaunator(points),this.inedges=new Int32Array(points.length/2),this._hullIndex=new Int32Array(points.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const d=this._delaunator,points=this.points;if(d.hull&&d.hull.length>2&&function(d){const{triangles,coords}=d;for(let i=0;i<triangles.length;i+=3){const a=2*triangles[i],b=2*triangles[i+1],c=2*triangles[i+2];if((coords[c]-coords[a])*(coords[b+1]-coords[a+1])-(coords[b]-coords[a])*(coords[c+1]-coords[a+1])>1e-10)return!1}return!0}(d)){this.collinear=Int32Array.from({length:points.length/2},((_,i)=>i)).sort(((i,j)=>points[2*i]-points[2*j]||points[2*i+1]-points[2*j+1]));const e=this.collinear[0],f=this.collinear[this.collinear.length-1],bounds=[points[2*e],points[2*e+1],points[2*f],points[2*f+1]],r=1e-8*Math.hypot(bounds[3]-bounds[1],bounds[2]-bounds[0]);for(let i=0,n=points.length/2;i<n;++i){const p=jitter(points[2*i],points[2*i+1],r);points[2*i]=p[0],points[2*i+1]=p[1]}this._delaunator=new Delaunator(points)}else delete this.collinear;const halfedges=this.halfedges=this._delaunator.halfedges,hull=this.hull=this._delaunator.hull,triangles=this.triangles=this._delaunator.triangles,inedges=this.inedges.fill(-1),hullIndex=this._hullIndex.fill(-1);for(let e=0,n=halfedges.length;e<n;++e){const p=triangles[e%3==2?e-2:e+1];-1!==halfedges[e]&&-1!==inedges[p]||(inedges[p]=e)}for(let i=0,n=hull.length;i<n;++i)hullIndex[hull[i]]=i;hull.length<=2&&hull.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=hull[0],this.triangles[1]=hull[1],this.triangles[2]=hull[1],inedges[hull[0]]=1,2===hull.length&&(inedges[hull[1]]=0))}voronoi(bounds){return new Voronoi(this,bounds)}*neighbors(i){const{inedges,hull,_hullIndex,halfedges,triangles,collinear}=this;if(collinear){const l=collinear.indexOf(i);return l>0&&(yield collinear[l-1]),void(l<collinear.length-1&&(yield collinear[l+1]))}const e0=inedges[i];if(-1===e0)return;let e=e0,p0=-1;do{if(yield p0=triangles[e],e=e%3==2?e-2:e+1,triangles[e]!==i)return;if(e=halfedges[e],-1===e){const p=hull[(_hullIndex[i]+1)%hull.length];return void(p!==p0&&(yield p))}}while(e!==e0)}find(x,y,i=0){if((x=+x)!=x||(y=+y)!=y)return-1;const i0=i;let c;for(;(c=this._step(i,x,y))>=0&&c!==i&&c!==i0;)i=c;return c}_step(i,x,y){const{inedges,hull,_hullIndex,halfedges,triangles,points}=this;if(-1===inedges[i]||!points.length)return(i+1)%(points.length>>1);let c=i,dc=pow(x-points[2*i],2)+pow(y-points[2*i+1],2);const e0=inedges[i];let e=e0;do{let t=triangles[e];const dt=pow(x-points[2*t],2)+pow(y-points[2*t+1],2);if(dt<dc&&(dc=dt,c=t),e=e%3==2?e-2:e+1,triangles[e]!==i)break;if(e=halfedges[e],-1===e){if(e=hull[(_hullIndex[i]+1)%hull.length],e!==t&&pow(x-points[2*e],2)+pow(y-points[2*e+1],2)<dc)return e;break}}while(e!==e0);return c}render(context){const buffer=null==context?context=new path_Path:void 0,{points,halfedges,triangles}=this;for(let i=0,n=halfedges.length;i<n;++i){const j=halfedges[i];if(j<i)continue;const ti=2*triangles[i],tj=2*triangles[j];context.moveTo(points[ti],points[ti+1]),context.lineTo(points[tj],points[tj+1])}return this.renderHull(context),buffer&&buffer.value()}renderPoints(context,r=2){const buffer=null==context?context=new path_Path:void 0,{points}=this;for(let i=0,n=points.length;i<n;i+=2){const x=points[i],y=points[i+1];context.moveTo(x+r,y),context.arc(x,y,r,0,delaunay_tau)}return buffer&&buffer.value()}renderHull(context){const buffer=null==context?context=new path_Path:void 0,{hull,points}=this,h=2*hull[0],n=hull.length;context.moveTo(points[h],points[h+1]);for(let i=1;i<n;++i){const h=2*hull[i];context.lineTo(points[h],points[h+1])}return context.closePath(),buffer&&buffer.value()}hullPolygon(){const polygon=new Polygon;return this.renderHull(polygon),polygon.value()}renderTriangle(i,context){const buffer=null==context?context=new path_Path:void 0,{points,triangles}=this,t0=2*triangles[i*=3],t1=2*triangles[i+1],t2=2*triangles[i+2];return context.moveTo(points[t0],points[t0+1]),context.lineTo(points[t1],points[t1+1]),context.lineTo(points[t2],points[t2+1]),context.closePath(),buffer&&buffer.value()}*trianglePolygons(){const{triangles}=this;for(let i=0,n=triangles.length/3;i<n;++i)yield this.trianglePolygon(i)}trianglePolygon(i){const polygon=new Polygon;return this.renderTriangle(i,polygon),polygon.value()}}const SeriesPlot_log=new Log("SeriesPlot");function SeriesPlot_text(val){return"number"==typeof val?val.toFixed(1):val}class SeriesPlot{constructor(cfg,seriesName,dims){this.cfg=cfg,this.seriesKey=seriesName,this._dims=dims,this.type="none"}get key(){return this.seriesKey}get graphType(){return this.type}get dims(){return this._dims}get defaults(){return this.cfg.graph.defaults.series[this.key]}getDefaults(){const def={dims:this._dims,line:defaultLine(5),marker:defaultMarker(),area:defaultArea(),label:defaultLabel(),popup:!0,transition:!0};return def.line.rendered=!1,def.marker.rendered=!1,def.area.rendered=!1,def.label.rendered=!1,def}accessor(v,colNames,useStack=!0){switch(typeof v){case"function":return(row,rowIndex,...args)=>{try{return v(row,rowIndex,...args)}catch(e){return SeriesPlot_log.warn("accessor function returned error "+e),0}};case"number":return()=>v;case"string":default:const c=colNames.indexOf(""+v);return row=>row?row.data?row.data[c]:row[c]:""}}d3MarkerColors(items,data,defaults){const colors=this.dims.color;colors&&items.attr("color",(function(d,i){const scheme=schemes[defaults.marker.scheme];if("function"==typeof colors){const color=colors(d,i);return"number"==typeof color?scheme(color%10/10):color}if("string"==typeof colors){const col=data.colNames.indexOf(colors);return col>=0?d.data?scheme(d.data[col]):scheme(d[col]):schemes[colors]?schemes[colors](i/data.rows.length):colors}return"number"==typeof colors?scheme(colors%10/10):"#f00"}))}d3FillColors(items,data,defaults){const colors=this.dims.color;colors&&items.attr("color",(function(d,i){const scheme=schemes[defaults.marker.scheme];if("function"==typeof colors){const color=colors(d,i);return"number"==typeof color?scheme(color%10/10):color}if("string"==typeof colors){const col=data.colNames.indexOf(colors);return col>=0?d.data?scheme(d.data[col]):scheme(d[col]):schemes[colors]?schemes[colors](i/data.rows.length):colors}return"number"==typeof colors?scheme(colors%10/10):"#f00"}))}d3RenderMarkerPopup(data){if(this.dims.popup){const format=defaultLocale_format(".4r"),popupAccess=this.accessor(this.dims.popup,data.colNames,!1),abscissa=this.dimensions[this.abscissa][0],absAccess=this.accessor(abscissa,data.colNames,!1),absName="string"==typeof abscissa?abscissa:this.abscissa;return(r,i,xpos)=>{let val=popupAccess(r,i,xpos);"number"==typeof val&&(val=format(val));let abs=absAccess(r,i,xpos);return"number"==typeof abs&&(abs=format(abs)),"function"==typeof this.dims.popup?val:`${this.dims.popup} = ${val}<br>${absName} = ${abs}`}}}initialize(svg,color){this.svg=svg.append("g").classed(this.seriesKey,!0),color&&this.svg.style("color",color);const defaults=this.defaults;if(defaults.area.rendered){this.svg.append("g").classed("area",!0).append("path");!function(svg,settings){setStroke(svg,settings.border).attr("fill",settings.color).attr("fill-opacity",settings.opacity)}(this.svg.select(".area"),defaults.area)}if(defaults.line.rendered){this.svg.append("g").classed("line",!0).append("path");setStroke(this.svg.select(".line"),defaults.line)}if(defaults.marker.rendered){this.svg.append("g").classed("markers",!0);const markers=this.svg.select(".markers");setStroke(markers,defaults.marker.stroke),setFill(markers,defaults.marker.fill)}if(defaults.label.rendered){this.svg.append("g").classed("label",!0);!function(svg,settings){settings&&svg.attr("fill",settings.color).attr("font-family",settings.font.family).attr("font-size",settings.font.size+"px").attr("font-style",settings.font.style).attr("font-weight",settings.font.weight)}(this.svg.select(".label"),defaults.label)}}preRender(data){}renderComponent(data){const defaults=this.defaults;defaults.marker.rendered&&this.svg.call(this.d3RenderMarkers.bind(this),data),defaults.line.rendered&&this.svg.call(this.d3RenderLine.bind(this),data),defaults.area.rendered&&this.svg.call(this.d3RenderFill.bind(this),data),defaults.label.rendered&&this.svg.call(this.d3RenderLabels.bind(this),data)}postRender(data){}}const SeriesPlotScaled_log=new Log("SeriesPlotScaled");class SeriesPlotScaled extends SeriesPlot{accessor(v,colNames,useStack=!0){if(useStack&&this.dims.stacked){const stackDim=this.getStackDim(v),abscissaCol=this.getAbscissaCol();if(stackDim&&"string"==typeof abscissaCol){const stackIndex=colNames.indexOf(this.dims.stacked),fn=super.accessor(v,colNames);return(row,rowIndex)=>row[stackIndex]+fn(row,rowIndex)}}return super.accessor(v,colNames)}expandDomains(dataSet,domains){this.updateStack(dataSet);const dims=this.dimensions;Object.keys(dims).map((dim=>{const useStack="size"!==dim,type=this.cfg.graph.defaults.scales.dims[dim].type;dims[dim].map((colName=>{if(void 0!==colName){const valueFn=this.accessor(colName,dataSet.colNames,useStack);switch(type){case"ordinal":domains[dim]=this.expandOrdinalDomain(dataSet,domains[dim]||[],valueFn);break;default:domains[dim]=this.expandNumDomain(dataSet,domains[dim]||[1e99,-1e99],valueFn)}}}))}))}expandNumDomain(dataSet,domain,fn){return dataSet.rows.reduce(((dom,row,i)=>{let val=fn(row,i);return val instanceof Date&&(val=val.getTime()),isNaN(val)||(dom[0]=Math.min(val,dom[0]),dom[1]=Math.max(val,dom[1])),dom}),domain)}expandOrdinalDomain(dataSet,domain,fn){return dataSet.rows.reduce(((dom,row,i)=>{const val=fn(row,i);return dom.indexOf(val)<0&&dom.push(val),dom}),domain)}preRender(data){super.preRender(data),this.clearStack(data),this.line=void 0}renderComponent(data){try{data={colNames:data.colNames,rows:data.rows.slice()},this.updateStack(data),super.renderComponent(data)}catch(e){SeriesPlotScaled_log.warn(`${this.seriesKey}: ${e}`)}}postRender(data){super.postRender(data)}clearStack(data){const group=this.dims.stacked;if(group){data.colNames.indexOf(group)<0&&data.colNames.push(group);const stackCol=data.colNames.indexOf(group);data.rows.forEach((row=>row[stackCol]=0)),this.cfg.stack[this.dims.stacked]={}}}updateStack(data){const group=this.dims.stacked;if(group){const stack=this.cfg.stack[group],stackCol=data.colNames.indexOf(group),abscissaCol=this.getAbscissaCol(),abscissaIndex=data.colNames.indexOf(abscissaCol),ordinateCol=this.getOrdinateCol(),ordinateIndex=data.colNames.indexOf(ordinateCol);data.rows.forEach((row=>{const abscissaKey=""+row[abscissaIndex];row[stackCol]=stack[""+abscissaKey]||0,stack[""+abscissaKey]=(stack[""+abscissaKey]||0)+row[ordinateIndex]}))}}}new Log("CartSeriesPlot");class SeriesPlotCartesian extends SeriesPlotScaled{constructor(cfg,seriesName,dims){super(cfg,seriesName,dims),this.abscissa="hor",this.type="cartesian"}get dims(){return super.dims}get dimensions(){return{hor:[this.dims.x],ver:[this.dims.y,this.dims.y0],size:[this.dims.r]}}getDefaults(){const def=super.getDefaults();return this.dims.r?(def.marker.rendered=!0,def.marker.stroke=defaultStroke(1)):def.marker.stroke=defaultStroke(0),this.dims.y0&&(def.area.rendered=!0),this.dims.label&&(def.label.rendered=!0,def.label.color="#000"),def}getStackDim(v){return this.dimensions["hor"===this.abscissa?"ver":"hor"].indexOf(v)>=0}getAbscissaCol(){return{hor:this.dims.x,ver:this.dims.y}[this.abscissa]}getOrdinateCol(){return{hor:this.dims.y,ver:this.dims.x}[this.abscissa]}initialize(plot,color){super.initialize(plot,color),void 0===this.dims.popup&&(this.dims.popup={hor:this.dims.y,ver:this.dims.x}[this.abscissa]),"hor"===this.abscissa?this.dims.x||(this.dims.x=(row,i)=>i):this.dims.y||(this.dims.y=(row,i)=>i)}markerShape(){return"circle"}d3RenderMarkers(plot,data){const shape=this.markerShape(),defaults=this.defaults,popup=this.cfg.components.popup,transition=defaults.transition?this.cfg.transition:void 0;if(defaults.marker.rendered){const joint=plot.select(".markers").selectAll(shape).data(data.rows,(d=>d[0])).join(shape).call(popup.addListener.bind(popup),this.d3RenderMarkerPopup(data));transition?joint.transition(transition).call(this.d3DrawMarker.bind(this),data,defaults).call(this.d3MarkerColors.bind(this),data,defaults):joint.call(this.d3DrawMarker.bind(this),data,defaults).call(this.d3MarkerColors.bind(this),data,defaults)}}d3RenderFill(plot,data){const popup=this.cfg.components.popup,transition=this.defaults.transition?this.cfg.transition:void 0;let line=this.line=this.line||this.getPath(data.rows,data.colNames,this.dims.y);return void 0!==this.dims.y0&&(line+="L"+this.getPath(data.rows.reverse(),data.colNames,this.dims.y0,!1).slice(1)),popup.addListener(this.svg.select(".area").selectAll("path"),this.d3RenderMarkerPopup(data)),plot.select(".area").selectAll("path").transition(transition).attr("d",(d=>line))}d3RenderLine(plot,data){const transition=this.defaults.transition?this.cfg.transition:void 0;let line=this.line=this.line||this.getPath(data.rows,data.colNames,this.dims.y);return plot.select(".line").selectAll("path").transition(transition).attr("d",(d=>line))}d3RenderLabels(plot,data){const defaults=this.defaults,popup=this.cfg.components.popup,transition=this.defaults.transition?this.cfg.transition:void 0;defaults.label.rendered&&plot.select(".label").selectAll("text").data(data.rows,(d=>d[0])).join("text").call(popup.addListener.bind(popup),this.d3RenderMarkerPopup(data)).transition(transition).call(this.d3DrawLabels.bind(this),data,defaults)}}new Log("SeriesPlotNumeric");const curves={catmull05:catmullRom.alpha(.5),linear:curve_linear,stepAfter:function(context){return new Step(context,1)}};class SeriesPlotNumeric extends SeriesPlotCartesian{initialize(plot,color){super.initialize(plot,color)}preRender(data){super.preRender(data);this.defaults.area.rendered&&void 0===this.dims.y0&&(this.dims.y0=this.dims.stacked?this.dims.stacked:()=>0)}d3DrawMarker(markers,data,defaults){const scales=this.cfg.components.scales.scaleDims,xAccess=this.accessor(this.dims.x,data.colNames),yAccess=this.accessor(this.dims.y,data.colNames),rAccess=this.accessor(this.dims.r,data.colNames,!1),rDefault=this.defaults.marker.size;markers.attr("cx",((d,i)=>scales.hor(xAccess(d,i)))).attr("cy",((d,i)=>scales.ver(yAccess(d,i)))).attr("r",((d,i)=>this.dims.r?scales.size(rAccess(d,i)):rDefault))}d3DrawLabels(labels,data,defaults){const scales=this.cfg.components.scales.scaleDims,xAccess=this.accessor(this.dims.x,data.colNames),yAccess=this.accessor(this.dims.y,data.colNames),rAccess=this.accessor(this.dims.r,data.colNames,!1),rDefault=this.defaults.marker.size,lAccess=this.accessor(this.dims.label,data.colNames,!1),cfg=this.defaults.label,pos=textPos(cfg.xpos,cfg.ypos,cfg.inside);labels.attr("x",((d,i)=>scales.hor(xAccess(d,i))+(this.dims.r?scales.size(rAccess(d,i)):rDefault)*(pos.x.pos-.5)*2)).attr("y",((d,i)=>scales.ver(yAccess(d,i))+(this.dims.r?scales.size(rAccess(d,i)):rDefault)*(pos.y.pos-.5)*2)).text(((d,i)=>SeriesPlot_text(lAccess(d,i)))).attr("text-anchor",pos.x.anchor).attr("dominant-baseline",pos.y.baseline).attr("dx",((cfg.hOffset||0)+.4*pos.x.shift).toFixed(1)+"em").attr("dy",((cfg.vOffset||0)+.2*pos.y.shift).toFixed(1)+"em")}getPath(rows,colNames,yDef=(()=>0),useStack=!0){const smooth=this.defaults.line.smoothing,scales=this.cfg.components.scales.scaleDims,xAccess=this.accessor(this.dims.x,colNames,useStack),yAccess=this.accessor(yDef,colNames,useStack);return function(x,y){var defined=d3_shape_src_constant(!0),context=null,curve=curve_linear,output=null;function line(data){var i,d,buffer,n=(data=d3_shape_src_array(data)).length,defined0=!1;for(null==context&&(output=curve(buffer=src_path())),i=0;i<=n;++i)!(i<n&&defined(d=data[i],i,data))===defined0&&((defined0=!defined0)?output.lineStart():output.lineEnd()),defined0&&output.point(+x(d,i,data),+y(d,i,data));if(buffer)return output=null,buffer+""||null}return x="function"==typeof x?x:void 0===x?point_x:d3_shape_src_constant(x),y="function"==typeof y?y:void 0===y?point_y:d3_shape_src_constant(y),line.x=function(_){return arguments.length?(x="function"==typeof _?_:d3_shape_src_constant(+_),line):x},line.y=function(_){return arguments.length?(y="function"==typeof _?_:d3_shape_src_constant(+_),line):y},line.defined=function(_){return arguments.length?(defined="function"==typeof _?_:d3_shape_src_constant(!!_),line):defined},line.curve=function(_){return arguments.length?(curve=_,null!=context&&(output=curve(context)),line):curve},line.context=function(_){return arguments.length?(null==_?context=output=null:output=curve(context=_),line):context},line}().x(((d,i)=>scales.hor(xAccess(d,i)))).y(((d,i)=>scales.ver(yAccess(d,i)))).curve(curves[smooth])(rows)}}const Voronoi_log=new Log("Voronoi");Series.register("voronoi",((cfg,sName,dims)=>new Voronoi_Voronoi(cfg,sName,dims)));class Voronoi_Voronoi extends SeriesPlotNumeric{getDefaults(){const def=super.getDefaults();return def.marker.rendered=!0,def.line.rendered=!0,def}renderComponent(data){const scales=this.cfg.components.scales.scaleDims;"number"==typeof this.dims.x&&Voronoi_log.warn(`renderComponent: unsupported const x=${this.dims.x} in voronoi`),"number"==typeof this.dims.y&&Voronoi_log.warn(`renderComponent: unsupported const y=${this.dims.y} in voronoi`);const x=data.colNames.indexOf(this.dims.x),y=data.colNames.indexOf(this.dims.y);this.cfg.components.scales.defaults.margin;this.voronoi=Delaunay.from(data.rows,(r=>scales.hor(r[x])),(r=>scales.ver(r[y]))).voronoi([0,0,this.cfg.viewPort.width,this.cfg.viewPort.height]),super.renderComponent(data)}d3RenderLine(svg,data){if(this.defaults.line.rendered){svg.selectAll("path").transition(this.cfg.transition).attr("d",this.voronoi.render())}}static nearest(sample,anchors){let best=0,dist=1e99;return anchors.forEach(((r,i)=>{const d=Math.pow(r[0]-sample[0],2)+Math.pow(r[1]-sample[1],2);d<dist&&(dist=d,best=i)})),best}static centroid(samples){const sum=samples.reduce(((acc,s)=>(acc[0]+=s[0],acc[1]+=s[1],acc)),[0,0]);return samples.length?[sum[0]/samples.length,sum[1]/samples.length]:[0,0]}}new Log("SeriesPlotPolar");class SeriesPlotPolar extends SeriesPlotScaled{constructor(cfg,seriesName,dims){super(cfg,seriesName,dims),this.abscissa="ang",this.type="polar"}get dims(){return super.dims}get dimensions(){return{ang:[this.dims.phi],rad:[this.dims.r,this.dims.r0]}}getDefaults(){const def=super.getDefaults();return def.marker.rendered=!0,def.marker.stroke=defaultStroke(1),this.dims.label&&(def.label.rendered=!0,def.label.color="#000"),def}expandDomains(dataSet,domains){super.expandDomains(dataSet,domains);"linear"===this.cfg.graph.defaults.scales.dims.rad.type&&(domains.rad[0]=0)}getStackDim(v){return this.dimensions["ang"===this.abscissa?"rad":"ang"].indexOf(v)>=0}getAbscissaCol(){return{ang:this.dims.phi,rad:this.dims.r}[this.abscissa]}getOrdinateCol(){return{ang:this.dims.r,rad:this.dims.phi}[this.abscissa]}initialize(svg,color){super.initialize(svg,color);const r=Math.min(this.cfg.viewPort.width,this.cfg.viewPort.height)/2;this.dims.phi||(this.dims.phi=1),this.dims.r||(this.dims.r="ang"===this.abscissa?()=>r:1),this.dims.r0||(this.dims.r0=0),this.dims.popup||(this.dims.popup={ang:this.dims.r,rad:this.dims.phi}[this.abscissa])}}new Log("Bubble");Series.register("bubble",((cfg,sName,dims)=>new Bubble(cfg,sName,dims)));class Bubble extends SeriesPlotNumeric{getDefaults(){const def=super.getDefaults();return def.area.rendered=!1,def.marker.rendered=!0,def.line.rendered=!1,def}}new Log("Line");Series.register("line",((cfg,sName,dims)=>new Line(cfg,sName,dims)));class Line extends SeriesPlotNumeric{getDefaults(){const def=super.getDefaults();return def.line.rendered=!0,def}}new Log("Area");Series.register("area",((cfg,sName,dims)=>new Area(cfg,sName,dims)));class Area extends SeriesPlotNumeric{getDefaults(){const def=super.getDefaults();return def.area.rendered=!0,def}}const TimeSeries_log=new Log("TimeSeries");Series.register("timeseries",((cfg,sName,dims)=>new TimeSeries(cfg,sName,dims)));class TimeSeries extends SeriesPlotNumeric{constructor(cfg,seriesName,dims){super(cfg,seriesName,dims),this.cfg.graph.defaults.graph.transition.easing="easeLinear"}getDefaults(){this.cfg.components.scales.defaults.dims.hor.aggregateOverTime=!1;const defs=super.getDefaults();return defs.line.rendered=!0,defs}initialize(svg,color){super.initialize(svg,color)}preRender(data){super.preRender(data),"number"==typeof this.dims.x&&TimeSeries_log.warn(`preRender: unsupported const x=${this.dims.x} in timeseries`);const x=data.colNames.indexOf(this.dims.x);if(data.rows.length>1){const xUnit=data.rows[1][x]-data.rows[0][x],domain=this.cfg.components.scales.scaleDims.hor.domain();domain[1]-domain[0]>xUnit&&(domain[0]+=xUnit),this.cfg.components.scales.scaleDims.hor.domain(domain)}}d3RenderMarkers(svg,data){if(data.rows.length<2)return super.d3RenderMarkers(svg,data);const defaults=this.defaults;"number"==typeof this.dims.x&&TimeSeries_log.warn(`d3RenderMarkers: unsupported const x=${this.dims.x} in timeseries`);const x=data.colNames.indexOf(this.dims.x);if(defaults.marker.rendered){const scales=this.cfg.components.scales.scaleDims,xUnit=data.rows[1][x]-data.rows[0][x],samples=svg.select(".markers").selectAll("circle").data(data.rows,(d=>d[0]));samples.exit().remove(),samples.enter().append("circle").call(this.d3DrawMarker.bind(this),data,defaults).attr("transform",`translate(${scales.hor(xUnit)-scales.hor(0)})`).merge(samples).transition(this.cfg.transition).call(this.d3DrawMarker.bind(this),data,defaults).attr("transform","translate(0)")}}d3RenderLine(svg,data){const x=data.colNames.indexOf(this.dims.x),xUnit=data.rows[1][x]-data.rows[0][x],scales=this.cfg.components.scales.scaleDims;return this.line=this.line||this.getPath(data.rows,data.colNames,this.dims.y),svg.select(".line").selectAll("path").attr("d",(d=>this.line)).attr("transform",`translate(${scales.hor(xUnit)-scales.hor(0)})`).transition(this.cfg.transition).attr("transform","translate(0)")}d3RenderFill(svg,data){const x=data.colNames.indexOf(this.dims.x),xUnit=data.rows[1][x]-data.rows[0][x],scales=this.cfg.components.scales.scaleDims;let line=this.line=this.line||this.getPath(data.rows,data.colNames,this.dims.y);return void 0!==this.dims.y0&&(line+="L"+this.getPath(data.rows.reverse(),data.colNames,this.dims.y0,!1).slice(1)),svg.select(".area").selectAll("path").attr("d",(d=>line)).attr("transform",`translate(${scales.hor(xUnit)-scales.hor(0)})`).transition(this.cfg.transition).attr("transform","translate(0)")}}new Log("OrdinalSeriesPlot");class SeriesPlotOrdinal extends SeriesPlotCartesian{constructor(){super(...arguments),this.cache={x:[],x0:[],y:[],y0:[]}}getDefaults(){const scaleDef=this.cfg.graph.defaults.scales.dims[this.abscissa];scaleDef.type="ordinal",scaleDef.ordinal=scaleDef.ordinal||{gap:.3,overlap:0};const def=super.getDefaults();return def.area.rendered=!1,def.marker.rendered=!0,def.line.rendered=!1,def.line.width=1,def}expandNumDomain(dataSet,domain,fn){return(domain=super.expandNumDomain(dataSet,domain,fn))[0]=Math.min(0,domain[0]),domain[1]=Math.max(0,domain[1]),domain}initialize(plot,color){super.initialize(plot,color)}preRender(data){super.preRender(data);const gap=this.cfg.graph.defaults.scales.dims[this.abscissa].ordinal.gap,scale=this.cfg.components.scales.scaleDims[this.abscissa];scale.paddingInner(gap),scale.paddingOuter(gap/2),this.cache={x:[],x0:[],y:[],y0:[]}}markerShape(){return"rect"}d3RenderLine(plot,data){const transition=this.defaults.transition?this.cfg.transition:void 0,line=this.getPath(data.rows,data.colNames);return plot.select(".line").selectAll("path").transition(transition).attr("d",(d=>line))}d3RenderFill(plot,data){}getParams(colNames){const scales=this.cfg.components.scales,scaleDef=scales.defaults.dims[this.abscissa],stackGroup=this.dims.stacked||!1,allKeys=Object.keys(this.cfg.components.series.defaults).filter((k=>0===k.indexOf(Series.type))),myKey=allKeys.indexOf(this.key)||0,step=scales.scaleDims[this.abscissa].step(),pad=scales.scaleDims[this.abscissa].paddingInner(),overlap=scaleDef.ordinal.overlap,thickness=step*(1-pad)/(stackGroup?1:allKeys.length*(1-overlap)+overlap);return[step*pad/2+(stackGroup?0:thickness*myKey*(1-overlap)),thickness]}d3DrawMarker(markers,data,defaults){const[offset,thickness]=this.getParams(data.colNames),xScale=this.cfg.components.scales.scaleDims.hor,yScale=this.cfg.components.scales.scaleDims.ver,x=this.accessor(this.dims.x,data.colNames),x0=this.dims.stacked?this.accessor(this.dims.stacked,data.colNames):()=>0,y=this.accessor(this.dims.y,data.colNames),y0=this.dims.stacked?this.accessor(this.dims.stacked,data.colNames):()=>0,xAttr=(d,i)=>this.cached("x",i,(()=>xScale(x(d,i)))),x0Attr=(d,i)=>this.cached("x0",i,(()=>xScale(x0(d,i)))),yAttr=(d,i)=>this.cached("y",i,(()=>yScale(y(d,i)))),y0Attr=(d,i)=>this.cached("y0",i,(()=>yScale(y0(d,i))));"hor"===this.abscissa?markers.attr("x",((d,i)=>xAttr(d,i)+offset)).attr("y",((d,i)=>Math.min(yAttr(d,i),y0Attr(d,i)))).attr("width",(()=>thickness)).attr("height",((d,i)=>Math.abs(yAttr(d,i)-y0Attr(d,i)))):markers.attr("x",((d,i)=>Math.min(xAttr(d,i),x0Attr(d,i)))).attr("y",((d,i)=>yAttr(d,i)+offset)).attr("height",(()=>thickness)).attr("width",((d,i)=>Math.abs(x0Attr(d,i)-xAttr(d,i))))}cached(v,i,get){return void 0===this.cache[v][i]?this.cache[v][i]=get():this.cache[v][i]}d3DrawLabels(labels,data,defaults){const[offset,thickness]=this.getParams(data.colNames),xScale=this.cfg.components.scales.scaleDims.hor,yScale=this.cfg.components.scales.scaleDims.ver,l=this.accessor(this.dims.label,data.colNames),cfg=this.defaults.label,pos=textPos(cfg.xpos,cfg.ypos,cfg.inside),x=this.accessor(this.dims.x,data.colNames),x0=this.dims.stacked?this.accessor(this.dims.stacked,data.colNames):()=>0,y=this.accessor(this.dims.y,data.colNames),y0=this.dims.stacked?this.accessor(this.dims.stacked,data.colNames):()=>0,xAttr=(d,i)=>this.cached("x",i,(()=>xScale(x(d,i)))),yAttr=(d,i)=>this.cached("y",i,(()=>yScale(y(d,i)))),_={hor:{x:"x",atX:xAttr,xPos:pos.x.pos,y:"y",atY:yAttr,atY0:(d,i)=>this.cached("y0",i,(()=>yScale(y0(d,i)))),yPos:pos.y.pos},ver:{x:"y",atX:yAttr,xPos:pos.y.pos,y:"x",atY:xAttr,atY0:(d,i)=>this.cached("x0",i,(()=>xScale(x0(d,i)))),yPos:pos.x.pos}}[this.abscissa];labels.attr(_.x,((d,i)=>_.atX(d,i)+offset+thickness*_.xPos)).attr(_.y,((d,i)=>Math.min(_.atY(d,i),_.atY0(d,i))+Math.abs(_.atY(d,i)-_.atY0(d,i))*_.yPos)).text(((d,i)=>SeriesPlot_text(l(d,i)))).attr("text-anchor",pos.x.anchor).attr("dominant-baseline",pos.y.baseline).attr("dx",((cfg.hOffset||0)+.2*pos.x.shift).toFixed(1)+"em").attr("dy",((cfg.vOffset||0)+.2*pos.y.shift).toFixed(1)+"em")}getPath(rows,colNames){const hor="hor"===this.abscissa,x=this.accessor(this.dims.x,colNames),y=this.accessor(this.dims.y,colNames),[offset,thickness]=this.getParams(colNames),xScale=this.cfg.components.scales.scaleDims.hor,yScale=this.cfg.components.scales.scaleDims.ver,xAttr=(d,i)=>this.cached("x",i,(()=>xScale(x(d,i)))),yAttr=(d,i)=>this.cached("y",i,(()=>yScale(y(d,i))));return(hor?stepLine(parseInt(""+thickness),"hor").x(((d,i)=>xAttr(d,i)+offset)).y(((d,i)=>yAttr(d,i))):stepLine(parseInt(""+thickness),"ver").x(((d,i)=>xAttr(d,i))).y(((d,i)=>yAttr(d,i)+offset)))(rows)}}function stepLine(step,axis){let xAccess,yAccess;const accessors=rows=>rows.map(((r,i)=>{const x=parseInt(""+xAccess(r,i)),y=parseInt(""+yAccess(r,i));return(0===i?"M":"L")+x+" "+("hor"===axis?y+"L"+(x+step):y+step+"L"+x)+" "+y})).join("");return accessors.x=fn=>(xAccess=fn,accessors),accessors.y=fn=>(yAccess=fn,accessors),accessors}new Log("Column");Series.register("column",((cfg,sName,dims)=>new Column(cfg,sName,dims)));class Column extends SeriesPlotOrdinal{constructor(){super(...arguments),this.abscissa="hor"}getDefaults(){const gridDef=this.cfg.graph.defaults.grids.ver;return gridDef.major.rendered=!1,gridDef.minor.rendered=!1,super.getDefaults()}}new Log("Column");Series.register("bar",((cfg,sName,dims)=>new Bar(cfg,sName,dims)));class Bar extends SeriesPlotOrdinal{constructor(){super(...arguments),this.abscissa="ver"}getDefaults(){const gridDef=this.cfg.graph.defaults.grids.hor;return gridDef.major.rendered=!1,gridDef.minor.rendered=!1,super.getDefaults()}}function sum(values,valueof){let sum=0;if(void 0===valueof)for(let value of values)(value=+value)&&(sum+=value);else{let index=-1;for(let value of values)(value=+valueof(value,++index,values))&&(sum+=value)}return sum}function max_max(values,valueof){let max;if(void 0===valueof)for(const value of values)null!=value&&(max<value||void 0===max&&value>=value)&&(max=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(max<value||void 0===max&&value>=value)&&(max=value)}return max}function min_min(values,valueof){let min;if(void 0===valueof)for(const value of values)null!=value&&(min>value||void 0===min&&value>=value)&&(min=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(min>value||void 0===min&&value>=value)&&(min=value)}return min}function targetDepth(d){return d.target.depth}function align_left(node){return node.depth}function align_right(node,n){return n-1-node.height}function justify(node,n){return node.sourceLinks.length?node.depth:n-1}function align_center(node){return node.targetLinks.length?node.depth:node.sourceLinks.length?min_min(node.sourceLinks,targetDepth)-1:0}function constant_constant(x){return function(){return x}}function ascendingSourceBreadth(a,b){return ascendingBreadth(a.source,b.source)||a.index-b.index}function ascendingTargetBreadth(a,b){return ascendingBreadth(a.target,b.target)||a.index-b.index}function ascendingBreadth(a,b){return a.y0-b.y0}function sankey_value(d){return d.value}function defaultId(d){return d.index}function defaultNodes(graph){return graph.nodes}function defaultLinks(graph){return graph.links}function sankey_find(nodeById,id){const node=nodeById.get(id);if(!node)throw new Error("missing: "+id);return node}function computeLinkBreadths({nodes}){for(const node of nodes){let y0=node.y0,y1=y0;for(const link of node.sourceLinks)link.y0=y0+link.width/2,y0+=link.width;for(const link of node.targetLinks)link.y1=y1+link.width/2,y1+=link.width}}function sankey_Sankey(){let py,sort,linkSort,x0=0,y0=0,x1=1,y1=1,dx=24,dy=8,id=defaultId,align=justify,nodes=defaultNodes,links=defaultLinks,iterations=6;function sankey(){const graph={nodes:nodes.apply(null,arguments),links:links.apply(null,arguments)};return computeNodeLinks(graph),computeNodeValues(graph),computeNodeDepths(graph),computeNodeHeights(graph),computeNodeBreadths(graph),computeLinkBreadths(graph),graph}function computeNodeLinks({nodes,links}){for(const[i,node]of nodes.entries())node.index=i,node.sourceLinks=[],node.targetLinks=[];const nodeById=new Map(nodes.map(((d,i)=>[id(d,i,nodes),d])));for(const[i,link]of links.entries()){link.index=i;let{source,target}=link;"object"!=typeof source&&(source=link.source=sankey_find(nodeById,source)),"object"!=typeof target&&(target=link.target=sankey_find(nodeById,target)),source.sourceLinks.push(link),target.targetLinks.push(link)}if(null!=linkSort)for(const{sourceLinks,targetLinks}of nodes)sourceLinks.sort(linkSort),targetLinks.sort(linkSort)}function computeNodeValues({nodes}){for(const node of nodes)node.value=void 0===node.fixedValue?Math.max(sum(node.sourceLinks,sankey_value),sum(node.targetLinks,sankey_value)):node.fixedValue}function computeNodeDepths({nodes}){const n=nodes.length;let current=new Set(nodes),next=new Set,x=0;for(;current.size;){for(const node of current){node.depth=x;for(const{target}of node.sourceLinks)next.add(target)}if(++x>n)throw new Error("circular link");current=next,next=new Set}}function computeNodeHeights({nodes}){const n=nodes.length;let current=new Set(nodes),next=new Set,x=0;for(;current.size;){for(const node of current){node.height=x;for(const{source}of node.targetLinks)next.add(source)}if(++x>n)throw new Error("circular link");current=next,next=new Set}}function computeNodeBreadths(graph){const columns=function({nodes}){const x=max_max(nodes,(d=>d.depth))+1,kx=(x1-x0-dx)/(x-1),columns=new Array(x);for(const node of nodes){const i=Math.max(0,Math.min(x-1,Math.floor(align.call(null,node,x))));node.layer=i,node.x0=x0+i*kx,node.x1=node.x0+dx,columns[i]?columns[i].push(node):columns[i]=[node]}if(sort)for(const column of columns)column.sort(sort);return columns}(graph);py=Math.min(dy,(y1-y0)/(max_max(columns,(c=>c.length))-1)),function(columns){const ky=min_min(columns,(c=>(y1-y0-(c.length-1)*py)/sum(c,sankey_value)));for(const nodes of columns){let y=y0;for(const node of nodes){node.y0=y,node.y1=y+node.value*ky,y=node.y1+py;for(const link of node.sourceLinks)link.width=link.value*ky}y=(y1-y+py)/(nodes.length+1);for(let i=0;i<nodes.length;++i){const node=nodes[i];node.y0+=y*(i+1),node.y1+=y*(i+1)}reorderLinks(nodes)}}(columns);for(let i=0;i<iterations;++i){const alpha=Math.pow(.99,i),beta=Math.max(1-alpha,(i+1)/iterations);relaxRightToLeft(columns,alpha,beta),relaxLeftToRight(columns,alpha,beta)}}function relaxLeftToRight(columns,alpha,beta){for(let i=1,n=columns.length;i<n;++i){const column=columns[i];for(const target of column){let y=0,w=0;for(const{source,value}of target.targetLinks){let v=value*(target.layer-source.layer);y+=targetTop(source,target)*v,w+=v}if(!(w>0))continue;let dy=(y/w-target.y0)*alpha;target.y0+=dy,target.y1+=dy,reorderNodeLinks(target)}void 0===sort&&column.sort(ascendingBreadth),resolveCollisions(column,beta)}}function relaxRightToLeft(columns,alpha,beta){for(let i=columns.length-2;i>=0;--i){const column=columns[i];for(const source of column){let y=0,w=0;for(const{target,value}of source.sourceLinks){let v=value*(target.layer-source.layer);y+=sourceTop(source,target)*v,w+=v}if(!(w>0))continue;let dy=(y/w-source.y0)*alpha;source.y0+=dy,source.y1+=dy,reorderNodeLinks(source)}void 0===sort&&column.sort(ascendingBreadth),resolveCollisions(column,beta)}}function resolveCollisions(nodes,alpha){const i=nodes.length>>1,subject=nodes[i];resolveCollisionsBottomToTop(nodes,subject.y0-py,i-1,alpha),resolveCollisionsTopToBottom(nodes,subject.y1+py,i+1,alpha),resolveCollisionsBottomToTop(nodes,y1,nodes.length-1,alpha),resolveCollisionsTopToBottom(nodes,y0,0,alpha)}function resolveCollisionsTopToBottom(nodes,y,i,alpha){for(;i<nodes.length;++i){const node=nodes[i],dy=(y-node.y0)*alpha;dy>1e-6&&(node.y0+=dy,node.y1+=dy),y=node.y1+py}}function resolveCollisionsBottomToTop(nodes,y,i,alpha){for(;i>=0;--i){const node=nodes[i],dy=(node.y1-y)*alpha;dy>1e-6&&(node.y0-=dy,node.y1-=dy),y=node.y0-py}}function reorderNodeLinks({sourceLinks,targetLinks}){if(void 0===linkSort){for(const{source:{sourceLinks}}of targetLinks)sourceLinks.sort(ascendingTargetBreadth);for(const{target:{targetLinks}}of sourceLinks)targetLinks.sort(ascendingSourceBreadth)}}function reorderLinks(nodes){if(void 0===linkSort)for(const{sourceLinks,targetLinks}of nodes)sourceLinks.sort(ascendingTargetBreadth),targetLinks.sort(ascendingSourceBreadth)}function targetTop(source,target){let y=source.y0-(source.sourceLinks.length-1)*py/2;for(const{target:node,width}of source.sourceLinks){if(node===target)break;y+=width+py}for(const{source:node,width}of target.targetLinks){if(node===source)break;y-=width}return y}function sourceTop(source,target){let y=target.y0-(target.targetLinks.length-1)*py/2;for(const{source:node,width}of target.targetLinks){if(node===source)break;y+=width+py}for(const{target:node,width}of source.sourceLinks){if(node===target)break;y-=width}return y}return sankey.update=function(graph){return computeLinkBreadths(graph),graph},sankey.nodeId=function(_){return arguments.length?(id="function"==typeof _?_:constant_constant(_),sankey):id},sankey.nodeAlign=function(_){return arguments.length?(align="function"==typeof _?_:constant_constant(_),sankey):align},sankey.nodeSort=function(_){return arguments.length?(sort=_,sankey):sort},sankey.nodeWidth=function(_){return arguments.length?(dx=+_,sankey):dx},sankey.nodePadding=function(_){return arguments.length?(dy=py=+_,sankey):dy},sankey.nodes=function(_){return arguments.length?(nodes="function"==typeof _?_:constant_constant(_),sankey):nodes},sankey.links=function(_){return arguments.length?(links="function"==typeof _?_:constant_constant(_),sankey):links},sankey.linkSort=function(_){return arguments.length?(linkSort=_,sankey):linkSort},sankey.size=function(_){return arguments.length?(x0=y0=0,x1=+_[0],y1=+_[1],sankey):[x1-x0,y1-y0]},sankey.extent=function(_){return arguments.length?(x0=+_[0][0],x1=+_[1][0],y0=+_[0][1],y1=+_[1][1],sankey):[[x0,y0],[x1,y1]]},sankey.iterations=function(_){return arguments.length?(iterations=+_,sankey):iterations},sankey}var path_pi=Math.PI,path_tau=2*path_pi,path_tauEpsilon=path_tau-1e-6;function src_path_Path(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function path_path(){return new src_path_Path}src_path_Path.prototype=path_path.prototype={constructor:src_path_Path,moveTo:function(x,y){this._+="M"+(this._x0=this._x1=+x)+","+(this._y0=this._y1=+y)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(x,y){this._+="L"+(this._x1=+x)+","+(this._y1=+y)},quadraticCurveTo:function(x1,y1,x,y){this._+="Q"+ +x1+","+ +y1+","+(this._x1=+x)+","+(this._y1=+y)},bezierCurveTo:function(x1,y1,x2,y2,x,y){this._+="C"+ +x1+","+ +y1+","+ +x2+","+ +y2+","+(this._x1=+x)+","+(this._y1=+y)},arcTo:function(x1,y1,x2,y2,r){x1=+x1,y1=+y1,x2=+x2,y2=+y2,r=+r;var x0=this._x1,y0=this._y1,x21=x2-x1,y21=y2-y1,x01=x0-x1,y01=y0-y1,l01_2=x01*x01+y01*y01;if(r<0)throw new Error("negative radius: "+r);if(null===this._x1)this._+="M"+(this._x1=x1)+","+(this._y1=y1);else if(l01_2>1e-6)if(Math.abs(y01*x21-y21*x01)>1e-6&&r){var x20=x2-x0,y20=y2-y0,l21_2=x21*x21+y21*y21,l20_2=x20*x20+y20*y20,l21=Math.sqrt(l21_2),l01=Math.sqrt(l01_2),l=r*Math.tan((path_pi-Math.acos((l21_2+l01_2-l20_2)/(2*l21*l01)))/2),t01=l/l01,t21=l/l21;Math.abs(t01-1)>1e-6&&(this._+="L"+(x1+t01*x01)+","+(y1+t01*y01)),this._+="A"+r+","+r+",0,0,"+ +(y01*x20>x01*y20)+","+(this._x1=x1+t21*x21)+","+(this._y1=y1+t21*y21)}else this._+="L"+(this._x1=x1)+","+(this._y1=y1);else;},arc:function(x,y,r,a0,a1,ccw){x=+x,y=+y,ccw=!!ccw;var dx=(r=+r)*Math.cos(a0),dy=r*Math.sin(a0),x0=x+dx,y0=y+dy,cw=1^ccw,da=ccw?a0-a1:a1-a0;if(r<0)throw new Error("negative radius: "+r);null===this._x1?this._+="M"+x0+","+y0:(Math.abs(this._x1-x0)>1e-6||Math.abs(this._y1-y0)>1e-6)&&(this._+="L"+x0+","+y0),r&&(da<0&&(da=da%path_tau+path_tau),da>path_tauEpsilon?this._+="A"+r+","+r+",0,1,"+cw+","+(x-dx)+","+(y-dy)+"A"+r+","+r+",0,1,"+cw+","+(this._x1=x0)+","+(this._y1=y0):da>1e-6&&(this._+="A"+r+","+r+",0,"+ +(da>=path_pi)+","+cw+","+(this._x1=x+r*Math.cos(a1))+","+(this._y1=y+r*Math.sin(a1))))},rect:function(x,y,w,h){this._+="M"+(this._x0=this._x1=+x)+","+(this._y0=this._y1=+y)+"h"+ +w+"v"+ +h+"h"+-w+"Z"},toString:function(){return this._}};const d3_path_src_path=path_path;var src_array_slice=Array.prototype.slice;function node_modules_d3_shape_src_constant(x){return function(){return x}}function src_point_x(p){return p[0]}function src_point_y(p){return p[1]}function linkSource(d){return d.source}function linkTarget(d){return d.target}function link_link(curve){var source=linkSource,target=linkTarget,x=src_point_x,y=src_point_y,context=null;function link(){var buffer,argv=src_array_slice.call(arguments),s=source.apply(this,argv),t=target.apply(this,argv);if(context||(context=buffer=d3_path_src_path()),curve(context,+x.apply(this,(argv[0]=s,argv)),+y.apply(this,argv),+x.apply(this,(argv[0]=t,argv)),+y.apply(this,argv)),buffer)return context=null,buffer+""||null}return link.source=function(_){return arguments.length?(source=_,link):source},link.target=function(_){return arguments.length?(target=_,link):target},link.x=function(_){return arguments.length?(x="function"==typeof _?_:node_modules_d3_shape_src_constant(+_),link):x},link.y=function(_){return arguments.length?(y="function"==typeof _?_:node_modules_d3_shape_src_constant(+_),link):y},link.context=function(_){return arguments.length?(context=null==_?null:_,link):context},link}function curveHorizontal(context,x0,y0,x1,y1){context.moveTo(x0,y0),context.bezierCurveTo(x0=(x0+x1)/2,y0,x0,y1,x1,y1)}function horizontalSource(d){return[d.source.x1,d.y0]}function horizontalTarget(d){return[d.target.x0,d.y1]}function sankeyLinkHorizontal(){return link_link(curveHorizontal).source(horizontalSource).target(horizontalTarget)}const Sankey_log=new Log("Sankey");Series.register("sankey",((cfg,sName,dims)=>new Sankey(cfg,sName,dims)));class Sankey extends SeriesPlot{constructor(cfg,seriesName,dims){super(cfg,seriesName,dims),this.align=justify,this.type="none"}getDefaults(){const def=super.getDefaults();return def.area.rendered=!0,def.line.rendered=!1,def.marker.rendered=!0,def.label.rendered=!1,def.width=20,def.padding=20,def.align="justified",def}get dimensions(){return{}}clearStack(data){}updateStack(data){}initialize(svg,color){super.initialize(svg,color);Math.min(this.cfg.viewPort.width,this.cfg.viewPort.height);this.dims.keys||Sankey_log.error("no keys defined"),this.dims.value||Sankey_log.error("no value defined"),this.cfg.graph.defaults.scales.margin.bottom=this.cfg.graph.defaults.scales.margin.top}preRender(data){super.preRender(data);const margin=this.cfg.graph.defaults.scales.margin;switch(this.defaults.align){case"left":this.align=align_left;break;case"right":this.align=align_right;break;case"center":this.align=align_center;break;case"justified":this.align=justify}if(this.sankey)this.sankey.update(this.createNodesAndLinks(data));else{this.sankey=sankey_Sankey().nodeId((d=>d.name)).nodeAlign(this.align).nodeWidth(this.defaults.width).nodePadding(this.defaults.padding).extent([[margin.left,margin.top],[this.cfg.viewPort.width-margin.left-margin.right,this.cfg.viewPort.height-margin.top-margin.bottom]]);const{nodes,links}=this.sankey(this.createNodesAndLinks(data));this.nodes=nodes,this.links=links}}createNodesAndLinks(data){const keys=this.dims.keys.map((k=>data.colNames.indexOf(k))),v=data.colNames.indexOf(this.dims.value),nodes=this.nodes||[];nodes.names=nodes.names||{};const links=this.links||[];return links.myKeys=links.myKeys||{},data.rows.forEach((r=>{for(let i=1;i<keys.length;i++){const s=keys[i-1],d=keys[i];nodes.names[r[s]]||nodes.push(nodes.names[r[s]]={name:r[s]}),nodes.names[r[d]]||nodes.push(nodes.names[r[d]]={name:r[d]});const key=`${r[s]}-${r[d]}`;links.myKeys[key]||links.push(links.myKeys[key]={source:r[s],target:r[d],names:[r[s],r[d]],value:0}),links.myKeys[key].value+=r[v]}})),{nodes,links}}renderComponent(data){super.renderComponent(data)}postRender(data){super.postRender(data)}d3RenderMarkers(plot,data){const defaults=this.defaults,popup=this.cfg.components.popup;defaults.marker.rendered&&plot.select(".markers").selectAll("rect").data(this.nodes).join("rect").call(popup.addListener.bind(popup),this.d3RenderMarkerPopup()).transition(this.cfg.transition).call(this.d3DrawMarker.bind(this),data,defaults).call(this.d3MarkerColors.bind(this),data,defaults)}d3RenderFill(plot,data){const popup=this.cfg.components.popup,defaults=this.defaults;if(defaults.area.rendered)return plot.select(".area").attr("fill-opacity",0).selectAll("g").data(this.links).join("path").style("mix-blend-mode","multiply").attr("d",sankeyLinkHorizontal()).attr("stroke",(d=>defaults.line.color)).attr("stroke-width",(d=>Math.max(1,d.width))).call(popup.addListener.bind(popup),this.d3RenderMarkerPopup()).transition(this.cfg.transition).call(this.d3FillColors.bind(this),data,defaults)}d3RenderLabels(plot,data){const defaults=this.defaults,width=this.cfg.viewPort.width;defaults.label.rendered&&plot.select(".label").attr("font-family","sans-serif").attr("font-size",10).selectAll("text").data(this.nodes).join("text").attr("x",(d=>d.x0<width/2?d.x1+6:d.x0-6)).attr("y",(d=>(d.y1+d.y0)/2)).attr("text-anchor",(d=>d.x0<width/2?"start":"end")).text((d=>d.name))}d3RenderLine(plot,data){}d3DrawMarker(markers,data,defaults){markers.attr("x",(d=>d.x0)).attr("y",(d=>d.y0)).attr("height",(d=>d.y1-d.y0)).attr("width",(d=>d.x1-d.x0)).attr("fill",defaults.marker.fill.color).attr("opacity",defaults.marker.fill.opacity)}d3RenderMarkerPopup(){return r=>r.name||`${r.source.name} → ${r.target.name}:${r.value}`}}new Log("Pie");Series.register("pie",((cfg,sName,dims)=>new Pie(cfg,sName,dims)));class Pie extends SeriesPlotPolar{constructor(cfg,seriesName,dims){super(cfg,seriesName,dims),this.abscissa="rad"}getDefaults(){const def=super.getDefaults();return def.area.rendered=!1,def.marker.rendered=!0,def.line.rendered=!1,def.cornerRadius=0,def.padAngle=0,def}markerShape(){return"path"}d3RenderMarkers(plot,data){const defaults=this.defaults;if(defaults.marker.rendered){const popup=this.cfg.components.popup,shape=this.markerShape(),phiAccess=this.accessor(this.dims.phi,data.colNames,!1),pie=src_pie().value(((d,i)=>phiAccess(d,i)));plot.select(".markers").selectAll(shape).data(pie(data.rows),(d=>d.data[3])).join(shape).call(popup.addListener.bind(popup),this.d3RenderMarkerPopup(data)).transition(this.cfg.transition).call(this.d3DrawMarker.bind(this),data,defaults).call(this.d3MarkerColors.bind(this),data,defaults)}}d3RenderLine(plot,data){}d3RenderFill(plot,data){}d3RenderLabels(plot,data){const defaults=this.defaults,popup=this.cfg.components.popup;if(defaults.label.rendered){const phiAccess=this.accessor(this.dims.phi,data.colNames,!1),arcs=src_pie().value(((d,i)=>phiAccess(d,i)))(data.rows);plot.select(".label").selectAll("text").data(arcs,(d=>d[0])).join("text").call(popup.addListener.bind(popup),this.d3RenderMarkerPopup(data)).transition(this.cfg.transition).call(this.d3DrawLabels.bind(this),data,defaults)}}d3DrawMarker(markers,data,defaults){const scales=this.cfg.components.scales.scaleDims,rAccess=this.accessor(this.dims.r,data.colNames,!1),r0Access=this.accessor(this.dims.r0,data.colNames,!1),arc=function(){var innerRadius=arcInnerRadius,outerRadius=arcOuterRadius,cornerRadius=d3_shape_src_constant(0),padRadius=null,startAngle=arcStartAngle,endAngle=arcEndAngle,padAngle=arcPadAngle,context=null;function arc(){var buffer,r,r0=+innerRadius.apply(this,arguments),r1=+outerRadius.apply(this,arguments),a0=startAngle.apply(this,arguments)-halfPi,a1=endAngle.apply(this,arguments)-halfPi,da=math_abs(a1-a0),cw=a1>a0;if(context||(context=buffer=src_path()),r1<r0&&(r=r1,r1=r0,r0=r),r1>1e-12)if(da>math_tau-1e-12)context.moveTo(r1*cos(a0),r1*sin(a0)),context.arc(0,0,r1,a0,a1,!cw),r0>1e-12&&(context.moveTo(r0*cos(a1),r0*sin(a1)),context.arc(0,0,r0,a1,a0,cw));else{var t0,t1,a01=a0,a11=a1,a00=a0,a10=a1,da0=da,da1=da,ap=padAngle.apply(this,arguments)/2,rp=ap>1e-12&&(padRadius?+padRadius.apply(this,arguments):sqrt(r0*r0+r1*r1)),rc=math_min(math_abs(r1-r0)/2,+cornerRadius.apply(this,arguments)),rc0=rc,rc1=rc;if(rp>1e-12){var p0=asin(rp/r0*sin(ap)),p1=asin(rp/r1*sin(ap));(da0-=2*p0)>1e-12?(a00+=p0*=cw?1:-1,a10-=p0):(da0=0,a00=a10=(a0+a1)/2),(da1-=2*p1)>1e-12?(a01+=p1*=cw?1:-1,a11-=p1):(da1=0,a01=a11=(a0+a1)/2)}var x01=r1*cos(a01),y01=r1*sin(a01),x10=r0*cos(a10),y10=r0*sin(a10);if(rc>1e-12){var oc,x11=r1*cos(a11),y11=r1*sin(a11),x00=r0*cos(a00),y00=r0*sin(a00);if(da<math_pi&&(oc=intersect(x01,y01,x00,y00,x11,y11,x10,y10))){var ax=x01-oc[0],ay=y01-oc[1],bx=x11-oc[0],by=y11-oc[1],kc=1/sin(acos((ax*bx+ay*by)/(sqrt(ax*ax+ay*ay)*sqrt(bx*bx+by*by)))/2),lc=sqrt(oc[0]*oc[0]+oc[1]*oc[1]);rc0=math_min(rc,(r0-lc)/(kc-1)),rc1=math_min(rc,(r1-lc)/(kc+1))}}da1>1e-12?rc1>1e-12?(t0=cornerTangents(x00,y00,x01,y01,r1,rc1,cw),t1=cornerTangents(x11,y11,x10,y10,r1,rc1,cw),context.moveTo(t0.cx+t0.x01,t0.cy+t0.y01),rc1<rc?context.arc(t0.cx,t0.cy,rc1,atan2(t0.y01,t0.x01),atan2(t1.y01,t1.x01),!cw):(context.arc(t0.cx,t0.cy,rc1,atan2(t0.y01,t0.x01),atan2(t0.y11,t0.x11),!cw),context.arc(0,0,r1,atan2(t0.cy+t0.y11,t0.cx+t0.x11),atan2(t1.cy+t1.y11,t1.cx+t1.x11),!cw),context.arc(t1.cx,t1.cy,rc1,atan2(t1.y11,t1.x11),atan2(t1.y01,t1.x01),!cw))):(context.moveTo(x01,y01),context.arc(0,0,r1,a01,a11,!cw)):context.moveTo(x01,y01),r0>1e-12&&da0>1e-12?rc0>1e-12?(t0=cornerTangents(x10,y10,x11,y11,r0,-rc0,cw),t1=cornerTangents(x01,y01,x00,y00,r0,-rc0,cw),context.lineTo(t0.cx+t0.x01,t0.cy+t0.y01),rc0<rc?context.arc(t0.cx,t0.cy,rc0,atan2(t0.y01,t0.x01),atan2(t1.y01,t1.x01),!cw):(context.arc(t0.cx,t0.cy,rc0,atan2(t0.y01,t0.x01),atan2(t0.y11,t0.x11),!cw),context.arc(0,0,r0,atan2(t0.cy+t0.y11,t0.cx+t0.x11),atan2(t1.cy+t1.y11,t1.cx+t1.x11),cw),context.arc(t1.cx,t1.cy,rc0,atan2(t1.y11,t1.x11),atan2(t1.y01,t1.x01),!cw))):context.arc(0,0,r0,a10,a00,cw):context.lineTo(x10,y10)}else context.moveTo(0,0);if(context.closePath(),buffer)return context=null,buffer+""||null}return arc.centroid=function(){var r=(+innerRadius.apply(this,arguments)+ +outerRadius.apply(this,arguments))/2,a=(+startAngle.apply(this,arguments)+ +endAngle.apply(this,arguments))/2-math_pi/2;return[cos(a)*r,sin(a)*r]},arc.innerRadius=function(_){return arguments.length?(innerRadius="function"==typeof _?_:d3_shape_src_constant(+_),arc):innerRadius},arc.outerRadius=function(_){return arguments.length?(outerRadius="function"==typeof _?_:d3_shape_src_constant(+_),arc):outerRadius},arc.cornerRadius=function(_){return arguments.length?(cornerRadius="function"==typeof _?_:d3_shape_src_constant(+_),arc):cornerRadius},arc.padRadius=function(_){return arguments.length?(padRadius=null==_?null:"function"==typeof _?_:d3_shape_src_constant(+_),arc):padRadius},arc.startAngle=function(_){return arguments.length?(startAngle="function"==typeof _?_:d3_shape_src_constant(+_),arc):startAngle},arc.endAngle=function(_){return arguments.length?(endAngle="function"==typeof _?_:d3_shape_src_constant(+_),arc):endAngle},arc.padAngle=function(_){return arguments.length?(padAngle="function"==typeof _?_:d3_shape_src_constant(+_),arc):padAngle},arc.context=function(_){return arguments.length?(context=null==_?null:_,arc):context},arc}().padAngle(defaults.padAngle).cornerRadius(defaults.cornerRadius).innerRadius(((d,i)=>scales.rad(r0Access(d.data,i)))).outerRadius(((d,i)=>scales.rad(rAccess(d.data,i))));markers.attr("d",arc)}d3DrawLabels(labels,data,defaults){const scales=this.cfg.components.scales.scaleDims,rAccess=this.accessor(this.dims.r,data.colNames,!1),r0Access=this.accessor(this.dims.r0,data.colNames,!1),lAccess=this.accessor(this.dims.label,data.colNames,!1),cfg=this.defaults.label,pos=textPos(cfg.xpos,cfg.ypos,cfg.inside);labels.attr("transform",((d,i)=>`translate(${((d,i,pos)=>{const r=scales.rad(rAccess(d.data,i))*pos+scales.rad(r0Access(d.data,i))*(1-pos),a=(d.startAngle+d.endAngle)/2-Math.PI/2;return[Math.cos(a)*r,Math.sin(a)*r]})(d,i,pos.x.pos)})`)).text(((d,i)=>SeriesPlot_text(lAccess(d.data,i)))).attr("text-anchor",pos.x.anchor).attr("dominant-baseline",pos.y.baseline).attr("dx",((cfg.hOffset||0)+pos.x.shift).toFixed(1)+"em").attr("dy",((cfg.vOffset||0)+pos.y.shift).toFixed(1)+"em")}getPath(rows,colNames,yDef,useStack){return""}}},417:module=>{module.exports=function(){return this.crypto}()}},__webpack_module_cache__={};function __webpack_require__(moduleId){if(__webpack_module_cache__[moduleId])return __webpack_module_cache__[moduleId].exports;var module=__webpack_module_cache__[moduleId]={exports:{}};return __webpack_modules__[moduleId](module,module.exports,__webpack_require__),module.exports}return __webpack_require__.d=(exports,definition)=>{for(var key in definition)__webpack_require__.o(definition,key)&&!__webpack_require__.o(exports,key)&&Object.defineProperty(exports,key,{enumerable:!0,get:definition[key]})},__webpack_require__.o=(obj,prop)=>Object.prototype.hasOwnProperty.call(obj,prop),__webpack_require__.r=exports=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__(397)})();